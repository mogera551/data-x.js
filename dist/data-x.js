(()=>{var e={108:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=108,e.exports=t}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{static data={};static setData(e){Object.assign(this.data,e)}}class t{static filterByName=new Map;static regist(e,t){this.filterByName.set(e,t)}static forward(e,t){return e.reduce(((e,t)=>"forward"in t.filter?((e,t)=>e.filter.forward(t,e.options))(t,e):e),t)}static backward(e,t){return e.reduce(((e,t)=>"backward"in t.filter?((e,t)=>e.filter.backward(t,e.options))(t,e):e),t)}}class r{static root={};static setRoot(e){this.root=e}}class i{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static matchClass="class.";static matchRadio="radio";static matchCheckbox="checkbox";static getType(e){return e===this.matchRadio?this.RADIO:e===this.matchCheckbox?this.CHECKBOX:e.startsWith(this.matchClass)?this.CLASS:this.VALUE}static updateDomByValueType(e){const t=e.domProperty.split("."),s=e.filter.forward(e.forwardFilters,e.viewModel[e.path]),r=(e,t,s,i=e.shift())=>0===e.length?t[i]!==s&&(t[i]=s):r(e,t[i],s),i=s=>r(t,e.dom,s);s instanceof Promise?s.then((e=>i(e))):i(s)}static updateDomByClassType(e){const t=e.domProperty.slice(this.matchClass.length),s=e.filter.forward(e.forwardFilters,e.viewModel[e.path]),r=s=>s?!e.dom.classList.contains(t)&&e.dom.classList.add(t):e.dom.classList.contains(t)&&e.dom.classList.remove(t);s instanceof Promise?s.then((e=>r(e))):r(s)}static updateDomByRadioType(e){const t=e.filter.forward(e.forwardFilters,e.viewModel[e.path]),s=t=>e.dom.checked=e.dom.value===t;t instanceof Promise?t.then((e=>s(e))):s(t)}static updateDomByCheckboxType(e){const t=e.filter.forward(e.forwardFilters,e.viewModel[e.path]),s=t=>e.dom.checked=(t??[]).includes(e.dom.value);t instanceof Promise?t.then((e=>s(e))):s(t)}static setValue=(e,t)=>{const s=Object.getOwnPropertyDescriptor(e.viewModel,e.path);return s?.set?Reflect.apply(s.set,e.viewModel,[t]):e.viewModel[path]=t};static updateViewModelByValueType(e){const t=e.domProperty.split("."),s=(e,t,r=e.shift())=>0===e.length?t[r]:s(e,t[r]),r=e.filter.backward(e.backwardFilters,s(t,e.dom));return this.setValue(e,r)}static updateViewModelByClassType(e){const t=e.domProperty.slice(this.matchClass.length),s=e.dom.classList.contains(t);return this.setValue(e,s)}static updateViewModelByRadioType(e){if(e.dom.checked){const t=e.dom.value;return this.setValue(e,t)}}static updateViewModelByCheckboxType(e){const t=new Set(e.viewModel[e.path]??[]);e.dom.checked?t.add(e.dom.value):t.delete(e.dom.value);const s=Array.from(t);return this.setValue(e,s)}static#e={};static#t={};static init(){this.#e[this.VALUE]=this.updateDomByValueType,this.#e[this.CLASS]=this.updateDomByClassType,this.#e[this.RADIO]=this.updateDomByRadioType,this.#e[this.CHECKBOX]=this.updateDomByCheckboxType,this.#t[this.VALUE]=this.updateViewModelByValueType,this.#t[this.CLASS]=this.updateViewModelByClassType,this.#t[this.RADIO]=this.updateViewModelByRadioType,this.#t[this.CHECKBOX]=this.updateViewModelByCheckboxType}static updateDom(e,t=e.domPropertyType){Reflect.apply(this.#e[t],this,[e])}static updateViewModel(e,t=e.domPropertyType){return Reflect.apply(this.#t[t],this,[e])}}class n{#s;#r;#i;#n;#o;#a;#c;#l;#d;#h;#p;#u;constructor(e,s,r){this.#r=e,this.#i=s.dom?.property,this.#n=r.viewModel,this.#o=s.viewModel?.property,this.#a=s.inputable,this.#p=class{static parse(e){return 0==e.length?[]:e.split("|").map((e=>e.split(":"))).map((([e,s])=>({name:e,options:s?.split(";")??[],filter:t.filterByName.get(e)})))}}.parse(s?.filters.join("|"))??[],this.#u=this.#p.slice().reverse(),this.#s=r,this.#c=r.indexes?.slice()??[],this.#h=i.getType(this.#i);const{path:n,pattern:o}=r.getPathInfo(this.#o);this.#l=n,this.#d=o}get dom(){return this.#r}get domProperty(){return this.#i}get viewModel(){return this.#n}get path(){return this.#l}get pattern(){return this.#d}get domPropertyType(){return this.#h}get forwardFilters(){return this.#p}get backwardFilters(){return this.#u}get filter(){return this.#s.filter}init(e=this.#a){e&&this.attachEvent(),this.updateDom()}updateDom(){i.updateDom(this)}updateViewModel(){i.updateViewModel(this)}attachEvent(e=this.#r,t=this.#s.viewUpdater){e.addEventListener("input",(e=>t.updateProcess((()=>this.updateViewModel()))))}}i.init();class o{nodes=[];loops;binds;key}class a{#r;#n;#o;#m=[];#s;#l;#d;#y;constructor(e,t,s){this.#r=e,this.#n=s.viewModel,this.#o=t.viewModel?.property,this.#s=s;const{path:r,pattern:i}=s.getPathInfo(this.#o);this.#l=r,this.#d=i,this.#y=s.loopStack.slice()}get dom(){return this.#r}get viewModel(){return this.#n}get path(){return this.#l}get pattern(){return this.#d}get children(){return this.#m}createChild(e,t=this.#r,s=this.#s){return s.pushLoop({loop:this,key:e},(()=>{const r=s.loopStack.map((e=>e.key));return s.pushIndexes(r,(()=>{const r=document.createDocumentFragment(),i=new o;i.key=e;const n=t.content.cloneNode(!0),a=s.viewBuilder.build(s,n);return i.binds=a.binds,i.loops=a.loops,r.appendChild(n),Array.from(r.childNodes).forEach((e=>i.nodes.push(e))),i}))}))}expand(){Object.keys(this.viewModel[this.path]).forEach((e=>{this.#m.push(this.createChild(e))}));const e=document.createDocumentFragment(),t=t=>e.appendChild(t);this.#m.forEach((e=>e.nodes.forEach(t))),this.#r.after(e)}restoreStack(e){const t=this.#y.slice(),s=t=>{if(0===t.length)return e();const r=t.pop();return context.pushLoop(r,s)};s(t)}removeChild(e){e.loops.forEach((e=>e.contract())),e.nodes.forEach((e=>e.parentNode.removeChild(e)))}contract(e=this.#m){e.forEach((e=>this.removeChild(e))),e.splice(0)}update(){this.contract(),this.restoreStack((()=>this.expand()))}}class c{#r;#s;#f;#g;#c;#x;#w;constructor(e,t,s){this.#r=e,this.#f=t,this.#g=t.dom?.event,this.#s=s,this.#c=s.indexes?.slice()??[],this.#x=this.getHandlerName()}get event(){return this.#g}get dom(){return this.#r}get handlerName(){return this.#x}init(){this.attachEvent()}getHandlerName(){const e=this.#r;return`${this.#g.toLowerCase()}${t=("x:name"in e?.dataset?e?.dataset["x:name"]:e?.name?.length>0?e.name:e.tagName).toLowerCase(),t?.length>0?t.at(0).toUpperCase()+t.slice(1):""}`;var t}async eventHandler(e,t=this.#s.viewModel,s=this.#s.eventHandler,r=this.handlerName,i=this.#c,n=this.#s){return n.pushIndexes(i,(async()=>s.exec(t,r,e,...i)))}attachEvent(e=this.#r,t=this.#g,s=this.#s.viewUpdater){e.addEventListener(t,(e=>s.updateProcess((async()=>await this.eventHandler(e)))))}}const l=":not([data-x\\:processed])",d="x:ignore",h=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((e=>`${e}${l}`)).join(","),p=["input","textarea","select","button"].map((e=>`${e}${l}`)).join(",");class u{static build(e,t,s=e.bindRules){const{loops:r,binds:i,events:o}=class{static inputable(e){return"INPUT"===e.tagName&&"button"!==e.type||"TEXTAREA"===e.tagName||"SELECT"===e.tagName}static testRadio(e){return"INPUT"===e.tagName&&"radio"===e.type}static testCheckbox(e){return"INPUT"===e.tagName&&"checkbox"===e.type}static parsePropertyName(e){const t=e.split("|");return{property:t.shift(),filters:t}}static parseDataBind(e,t,s=this.inputable(e),r=this.testRadio(e),i=this.testCheckbox(e)){const n=(e,t)=>{if(e.includes("=")){const[n,o]=e.split("="),{property:a,filters:c}=this.parsePropertyName(o);t.dom.property=n,t.viewModel.property=a,t.filters=c;const l=s?r?"radio":i?"checkbox":"value":"";t.inputable=l===n}else{const{property:n,filters:o}=this.parsePropertyName(e);t.dom.property=s?r?"radio":i?"checkbox":"value":"textContent",t.viewModel.property=n,t.filters=o,t.inputable=s}return t},o=t.split(",");if(1==o.length)return[n(t,{dom:{},viewModel:{},filters:[]})];{const e=o.map((e=>n(e,{dom:{},viewModel:{},filters:[]})));return e}}static collectByAttribute(e,t,s=[],r=[],i=[]){return Array.from(t.querySelectorAll(h)).forEach((t=>{if(d in t.dataset)return;const o=t.dataset["x:processing"]?.split(",")??[];if("x:loop"in t.dataset){if("TEMPLATE"!==t.tagName)return;if(o.includes("loop"))return;const s={dom:{},viewModel:{property:t.dataset["x:loop"]},filters:[]};r.push(new a(t,s,e)),o.push("loop")}else{if("x:bind"in t.dataset){if(o.includes("bind"))return;s.push(...this.parseDataBind(t,t.dataset["x:bind"]).map((s=>new n(t,s,e)))),o.push("bind")}if("x:events"in t.dataset){if(o.includes("events"))return;t.dataset["x:events"].split(",").forEach((s=>{const r={dom:{event:s},viewModel:{},filters:[]};i.push(new c(t,r,e))})),o.push("events")}}t.dataset["x:processing"]=o.join(",")})),{binds:s,loops:r,events:i}}static collectByImplicit(e,t,s=[],r=[],i=[]){return Array.from(t.querySelectorAll(p)).forEach((t=>{if(d in t.dataset)return;const r=t.dataset["x:processing"]?.split(",")??[],o=this.testRadio(t),a=this.testCheckbox(t),l={dom:{},viewModel:{},filters:[]};if("BUTTON"===t.tagName||"INPUT"===t.tagName&&"button"===t.type){if(r.includes("events"))return;l.dom.event="click",i.push(new c(t,l,e)),r.push("events")}else{if(r.includes("bind"))return;const{property:i,filters:c}=this.parsePropertyName(t.name);l.dom.property=o?"radio":a?"checkbox":"value",l.viewModel.property=i,l.filters=c,l.inputable=!0,s.push(new n(t,l,e)),r.push("bind")}t.dataset["x:processing"]=r.join(",")})),{binds:s,loops:r,events:i}}static collectByRule(e,t,s,r=[],i=[],o=[]){const h=new Map;return s.forEach((e=>{!h.has(e.dom.selector)&&h.set(e.dom.selector,[]),h.get(e.dom.selector).push(e)})),Array.from(h.keys()).forEach((s=>{t.querySelectorAll(`${s}${l}`).forEach((t=>{if(d in t.dataset)return;const l=this.inputable(t),p=t.dataset["x:processing"]?.split(",")??[],u=p.slice();h.get(s).forEach((s=>{const d=JSON.parse(JSON.stringify(s));if("TEMPLATE"===t.tagName){if(p.includes("loop"))return;((t,s)=>{i.push(new a(s,t,e))})(d,t),u.push("loop")}else if("event"in d.dom){if(p.includes("events"))return;((t,s)=>{o.push(new c(s,t,e))})(d,t),u.push("events")}else{if(p.includes("bind"))return;d.inputable=l,((t,s)=>{r.push(new n(s,t,e))})(d,t),u.push("bind")}})),t.dataset["x:processing"]=u.join(",")}))})),{loops:i,binds:r,events:o}}static collect(e,t,s=[]){const r=[],i=[],n=[];return this.collectByRule(e,t,s,r,i,n),this.collectByAttribute(e,t,r,i,n),this.collectByImplicit(e,t,r,i,n),r.forEach((e=>e.dom.dataset["x:processed"]="")),i.forEach((e=>e.dom.dataset["x:processed"]="")),n.forEach((e=>e.dom.dataset["x:processed"]="")),Array.from(t.querySelectorAll("[data-x\\:processing]")).forEach((e=>{e.removeAttribute("data-x:processing")})),{loops:i,binds:r,events:n}}}.collect(e,t,s);return r.forEach((e=>e.expand())),i.forEach((e=>e.init())),o.forEach((e=>e.init())),{loops:r,binds:i,events:o}}}class m{#b;#v;#P;#E;#N;#k;#A;#M;constructor(e,t){this.#P=e,this.#v=t}get name(){return this.#P}get data(){return this.#v}get block(){return this.#b}get root(){return this.#E}createBackLayer(e=this.#P){const t=document.createElement("div");t.dataset["x:dialog"]=e;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(e=>this.cancelDialog())),t.appendChild(s);const r=document.createElement("div");return r.style.backgroundColor="white",r.style.borderRadius=".375rem",r.style.padding="2rem",r.classList.add("fg"),r.addEventListener("click",(e=>e.stopPropagation())),s.appendChild(r),{root:t,bg:s,fg:r}}async create(e=this.#P,t=this.#v,s=!1){const{root:r,bg:i,fg:n}=this.createBackLayer(e),o=await j.build(e,n,s,t,this);document.body.appendChild(r),this.#b=o,this.#E=r}cancelDialog(){this.#M&&this.#M()}closeDialog(e){this.#A&&this.#A(e)}async main(){return new Promise(((e,t)=>{this.#A=e,this.#M=t})).finally((()=>{this.#E.parentNode.removeChild(this.#E)}))}static async open(e,t={}){const s=new m(e,t);return s.create(),s.main()}}class y{name;pattern;indexes;lastName;parentName;constructor({name:e=null,pattern:t=null,indexes:s=null}){this.name=e,this.pattern=t,this.indexes=s,null==e&&null!=t&&null!=s&&(this.name=y.expand(t,s));const r=this.name.split(".");this.lastName=r.pop(),this.parentName=r.join(".")}static expand(e,t,s=t.slice()){return e.replaceAll("*",(()=>s.shift()))}static createByName(e){return new y({name:e})}static createByPatternIndexes(e,t){return new y({pattern:e,indexes:t})}}class f{static async exec(e,t,...s){const r=t[0].toUpperCase()+t.slice(1),i=`event${r}`,n=`on${r}`;if(i in e){const t=Object.getOwnPropertyDescriptor(e,i);return Reflect.apply(t.set,e,[s])}if(n in e)return e[n](...s)}}class g{static async init(e,t,s=e.viewModel,r=e.properties){const i=[];for(const e of r.values){const r=t=>e.name.includes(".")?s[e.name]=t:s[`__${e.name}`]=t;e?.init&&("AsyncFunction"===e.init.constructor.name?i.push(e.init(t).then((e=>r(e)))):r(e.init(t)))}return await Promise.all(i),f.exec(s,"init",t)}}class x{static reflect(e,t,s={}){Object.keys(t).forEach((r=>{const i=`$${r}`,n=t=>!1!==t&&e.$postUpdate((()=>{e.$notify(i),e.$notifyAll(i)})),o={configurable:!1,enumerable:!0,get:()=>Reflect.get(t,r),set:e=>{const s=Reflect.set(t,r,e);return s instanceof Promise?s.then(n):n(s),s}};Object.defineProperty(s,i,o)}))}}class w{#s;constructor(e){this.#s=e}build(e=this.#s,t=this.#s.viewBuilder,s=this.#s.rootElement){const r=t.build(e,s);e.setBindTree(r),e.buildBinds()}appear(e=this.#s){const t=e.parentElement.attachShadow({mode:"open"});t.appendChild(e.rootElement),e.rootElement=t}}class b{#s;#B=[];constructor(e){this.#s=e}registPostProcess(e){this.#B.push(e)}async postProcess(){const e=this.#B.slice();e.length>0&&this.updateProcess((async()=>{for(const t of e)t()}))}clearPostProcess(){this.#B.splice(0)}updateDom(e=this.#s.notifier,t=this.#s.allBinds,s=this.#s.allLoops,r=this.#s.dependencies){const i=[];e.queue.forEach((({name:e,indexes:t})=>i.push(...r.getReferedProperties(e,t),(({name:e,indexes:t})=>({name:y.expand(e,t),pattern:e,indexes:t}))({name:e,indexes:t}))));const n=new Set(i.map((e=>e.name)));s.filter((e=>n.has(e.path))).forEach((e=>e.update())),t.filter((e=>n.has(e.path))).forEach((e=>e.updateDom()))}async updateProcess(e,t=this.#s,s=this.#s.notifier,r=this.#s.properties){this.clearPostProcess(),s.clear(),r.clearStatus(),await e(),this.updateDom(),r.isUpdate&&t.buildBinds(),await this.postProcess()}}class v{parentNodes=[];name;func;childNodes=[];constructor(e){this.name=e}}class P{#R=new Map;#D;#s;constructor(e){this.#s=e}build(e=this.#R,t=this.#s.dependencyRules){e.clear(),this.#D=this.#s.dependencyRules.slice(),t.forEach((([t,s,r])=>this.add(e,t,s,r)))}add(e,t,s,r){e.has(t)||e.set(t,new v(t));const i=e.get(t);i.func=r,s.forEach((t=>{e.has(t)||e.set(t,new v(t));const s=e.get(t);i.childNodes.push(s),s.parentNodes.push(i)}))}getReferedProperties(e,t,s=this.#R){const r=s.get(e),i=(e,s)=>(null==e||(s.push({name:y.expand(e.name,t??[]),pattern:e.name,indexes:e.func?e.func(t):t}),e.parentNodes.forEach((e=>{s=i(e,s)}))),s),n=i(r,[]),o=[];return n.forEach((e=>{const t=new Set(o.map((e=>e.name)));t.has(e)||o.push(e)})),o}}class E{static PLAIN=1;static PATTERN=2;static EXPANDED=3}class N{#P;#d;#$;#T;#s;#C;#S;#O;#L=!0;#j=!1;#I;constructor(e,t,s,r,i,n){this.#s=e,this.#O=t,this.#P=s,this.#d=r,this.#C=i,this.#S=n;const o=s.split(".");this.#$=o.pop(),this.#T=o.join(".")}get context(){return this.#s}get name(){return this.#P}get pathParent(){return this.#T}get pathLastElement(){return this.#$}get desc(){return this.#C}get init(){return this.#S}get type(){return this.#O}get pattern(){return this.#d}get isArray(){return this.testIsArray()}get referedPatternProperties(){return this.getReferedPatternPeoperties()}get value(){return this.getValue()}get isNew(){return this.#L}get isUpdate(){return this.#j}get hasSetter(){return null!=this.desc.set}set desc(e){this.#C=e,Object.defineProperty(this.#s.viewModel,this.#P,e)}set isNew(e){this.#L=e}set isUpdate(e){this.#j=e}testIsArray(){return!1}getReferedPatternPeoperties(){return[]}getValue(){throw new Error("")}clearStatus(){this.isNew=!1,this.isUpdate=!1}static create(e,{name:t=null,desc:s={},patternProperty:r=null,patternIndexes:i=[],requireSetter:n=null,init:o=null}){return null!=r?new M(e,r,i):(null===n&&(n="set"in s),t.includes("*")?new A(e,t,s,n,o):new k(e,t,s,n,o))}}class k extends N{constructor(e,t,s,r,i){super(e,E.PLAIN,t,t,s,i),this.#V(r)}testIsArray(e=this.name,t=this.context.properties){return t.testIsArray(e)}#V(e){this.context.viewModel;const t=this.context.notifier,s=this.context.cache,r=this.pathParent,i=this.pathLastElement,n=this.name.includes("."),o=`__${this.name}`,a=this.name,c=this.desc,l=n?function(e){const n=c.set?Reflect.apply(c.set,this,[e]):this[r][i]=e;this.isUpdate=!0,s.delete(a);const o=e=>!1!==e&&t.notify(a);return n instanceof Promise?n.then(o):o(n),n}:function(e){const r=c.set?Reflect.apply(c.set,this,[e]):this[o]=e;this.isUpdate=!0,s.delete(a);const i=e=>!1!==e&&t.notify(a);return r instanceof Promise?r.then(i):i(r),r},d={configurable:!0,enumerable:!0,get:n?function(){return s.has(a)?s.get(a):s.set(a,c.get?Reflect.apply(c.get,this,[]):this[r]?.[i])}:function(){return s.has(a)?s.get(a):s.set(a,c.get?Reflect.apply(c.get,this,[]):this[o])}};e&&(d.set=l),this.desc=d}getReferedPatternPeoperties(e=this.context.properties,t=this.name){return e.getReferedPatternPeoperties(t)}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class A extends N{constructor(e,t,s,r,i){super(e,E.PATTERN,t,t,s),this.#V(r)}testIsArray(e=this.pattern,t=this.context.properties){return t.testIsArray(e)}#V(e){const t=this.context,s=(this.context.viewModel,this.pathParent),r=this.pathLastElement,i=this.pattern.split("").filter((e=>"*"===e)).length,n=this.desc,o={configurable:!0,enumerable:!0,get:n.get?n.get:function(){const e="*"===r?(t?.indexes??[]).at(i-1):r;return this[s]?.[e]}};e&&(o.set=n.set?n.set:function(e){const n="*"===r?(t?.indexes??[]).at(i-1):r;this[s][n]=e,this.isUpdate=!0}),this.desc=o}getReferedPatternPeoperties(e=this.context.properties,t=this.pattern){return e.getReferedPatternPeoperties(t)}}class M extends N{#U;#q;constructor(e,t,s){const r=y.expand(t.pattern,s);super(e,E.EXPANDED,r,t.pattern,null,t.init),this.#U=t,this.#q=s.slice(),this.#V()}get patternProperty(){return this.#U}get patternIndexes(){return this.#q}#V(){const e=this.context,t=this.context.cache,s=this.context.viewModel,r=this.context.notifier,i=(this.context.properties,this.patternProperty),n=this.patternIndexes,o=this.name,a={configurable:!0,enumerable:!0,get:()=>e.pushIndexes(n,(()=>t.has(o)?t.get(o):t.set(o,s[i.pattern])))};null!=i.desc.set&&(a.set=a=>e.pushIndexes(n,(()=>{const e=Reflect.apply(i.desc.set,s,[a]);this.isUpdate=!0,t.delete(o);const c=e=>!1!==e&&r.notify(i.pattern,n);return e instanceof Promise?e.then(c):c(e),e}))),this.desc=a}testIsArray(e=this.patternProperty.pattern,t=this.context.properties){return t.testIsArray(e)}getReferedPatternPeoperties(e=this.patternProperty){return e.referedPatternProperties}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class B{#s;#F=new Map;#j=!1;constructor(e){this.#s=e}get names(){return Array.from(this.#F.keys())}get values(){return Array.from(this.#F.values())}build(e=this.#s,t=this.#s.viewModel){this.#F.clear();const s=Object.getPrototypeOf(t),r=e=>({configurable:!0,enumerable:!1,writable:!0,value:e?.value}),i=e=>/^\@\@?([a-zA-Z0-9_\.\*])+(#(get|set|init))?$/.test(e),n=e=>/^#(event[a-zA-Z0-9_]+)$/.test(e),o=e=>/^__([a-zA-Z0-9_])+$/.test(e),a=new Map;[t].forEach((e=>{Object.entries(Object.getOwnPropertyDescriptors(e)).forEach((([e,s])=>{if(i(e)||o(e)||n(e))if(o(e))Reflect.defineProperty(t,e,r(s));else if(i(e)){const[r,i]=e.includes("#")?e.split("#"):[e,null],n="@"===e.at(1),o=n?r.slice(2):r.slice(1),c=a.has(o)?a.get(o):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};c.baseName=c.baseName??o,c.originalName=c.originalName??r,c.privateName=c.privateName??`__${o}`,c.get="get"===i?s.value:c.get,c.set="set"===i?s.value:c.set,c.init="init"===i?s.value:c.init,c.requireGet=null==i||c.requireGet,c.requireSet=n,c.privateValue=null==i?s.value:c.privateValue,a.set(o,c),Reflect.deleteProperty(t,e)}else if(n(e)){const r=e,i="set",n=!0,o=r.slice(1),c=a.has(o)?a.get(o):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};c.baseName=c.baseName??o,c.originalName=c.originalName??r,c.privateName=c.privateName??`__${o}`,c.set="set"===i?s.value:c.set,c.requireGet=null==i||c.requireGet,c.requireSet=n,c.privateValue=null==i?s.value:c.privateValue,a.set(o,c),Reflect.deleteProperty(t,e)}}))})),Array.from(a.entries()).forEach((([i,n])=>{n.privateName in t||n.baseName.includes(".")||Reflect.defineProperty(t,n.privateName,r({value:n.privateValue}));const o=Object.getOwnPropertyDescriptor(t,i)??Object.getOwnPropertyDescriptor(s,i)??{};o.get=null!=n.get?n.get:o.get??null,o.set=null!=n.set?n.set:o.set??null;const a=n.init,c=n.requireSet,l=i;this.setProperty(N.create(e,{name:l,desc:o,requireSetter:c,init:a}))})),[t,s].forEach((t=>{Object.entries(Object.getOwnPropertyDescriptors(t)).forEach((([t,s])=>{this.#F.has(t)||(null!=s?.get?this.setProperty(N.create(e,{name:t,desc:s,requireSetter:null!=s?.set})):null!=s?.set&&this.setProperty(N.create(e,{name:t,desc:s,requireSetter:!0})))}))}));const c=[];for(const e of this.#F.keys()){const t=[],s=e.split("."),r=[];s.forEach((e=>{r.push(e),t.push(r.join("."))})),c.push(...t)}Array.from(new Set(c)).filter((e=>!this.#F.has(e))).forEach((r=>{const i=Object.getOwnPropertyDescriptor(t,r)??Object.getOwnPropertyDescriptor(s,r)??{};this.setProperty(N.create(e,{name:r,desc:i,requireSetter:!0}))})),Object.defineProperty(t,"$context",{get:()=>e})}removeProperty(e,t=this.#s.viewModel,s=this.#s.cache,r=this.#F){delete t[e],r.delete(e),s.delete(e)}getProperty(e,t=this.#F){return t.get(e)}setProperty(e,t=this.#F){t.set(e.name,e)}#H(e){const t=e.type===E.EXPANDED?e.patternIndexes:[],s=e.value,r=this.#s;e.referedPatternProperties.forEach((e=>{const i=e.pattern;(Object.keys(s)??[]).forEach((s=>{const n=t.concat(s);if(!y.expand(i,n).includes("*")){const t=N.create(r,{patternProperty:e,patternIndexes:n,requireSetter:e.hasSetter});this.setProperty(t),e.isArray&&this.#H(t)}}))}))}expand(e,t=null){const s=this.getProperty(e);null!=s&&this.#H(s)}#_(e){const t=(e.type===E.EXPANDED?e.patternIndexes:[]).join("\t"),s=e=>e.patternIndexes.join("\t").startsWith(t);e.referedPatternProperties.forEach((e=>{this.getExpandedPropertiesByPatternProperty(e).filter(s).forEach((e=>{this.removeProperty(e.name)}))}))}contract(e){const t=this.getProperty(e);null!=t&&this.#_(t)}testIsArray(e,t=this.#F){return t.has(`${e}.*`)}#X(e,t=this.#s.cache){t.delete(e);const s=this.getProperty(e);null!=s&&s.isArray&&(this.#_(s),this.#H(s))}updateByName(e,t=this.#s.cache){this.#X(e),this.#s.dependencies.getReferedProperties(e).forEach((t=>e!=t.name&&this.#X(t.name)))}updateByPatternIndexes({name:e,indexes:t}){const s=y.expand(e,t);this.updateByName(s)}expandAll(e=this.#F){Array.from(e.entries()).forEach((([e,t])=>{!e.includes("*")&&t.isArray&&this.#H(t)}))}has(e,t=this.#F){return t.has(e)}getReferedPatternPeoperties(e){const t=`${e}.`;return this.names.filter((e=>e.startsWith(t))).map((e=>this.getProperty(e))).filter((e=>e.type===E.PATTERN))}getExpandedPropertiesByPatternProperty(e){return this.values.filter((e=>e.type===E.EXPANDED)).filter((t=>t.patternProperty===e))}clearStatus(){return this.values.forEach((e=>e.clearStatus()))}get isUpdate(){return this.values.some((e=>e.isUpdate||e.isNew))}}class R{#z=[];#s;constructor(e){this.#s=e}get queue(){return this.#z}notify(e,t=[]){this.#z.push({name:e,indexes:t}),this.#s.properties.updateByPatternIndexes({name:e,indexes:t})}clear(){this.#z.splice(0)}}class D{#W=new Map;#s;constructor(e){this.#s=e}has(e){return this.#W.has(e)}get(e){return this.#W.get(e)}set(e,t){return this.#W.set(e,t),t}delete(e){this.#W.delete(e)}}class ${#G;#K;#Q;#n;#Z;#J;#Y;#ee={binds:[],loops:[]};#te=[];#se=[];#y=[];#re=[];#ie;#ne;#W;#oe;#ae;#b;#ce;#le;#v;#de;#he;constructor(e,t){this.#b=e,this.#G=t}build(){this.#Q=new w(this),this.#Z=u,this.#J=new b(this),this.#Y=new P(this),this.#ie=new B(this),this.#ne=new R(this),this.#W=new D(this),this.#oe=t,this.#ae=r.root,this.#ce=f,this.#le=g,this.#v=e.data,this.#de=x}get parentElement(){return this.#G}get rootElement(){return this.#K}get view(){return this.#Q}get viewModel(){return this.#n}get viewBuilder(){return this.#Z}get viewUpdater(){return this.#J}get dependencies(){return this.#Y}get bindTree(){return this.#ee}get allBinds(){return this.#te}get allLoops(){return this.#se}get indexesStack(){return this.#re}get indexes(){return this.#re[this.#re.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#y}get currentLoop(){return this.#y[this.#y.length-1]}get properties(){return this.#ie}get notifier(){return this.#ne}get cache(){return this.#W}get context(){return this}get filter(){return this.#oe}get rootBlock(){return this.#ae}get block(){return this.#b}get eventHandler(){return this.#ce}get initializer(){return this.#le}get data(){return this.#v}get dataReflecter(){return this.#de}get template(){return this.#he.template}get module(){return this.#he}get bindRules(){return this.#he.bindRules}get dependencyRules(){return this.#he.dependencyRules}set module(e){this.#he=e,this.#n=void 0!==e.viewModel?e.viewModel:void 0!==e.AppViewModel?Reflect.construct(e.AppViewModel,[]):{},this.#K=e.template.content.cloneNode(!0);const t=e?.context??e?._;null!=t&&this.reflect(t,e.dialog)}set rootElement(e){this.#K=e}pushIndexes(e,t){this.#re.push(e);try{return t()}finally{this.#re.pop()}}pushLoop({loop:e,key:t},s){this.#y.push({loop:e,key:t});try{return s()}finally{this.#y.pop()}}getPathInfo(e,t=e,s=this.currentLoop?.loop,r=this.currentLoop?.key,i=this.indexes??[]){return"."===e[0]?"."===e?{path:`${s.path}.${r}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${r}.${e}`,pattern:`${s.pattern}.*.${e}`}:{path:y.expand(t,i),pattern:t}}setBindTree({binds:e,loops:t},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...e),s.loops.push(...t)}buildBinds(e=this.bindTree,t=this.allBinds,s=this.allLoops){t.splice(0),s.splice(0);const r=e=>t.push(e),i=e=>s.push(e);e.binds.forEach(r),e.loops.forEach(i);const n=e=>{e.children.forEach((e=>{e.binds.forEach(r),e.loops.forEach(i),e.loops.forEach(n)}))};e.loops.forEach(n)}reflect(e,t){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([t,s])=>{if(null!=s?.get){const r={configurable:!0,enumerable:!0,get:(...e)=>Reflect.apply(s.get,this,e)};Object.defineProperty(e,t,r)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postUpdate","postUpdate"]].forEach((([t,s])=>{const r={configurable:!0,enumerable:!1,value:"AsyncFunction"===t.constructor.name?async(...e)=>Reflect.apply(this[t],this,e):(...e)=>Reflect.apply(this[t],this,e)};Object.defineProperty(e,s,r)})),null!=t){this.$closeDialog=function(e){t.closeDialog(e)};const s={configurable:!0,enumerable:!1,value:(...e)=>Reflect.apply(this.$closeDialog,this,e)};Object.defineProperty(e,"closeDialog",s),this.$cancelDialog=function(){t.cancelDialog()};const r={configurable:!0,enumerable:!1,value:(...e)=>Reflect.apply(this.$cancelDialog,this,e)};Object.defineProperty(e,"cancelDialog",r)}}$notify(e,t=[]){this.notifier.notify(e,t)}$postUpdate(e){this.viewUpdater.registPostProcess(e)}async $notifyAll(e,t=[]){this.rootBlock.notifyAll(e,t,this.block)}async $inquiryAll(e,t,s){this.$postUpdate((()=>this.rootBlock.inquiryAll(e,t,s,this.block)))}async $openDialog(e,t={}){return m.open(e,t)}}const T="--bind-",C="--bind-class-";class S{dom={selector:""};viewModel={};filters=[];static createBind(e,t,s,r){const i=new S;return i.dom.selector=e,i.dom.property=t,i.viewModel.property=s,i.filters.push(...r),i}static createEvent(e,t){const s=new S;return s.dom.selector=e,s.dom.event=t,s}static createLoop(e,t){const s=new S;return s.dom.selector=e,s.viewModel.property=t,s}static build(e){const t=[];for(let s=0;s<e.style.length;s++){const r=e.style[s],i=e.style.getPropertyValue(r).trim();if("--events"===r)for(const s of i.split(",")){const r=S.createEvent(e.selectorText,s);t.push(r)}else if("--loop"===r){const s=S.createLoop(e.selectorText,i);t.push(s)}else if(r.startsWith(C)){const s=i.split("|"),n=s.shift(),o=s,a=S.createBind(e.selectorText,"class."+r.slice(C.length),n,o);t.push(a)}else if(r.startsWith(T)){const s=i.split("|"),n=s.shift(),o=s,a=S.createBind(e.selectorText,r.slice(T.length).replaceAll("-","."),n,o);t.push(a)}}return t}}class O{static spaPath;static filterPath;static localFilter;static setOptions(e,t){this.spaPath=t.spaPath??`${e}-spa`,this.localFilter=t.localFilter??!1,this.filterPath=this.localFilter?t.filterPath??`${this.spaPath}/module/filter`:null}}class L{viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;static async load(e,t,s=O.spaPath,r=new L){const i=await this.loadScript(e,s);if(Object.assign(r,i?.default??{}),void 0===r.html){const t=await this.loadHtml(e,s);Object.assign(r,{html:t})}if(void 0===r.css){const t=await this.loadCss(e,s);Object.assign(r,{css:t})}if(t&&void 0===r.bindCss&&void 0===r.bindRules){const t=await this.loadBindCss(e,s);Object.assign(r,{bindCss:t})}const n=this.buildTemplate(e,r.html,r.css);if(Object.assign(r,{template:n}),void 0===r.bindRules&&void 0!==r.bindCss){const e=this.buildBindRules(r.bindCss);Object.assign(r,{bindRules:e})}return void 0===r.dependencyRules&&(r.dependencyRules=[]),void 0===r.bindRules&&(r.bindRules=[]),r}static async loadScript(e,t=O.spaPath){const s=t.startsWith("https://")||t.startsWith("http://"),r=document.baseURI.lastIndexOf("/"),i=r>=0?document.baseURI.slice(0,r+1):"";return import(s?`${t}/module/${e}.js`:`${i}${t}/module/${e}.js`).catch((e=>{throw console.error(e),e}))}static async loadHtml(e,t=O.spaPath){return fetch(`${t}/html/${e}.html`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(e.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static async loadCss(e,t=O.spaPath){return fetch(`${t}/css/${e}.css`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(e.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static async loadBindCss(e,t=O.spaPath){return fetch(`${t}/css/${e}.bind.css`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(res.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static buildTemplate(e,t,s){const r=document.createElement("template");return r.innerHTML=t,void 0!==s&&(r.innerHTML="<style>\n"+s+"\n</style>\n"+r.innerHTML),r.dataset["x:block"]=e,r}static buildBindRules(e){return class{static collect(e){const t=document.createElement("div");document.body.appendChild(t);const s=t.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=e;const i=[];s.appendChild(r);const n=Array.from(s.styleSheets).find((e=>e.ownerNode===r));return Array.from(n?.cssRules??[]).map((e=>i.push(...S.build(e)))),document.body.removeChild(t),i}}.collect(e)}}class j{#P;#s;#pe=[];#ue;constructor(e=null){this.#ue=e}get context(){return this.#s}get name(){return this.#P}createContext(e,t){return this.#P=e,this.#s=new $(this,t),this.#s.build(),this.#s}async load(e,t,s){const r=this.createContext(e,t);try{const t=await L.load(e,s);t.dialog=this.#ue,r.module=t}catch(e){throw e}}async buildView(t=e.data,s=this.#s){s.properties.build(),s.dependencies.build(),s.dataReflecter.reflect(s,t,s.viewModel);const r=s.initializer;await r.init(s,t),s.properties.expandAll(),s.view.build(),this.#pe.push(...await I.build(s.rootElement)),s.view.appear()}static async build(t,s,r,i=e.data,n=null){const o=new j(n);return await o.load(t,s,r),await o.buildView(i),o}async notifyAll(e,t,s){const r=this.#s.notifier,i=this.#s.viewModel,n=this.#s.eventHandler,o=this.#s.viewUpdater;for(const r of this.#pe)r.notifyAll(e,t,s);s!==this&&o.updateProcess((async()=>{const o=n.exec(i,"notifyAll",e,t,s),a=()=>r.notify(e);return o instanceof Promise?o.then(a):a(),o}))}async inquiryAll(e,t,s,r){const i=this.#s.viewModel,n=this.#s.eventHandler,o=this.#s.viewUpdater;for(const i of this.#pe)i.inquiryAll(e,t,s,r);r!==this&&o.updateProcess((async()=>n.exec(i,"inquiryAll",e,t,s,r)))}}class I{static async build(e){return await Promise.all((e=>Array.from(e.querySelectorAll("[data-x\\:block]")))(e).map((e=>(async e=>{const t=e.dataset["x:block"],s="x:withBindCss"in e.dataset;return j.build(t,e,s)})(e))))}}class V{#pe=[];async build(){this.#pe.push(...await I.build(document.body))}async notifyAll(e,t,s){for(const r of this.#pe)r.notifyAll(e,t,s)}async inquiryAll(e,t,s,r){for(const i of this.#pe)i.inquiryAll(e,t,s,r)}}t.regist("falsey",{forward:(e,t=[])=>!e}),t.regist("not",{forward:(e,t=[])=>!e}),t.regist("null",{forward:(e,t=[])=>null==e}),t.regist("style-display",{forward:(e,t=[])=>e?"":"none"}),t.regist("locale-string",{forward:(e,t=[])=>Number(e).toLocaleString()}),t.regist("fixed",{forward:(e,t=[])=>Number(e).toFixed(t[0]??0)}),t.regist("ge",{forward:(e,t=[])=>Number(e)>=Number(t[0]??0)}),t.regist("gt",{forward:(e,t=[])=>Number(e)>Number(t[0]??0)}),t.regist("le",{forward:(e,t=[])=>Number(e)<=Number(t[0]??0)}),t.regist("lt",{forward:(e,t=[])=>Number(e)<Number(t[0]??0)}),t.regist("number-value",{forward:(e,t=[])=>e?.toString()??"",backward:(e,t=[])=>""!==e?Number(e):null});window.datax=class{static root;static async boot(t={},i={}){e.setData(t),O.setOptions(this.getBaseName(),i),await class{static async registLocalFilter(e=O.localFilter,t=O.filterPath){if(e){const e=document.baseURI.lastIndexOf("/"),r=e>=0?document.baseURI.slice(0,e+1):"";await s(108)(`${r}${t}/regist.js`)}}}.registLocalFilter(),this.root=new V(this),r.setRoot(this.root),await this.root.build()}static getBaseName(){const e=location.href.split("/").pop();if(e){const t=e.split(".");return t.pop(),t.join(".")}return e}}})()})();