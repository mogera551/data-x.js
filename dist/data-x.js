(()=>{var t={108:t=>{function e(t){return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}e.keys=()=>[],e.resolve=e,e.id=108,t.exports=e}},e={};function s(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,s),a.exports}s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t{static data={};static setData(t){Object.assign(this.data,t)}}class e{static filterByName=new Map;static regist(t,e){this.filterByName.set(t,e)}static forward(t,e){return t.reduce(((t,e)=>"forward"in e.filter?((t,e)=>t.filter.forward(e,t.options))(e,t):t),e)}static backward(t,e){return t.reduce(((t,e)=>"backward"in e.filter?((t,e)=>t.filter.backward(e,t.options))(e,t):t),e)}}class r{static root={};static setRoot(t){this.root=t}}class i{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static matchClass="class.";static matchRadio="radio";static matchCheckbox="checkbox";static getType(t){return t===this.matchRadio?this.RADIO:t===this.matchCheckbox?this.CHECKBOX:t.startsWith(this.matchClass)?this.CLASS:this.VALUE}static async getValue(t,e){const s=Object.getOwnPropertyDescriptor(t,e);return s?.get?await Reflect.apply(s.get,t,[]):t[e]}static async updateDomByValueType(t){const e=t.domProperty.split("."),s=await this.getValue(t.viewModel,t.path),r=(t,e,s,i=t.shift())=>0===t.length?e[i]!==s&&(e[i]=s):r(t,e[i],s),i=s=>r(e,t.dom,t.filter.forward(t.forwardFilters,s));s instanceof Promise?s.then((t=>i(t))):i(s)}static async updateDomByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=await this.getValue(t.viewModel,t.path),r=s=>t.filter.forward(t.forwardFilters,s)?!t.dom.classList.contains(e)&&t.dom.classList.add(e):t.dom.classList.contains(e)&&t.dom.classList.remove(e);s instanceof Promise?s.then((t=>r(t))):r(s)}static async updateDomByRadioType(t){const e=await this.getValue(t.viewModel,t.path),s=e=>t.dom.checked=t.dom.value===t.filter.forward(t.forwardFilters,e);e instanceof Promise?e.then((t=>s(t))):s(e)}static async updateDomByCheckboxType(t){const e=await this.getValue(t.viewModel,t.path),s=e=>t.dom.checked=(t.filter.forward(t.forwardFilters,e)??[]).includes(t.dom.value);e instanceof Promise?e.then((t=>s(t))):s(e)}static async setValue(t,e,s){const r=Object.getOwnPropertyDescriptor(t,e);r?.set?await Reflect.apply(r.set,t,[s]):bind.viewModel[e]=s}static async updateViewModelByValueType(t){const e=t.domProperty.split("."),s=(t,e,r=t.shift())=>0===t.length?e[r]:s(t,e[r]),r=t.filter.backward(t.backwardFilters,s(e,t.dom));await this.setValue(t.viewModel,t.path,r)}static async updateViewModelByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=t.dom.classList.contains(e);await this.setValue(t.viewModel,t.path,s)}static async updateViewModelByRadioType(t){if(t.dom.checked){const e=t.dom.value;await this.setValue(t.viewModel,t.path,e)}}static async updateViewModelByCheckboxType(t){const e=new Set(t.viewModel[t.path]??[]);t.dom.checked?e.add(t.dom.value):e.delete(t.dom.value);const s=Array.from(e);await this.setValue(t.viewModel,t.path,s)}static#t={};static#e={};static init(){this.#t[this.VALUE]=this.updateDomByValueType,this.#t[this.CLASS]=this.updateDomByClassType,this.#t[this.RADIO]=this.updateDomByRadioType,this.#t[this.CHECKBOX]=this.updateDomByCheckboxType,this.#e[this.VALUE]=this.updateViewModelByValueType,this.#e[this.CLASS]=this.updateViewModelByClassType,this.#e[this.RADIO]=this.updateViewModelByRadioType,this.#e[this.CHECKBOX]=this.updateViewModelByCheckboxType}static async updateDom(t,e=t.domPropertyType){await Reflect.apply(this.#t[e],this,[t])}static async updateViewModel(t,e=t.domPropertyType){await Reflect.apply(this.#e[e],this,[t])}}class a{#s;#r;#i;#a;#n;#o;#c;#l;#p;#d;#h;#u;constructor(t,s,r){this.#r=t,this.#i=s.dom?.property,this.#a=r.viewModel,this.#n=s.viewModel?.property,this.#o=s.inputable,this.#h=class{static parse(t){return 0==t.length?[]:t.split("|").map((t=>t.split(":"))).map((([t,s])=>({name:t,options:s?.split(";")??[],filter:e.filterByName.get(t)})))}}.parse(s?.filters.join("|"))??[],this.#u=this.#h.slice().reverse(),this.#s=r,this.#c=r.indexes?.slice()??[],this.#d=i.getType(this.#i);const{path:a,pattern:n}=r.getPathInfo(this.#n);this.#l=a,this.#p=n}get dom(){return this.#r}get domProperty(){return this.#i}get viewModel(){return this.#a}get path(){return this.#l}get pattern(){return this.#p}get domPropertyType(){return this.#d}get forwardFilters(){return this.#h}get backwardFilters(){return this.#u}get filter(){return this.#s.filter}async init(t=this.#o){t&&this.attachEvent(),await this.updateDom()}async updateDom(){await i.updateDom(this)}async#m(){await i.updateViewModel(this)}attachEvent(t=this.#r,e=this.#s.viewUpdater){t.addEventListener("input",(t=>e.updateProcess((()=>this.#m()))))}}i.init();class n{nodes=[];loops;binds;key}class o{#r;#n;#y=[];#s;#l;#p;#f;constructor(t,e,s){this.#r=t,this.#n=e.viewModel?.property,this.#s=s;const{path:r,pattern:i}=s.getPathInfo(this.#n);this.#l=r,this.#p=i,this.#f=s.loopStack.slice()}get dom(){return this.#r}get path(){return this.#l}get pattern(){return this.#p}get children(){return this.#y}async#g(t,e=this.#r,s=this.#s){return s.pushLoop({loop:this,key:t},(()=>{const r=s.loopStack.map((t=>t.key));return s.pushIndexes(r,(async()=>{const r=document.createDocumentFragment(),i=new n,a=e.content.cloneNode(!0),{binds:o,loops:c}=await s.viewBuilder.build(s,a);return Object.assign(i,{key:t,binds:o,loops:c}),r.appendChild(a),i.nodes.push(...Array.from(r.childNodes)),i}))}))}async expand(t=this.#s.viewModel,e=this.#l,s=this.#y,r=this.#r){const i=await t[e];for(const t of Object.keys(i))s.push(await this.#g(t));const a=document.createDocumentFragment(),n=t=>a.appendChild(t);s.forEach((t=>t.nodes.forEach(n))),r.after(a)}#w(t){const e=this.#f.slice(),s=e=>{if(0===e.length)return t();const r=e.pop();return context.pushLoop(r,s)};return s(e)}#x(t){t.loops.forEach((t=>t.contract())),t.nodes.forEach((t=>t.parentNode.removeChild(t)))}contract(t=this.#y){t.forEach((t=>this.#x(t))),t.splice(0)}async update(){this.contract(),await this.#w((async()=>this.expand()))}}class c{#r;#s;#b;#c;#v;constructor(t,e,s){this.#r=t,this.#b=e.dom?.event,this.#s=s,this.#c=s.indexes?.slice()??[],this.#v=this.#P()}get event(){return this.#b}get dom(){return this.#r}init(){this.#E()}#P(){const t=this.#r;return`${this.#b.toLowerCase()}${e="x:name"in t?.dataset?t?.dataset["x:name"]:t?.name?.length>0?t.name:t.tagName.toLowerCase(),e?.length>0?e.at(0).toUpperCase()+e.slice(1):""}`;var e}async#N(t,e=this.#s.viewModel,s=this.#s.eventHandler,r=this.#v,i=this.#c,a=this.#s){return a.pushIndexes(i,(()=>s.exec(e,r,t,...i)))}#E(t=this.#r,e=this.#b,s=this.#s.viewUpdater){t.addEventListener(e,(t=>s.updateProcess((()=>this.#N(t)))))}}const l=":not([data-x\\:processed])",p="x:ignore",d=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((t=>`${t}${l}`)).join(","),h=["input","textarea","select","button"].map((t=>`${t}${l}`)).join(",");class u{static async build(t,e,s=t.bindRules){const{loops:r,binds:i,events:n}=class{static inputable(t){return"INPUT"===t.tagName&&"button"!==t.type||"TEXTAREA"===t.tagName||"SELECT"===t.tagName}static testRadio(t){return"INPUT"===t.tagName&&"radio"===t.type}static testCheckbox(t){return"INPUT"===t.tagName&&"checkbox"===t.type}static parsePropertyName(t){const e=t.split("|");return{property:e.shift(),filters:e}}static parseDataBind(t,e,s=this.inputable(t),r=this.testRadio(t),i=this.testCheckbox(t)){const a=(t,e)=>{if(t.includes("=")){const[a,n]=t.split("="),{property:o,filters:c}=this.parsePropertyName(n);e.dom.property=a,e.viewModel.property=o,e.filters=c;const l=s?r?"radio":i?"checkbox":"value":"";e.inputable=l===a}else{const{property:a,filters:n}=this.parsePropertyName(t);e.dom.property=s?r?"radio":i?"checkbox":"value":"textContent",e.viewModel.property=a,e.filters=n,e.inputable=s}return e},n=e.split(",");if(1==n.length)return[a(e,{dom:{},viewModel:{},filters:[]})];{const t=n.map((t=>a(t,{dom:{},viewModel:{},filters:[]})));return t}}static collectByAttribute(t,e,s=[],r=[],i=[]){return Array.from(e.querySelectorAll(d)).forEach((e=>{if(p in e.dataset)return;const n=e.dataset["x:processing"]?.split(",")??[];if("x:loop"in e.dataset){if("TEMPLATE"!==e.tagName)return;if(n.includes("loop"))return;const s={dom:{},viewModel:{property:e.dataset["x:loop"]},filters:[]};r.push(new o(e,s,t)),n.push("loop")}else{if("x:bind"in e.dataset){if(n.includes("bind"))return;s.push(...this.parseDataBind(e,e.dataset["x:bind"]).map((s=>new a(e,s,t)))),n.push("bind")}if("x:events"in e.dataset){if(n.includes("events"))return;e.dataset["x:events"].split(",").forEach((s=>{const r={dom:{event:s},viewModel:{},filters:[]};i.push(new c(e,r,t))})),n.push("events")}}e.dataset["x:processing"]=n.join(",")})),{binds:s,loops:r,events:i}}static collectByImplicit(t,e,s=[],r=[],i=[]){return Array.from(e.querySelectorAll(h)).forEach((e=>{if(p in e.dataset)return;const r=e.dataset["x:processing"]?.split(",")??[],n=this.testRadio(e),o=this.testCheckbox(e),l={dom:{},viewModel:{},filters:[]};if("BUTTON"===e.tagName||"INPUT"===e.tagName&&"button"===e.type){if(r.includes("events"))return;l.dom.event="click",i.push(new c(e,l,t)),r.push("events")}else{if(r.includes("bind"))return;const{property:i,filters:c}=this.parsePropertyName(e.name);l.dom.property=n?"radio":o?"checkbox":"value",l.viewModel.property=i,l.filters=c,l.inputable=!0,s.push(new a(e,l,t)),r.push("bind")}e.dataset["x:processing"]=r.join(",")})),{binds:s,loops:r,events:i}}static collectByRule(t,e,s,r=[],i=[],n=[]){const d=new Map;return s.forEach((t=>{!d.has(t.dom.selector)&&d.set(t.dom.selector,[]),d.get(t.dom.selector).push(t)})),Array.from(d.keys()).forEach((s=>{e.querySelectorAll(`${s}${l}`).forEach((e=>{if(p in e.dataset)return;const l=this.inputable(e),h=e.dataset["x:processing"]?.split(",")??[],u=h.slice();d.get(s).forEach((s=>{const p=JSON.parse(JSON.stringify(s));if("TEMPLATE"===e.tagName){if(h.includes("loop"))return;((e,s)=>{i.push(new o(s,e,t))})(p,e),u.push("loop")}else if("event"in p.dom){if(h.includes("events"))return;((e,s)=>{n.push(new c(s,e,t))})(p,e),u.push("events")}else{if(h.includes("bind"))return;p.inputable=l,((e,s)=>{r.push(new a(s,e,t))})(p,e),u.push("bind")}})),e.dataset["x:processing"]=u.join(",")}))})),{loops:i,binds:r,events:n}}static collect(t,e,s=[]){const r=[],i=[],a=[];return this.collectByRule(t,e,s,r,i,a),this.collectByAttribute(t,e,r,i,a),this.collectByImplicit(t,e,r,i,a),r.forEach((t=>t.dom.dataset["x:processed"]="")),i.forEach((t=>t.dom.dataset["x:processed"]="")),a.forEach((t=>t.dom.dataset["x:processed"]="")),Array.from(e.querySelectorAll("[data-x\\:processing]")).forEach((t=>{t.removeAttribute("data-x:processing")})),{loops:i,binds:r,events:a}}}.collect(t,e,s);return await Promise.all(r.map((t=>t.expand()))),await Promise.all(i.map((t=>t.init()))),n.forEach((t=>t.init())),{loops:r,binds:i,events:n}}}class m{#k;#A;#M;#R;#B;#D;#$;#T;constructor(t,e){this.#M=t,this.#A=e}get name(){return this.#M}get data(){return this.#A}get block(){return this.#k}get root(){return this.#R}createBackLayer(t=this.#M){const e=document.createElement("div");e.dataset["x:dialog"]=t;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(t=>this.cancelDialog())),e.appendChild(s);const r=document.createElement("div");return r.style.backgroundColor="white",r.style.borderRadius=".375rem",r.style.padding="2rem",r.classList.add("fg"),r.addEventListener("click",(t=>t.stopPropagation())),s.appendChild(r),{root:e,bg:s,fg:r}}async create(t=this.#M,e=this.#A,s=!1){const{root:r,bg:i,fg:a}=this.createBackLayer(t),n=await j.build(t,a,s,e,this);document.body.appendChild(r),this.#k=n,this.#R=r}cancelDialog(){this.#T&&this.#T()}closeDialog(t){this.#$&&this.#$(t)}async main(){return new Promise(((t,e)=>{this.#$=t,this.#T=e})).finally((()=>{this.#R.parentNode.removeChild(this.#R)}))}static async open(t,e={}){const s=new m(t,e);return s.create(),s.main()}}class y{name;pattern;indexes;lastName;parentName;constructor({name:t=null,pattern:e=null,indexes:s=null}){this.name=t,this.pattern=e,this.indexes=s,null==t&&null!=e&&null!=s&&(this.name=y.expand(e,s));const r=this.name.split(".");this.lastName=r.pop(),this.parentName=r.join(".")}static expand(t,e,s=e.slice()){let r=!1;const i=t.replaceAll("*",(()=>s.shift()??(r=!0,"*")));return r?null:i}static createByName(t){return new y({name:t})}static createByPatternIndexes(t,e){return new y({pattern:t,indexes:e})}}class f{static async exec(t,e,...s){const r=e[0].toUpperCase()+e.slice(1),i=`event${r}`,a=`on${r}`;if(i in t){const e=Object.getOwnPropertyDescriptor(t,i);return Reflect.apply(e.set,t,[s])}if(a in t)return t[a](...s)}}class g{static async init(t,e,s=t.viewModel,r=t.properties){const i=[];for(const t of r.values){const r=e=>t.name.includes(".")?s[t.name]=e:s[`__${t.name}`]=e;t?.init&&("AsyncFunction"===t.init.constructor.name?i.push(t.init(e).then((t=>r(t)))):r(t.init(e)))}return await Promise.all(i),f.exec(s,"init",e)}}class w{static reflect(t,e,s={}){Object.keys(e).forEach((r=>{const i=`$${r}`,a=e=>!1!==e&&t.$postProcess((()=>{t.$notify(i),t.$notifyAll(i)})),n={configurable:!1,enumerable:!0,get:()=>Reflect.get(e,r),set:t=>{const s=Reflect.set(e,r,t);return s instanceof Promise?s.then(a):a(s),s}};Object.defineProperty(s,i,n)}))}}class x{#s;constructor(t){this.#s=t}async build(t=this.#s,e=this.#s.viewBuilder,s=this.#s.rootElement){const r=await e.build(t,s);t.setBindTree(r),t.buildBinds()}appear(t=this.#s){const e=t.parentElement.attachShadow({mode:"open"});e.appendChild(t.rootElement),t.rootElement=e}}class b{#s;#C=[];constructor(t){this.#s=t}registPostProcess(t){this.#C.push(t)}async postProcess(){const t=this.#C.slice(),e=[];return t.length>0&&this.updateProcess((()=>{for(const s of t)e.push(s())})),Promise.all(e)}clearPostProcess(){this.#C.splice(0)}async updateDom(t=this.#s.notifier,e=this.#s.allBinds,s=this.#s.allLoops,r=this.#s.dependencies){const i=[];t.queue.forEach((({name:t,indexes:e})=>i.push(...r.getReferedProperties(t,e),(({name:t,indexes:e})=>({name:y.expand(t,e),pattern:t,indexes:e}))({name:t,indexes:e}))));const a=new Set(i.map((t=>t.name)));await Promise.all(s.filter((t=>a.has(t.path))).map((t=>t.update()))),await Promise.all(e.filter((t=>a.has(t.path))).map((t=>t.updateDom())))}async updateProcess(t,e=this.#s,s=this.#s.notifier,r=this.#s.properties){this.clearPostProcess(),s.clear(),r.clearStatus(),await t(),await this.updateDom(),r.isUpdate&&e.buildBinds(),await this.postProcess()}}class v{parentNodes=[];name;func;childNodes=[];constructor(t){this.name=t}}class P{#O=new Map;#S;#s;constructor(t){this.#s=t}get map(){return this.#O}build(t=this.#O,e=this.#s.dependencyRules){t.clear(),this.#S=this.#s.dependencyRules.slice(),e.forEach((([t,e,s])=>this.add(t,e,s))),this.implicitDependency()}implicitDependency(t=this.#s.properties){for(const e of t.names)t.getDependencyNames(e).forEach((t=>this.add(t,[e])))}add(t,e,s,r=this.#O){r.has(t)||r.set(t,new v(t));const i=r.get(t);i.func=s,e.forEach((t=>{r.has(t)||r.set(t,new v(t));const e=r.get(t);i.childNodes.push(e),e.parentNodes.push(i)}))}getReferedProperties(t,e,s=this.#O){const r=s.get(t),i=e??[],a=(t,e)=>{if(null==t)return e;const s=y.expand(t.name,i);return null!==s&&e.push({name:s,pattern:t.name,indexes:t.func?t.func(i):i}),t.parentNodes.forEach((t=>{e=a(t,e)})),e},n=a(r,[]),o=[];return n.forEach((t=>{const e=new Set(o.map((t=>t.name)));e.has(t)||o.push(t)})),o}}class E{static PLAIN=1;static PATTERN=2;static EXPANDED=3}class N{#M;#p;#L;#j;#s;#V;#I;#U;#q=!0;#F=!1;#H;constructor(t,e,s,r,i,a){this.#s=t,this.#U=e,this.#M=s,this.#p=r,this.#V=i,this.#I=a;const n=s.split(".");this.#L=n.pop(),this.#j=n.join(".")}get context(){return this.#s}get name(){return this.#M}get pathParent(){return this.#j}get pathLastElement(){return this.#L}get desc(){return this.#V}get init(){return this.#I}get type(){return this.#U}get pattern(){return this.#p}get isArray(){return this.testIsArray()}get referedPatternProperties(){return this.getReferedPatternPeoperties()}get value(){return this.getValue()}get isNew(){return this.#q}get isUpdate(){return this.#F}get hasSetter(){return null!=this.desc.set}set desc(t){this.#V=t,Object.defineProperty(this.#s.viewModel,this.#M,t)}set isNew(t){this.#q=t}set isUpdate(t){this.#F=t}testIsArray(){return!1}getReferedPatternPeoperties(){return[]}getValue(){throw new Error("")}clearStatus(){this.isNew=!1,this.isUpdate=!1}static create(t,{name:e=null,desc:s={},patternProperty:r=null,patternIndexes:i=[],requireSetter:a=null,init:n=null}){return null!=r?new M(t,r,i):(null===a&&(a="set"in s),e.includes("*")?new A(t,e,s,a,n):new k(t,e,s,a,n))}}class k extends N{constructor(t,e,s,r,i){super(t,E.PLAIN,e,e,s,i),this.#_(r)}testIsArray(t=this.name,e=this.context.properties){return e.testIsArray(t)}#_(t){this.context.viewModel;const e=this.context.notifier,s=this.context.cache,r=this.pathParent,i=this.pathLastElement,a=this.name.includes("."),n=`__${this.name}`,o=this.name,c=this.desc,l=a?function(t){const a=c.set?Reflect.apply(c.set,this,[t]):this[r][i]=t;return this.isUpdate=!0,s.delete(o),(async()=>{!1!==await a&&await e.notify(o)})()}:function(t){const r=c.set?Reflect.apply(c.set,this,[t]):this[n]=t;return this.isUpdate=!0,s.delete(o),(async()=>{!1!==await r&&await e.notify(o)})()},p={configurable:!0,enumerable:!0,get:a?function(){return s.has(o)?s.get(o):s.set(o,c.get?Reflect.apply(c.get,this,[]):this[r]?.[i])}:function(){return s.has(o)?s.get(o):s.set(o,c.get?Reflect.apply(c.get,this,[]):this[n])}};t&&(p.set=l),this.desc=p}getReferedPatternPeoperties(t=this.context.properties,e=this.name){return t.getReferedPatternPeoperties(e)}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class A extends N{constructor(t,e,s,r,i){super(t,E.PATTERN,e,e,s),this.#_(r)}testIsArray(t=this.pattern,e=this.context.properties){return e.testIsArray(t)}#_(t){const e=this.context,s=(this.context.viewModel,this.pathParent),r=this.pathLastElement,i=this.pattern.split("").filter((t=>"*"===t)).length,a=this.desc,n={configurable:!0,enumerable:!0,get:a.get?a.get:function(){const t="*"===r?(e?.indexes??[]).at(i-1):r;return this[s]?.[t]}};t&&(n.set=a.set?a.set:function(t){const a="*"===r?(e?.indexes??[]).at(i-1):r;this[s][a]=t,this.isUpdate=!0}),this.desc=n}getReferedPatternPeoperties(t=this.context.properties,e=this.pattern){return t.getReferedPatternPeoperties(e)}}class M extends N{#X;#z;constructor(t,e,s){const r=y.expand(e.pattern,s);super(t,E.EXPANDED,r,e.pattern,null,e.init),this.#X=e,this.#z=s.slice(),this.#_()}get patternProperty(){return this.#X}get patternIndexes(){return this.#z}#_(){const t=this.context,e=this.context.cache,s=this.context.viewModel,r=this.context.notifier,i=(this.context.properties,this.patternProperty),a=this.patternIndexes,n=this.name,o={configurable:!0,enumerable:!0,get:()=>t.pushIndexes(a,(()=>e.has(n)?e.get(n):e.set(n,s[i.pattern])))};null!=i.desc.set&&(o.set=o=>t.pushIndexes(a,(()=>{const t=Reflect.apply(i.desc.set,s,[o]);return this.isUpdate=!0,e.delete(n),(async()=>{!1!==await t&&await r.notify(i.pattern,a)})()}))),this.desc=o}testIsArray(t=this.patternProperty.pattern,e=this.context.properties){return e.testIsArray(t)}getReferedPatternPeoperties(t=this.patternProperty){return t.referedPatternProperties}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class R{#s;#W=new Map;#F=!1;constructor(t){this.#s=t}get names(){return Array.from(this.#W.keys())}get values(){return Array.from(this.#W.values())}build(t=this.#s,e=this.#s.viewModel){this.#W.clear();const s=Object.getPrototypeOf(e),r=t=>({configurable:!0,enumerable:!1,writable:!0,value:t?.value}),i=t=>/^\@\@?([a-zA-Z0-9_\.\*])+(#(get|set|init))?$/.test(t),a=t=>/^#(event[a-zA-Z0-9_]+)$/.test(t),n=t=>/^__([a-zA-Z0-9_])+$/.test(t),o=new Map;[e].forEach((t=>{Object.entries(Object.getOwnPropertyDescriptors(t)).forEach((([t,s])=>{if(i(t)||n(t)||a(t))if(n(t))Reflect.defineProperty(e,t,r(s));else if(i(t)){const[r,i]=t.includes("#")?t.split("#"):[t,null],a="@"===t.at(1),n=a?r.slice(2):r.slice(1),c=o.has(n)?o.get(n):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};c.baseName=c.baseName??n,c.originalName=c.originalName??r,c.privateName=c.privateName??`__${n}`,c.get="get"===i?s.value:c.get,c.set="set"===i?s.value:c.set,c.init="init"===i?s.value:c.init,c.requireGet=null==i||c.requireGet,c.requireSet=a,c.privateValue=null==i?s.value:c.privateValue,o.set(n,c),Reflect.deleteProperty(e,t)}else if(a(t)){const r=t,i="set",a=!0,n=r.slice(1),c=o.has(n)?o.get(n):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};c.baseName=c.baseName??n,c.originalName=c.originalName??r,c.privateName=c.privateName??`__${n}`,c.set="set"===i?s.value:c.set,c.requireGet=null==i||c.requireGet,c.requireSet=a,c.privateValue=null==i?s.value:c.privateValue,o.set(n,c),Reflect.deleteProperty(e,t)}}))})),Array.from(o.entries()).forEach((([i,a])=>{a.privateName in e||a.baseName.includes(".")||Reflect.defineProperty(e,a.privateName,r({value:a.privateValue}));const n=Object.getOwnPropertyDescriptor(e,i)??Object.getOwnPropertyDescriptor(s,i)??{};n.get=null!=a.get?a.get:n.get??null,n.set=null!=a.set?a.set:n.set??null;const o=a.init,c=a.requireSet,l=i;this.setProperty(N.create(t,{name:l,desc:n,requireSetter:c,init:o}))})),[e,s].forEach((e=>{Object.entries(Object.getOwnPropertyDescriptors(e)).forEach((([e,s])=>{this.#W.has(e)||(null!=s?.get?this.setProperty(N.create(t,{name:e,desc:s,requireSetter:null!=s?.set})):null!=s?.set&&this.setProperty(N.create(t,{name:e,desc:s,requireSetter:!0})))}))}));const c=[];for(const t of this.#W.keys()){const e=[],s=t.split("."),r=[];s.forEach((t=>{r.push(t),e.push(r.join("."))})),c.push(...e)}Array.from(new Set(c)).filter((t=>!this.#W.has(t))).forEach((r=>{const i=Object.getOwnPropertyDescriptor(e,r)??Object.getOwnPropertyDescriptor(s,r)??{};this.setProperty(N.create(t,{name:r,desc:i,requireSetter:!0}))})),Object.defineProperty(e,"$context",{get:()=>t})}removeProperty(t,e=this.#s.viewModel,s=this.#s.cache,r=this.#W){delete e[t],r.delete(t),s.delete(t)}getProperty(t,e=this.#W){return e.get(t)}setProperty(t,e=this.#W){e.set(t.name,t)}async#G(t){const e=t.type===E.EXPANDED?t.patternIndexes:[],s=await t.value,r=Object.keys(s)??[],i=this.#s;for(const s of t.referedPatternProperties){const t=s.pattern;for(const a of r){const r=e.concat(a);if(!y.expand(t,r).includes("*")){const t=N.create(i,{patternProperty:s,patternIndexes:r,requireSetter:s.hasSetter});this.setProperty(t),s.isArray&&await this.#G(t)}}}}async expand(t,e=null){const s=this.getProperty(t);null!=s&&await this.#G(s)}#K(t){const e=(t.type===E.EXPANDED?t.patternIndexes:[]).join("\t"),s=t=>t.patternIndexes.join("\t").startsWith(e);t.referedPatternProperties.forEach((t=>{this.getExpandedPropertiesByPatternProperty(t).filter(s).forEach((t=>{this.removeProperty(t.name)}))}))}contract(t){const e=this.getProperty(t);null!=e&&this.#K(e)}testIsArray(t,e=this.#W){return e.has(`${t}.*`)}async#Q(t,e=this.#s.cache){e.delete(t);const s=this.getProperty(t);null!=s&&s.isArray&&(this.#K(s),await this.#G(s))}async updateByName(t,e=this.#s.cache){await this.#Q(t);for(const e of this.#s.dependencies.getReferedProperties(t))t!==e.name&&await this.#Q(e.name)}async updateByPatternIndexes({name:t,indexes:e}){const s=y.expand(t,e);await this.updateByName(s)}async expandAll(t=this.#W){await Promise.all(Array.from(t.entries()).map((async([t,e])=>{!t.includes("*")&&e.isArray&&this.#G(e)})))}has(t,e=this.#W){return e.has(t)}getReferedPatternPeoperties(t){const e=`${t}.`;return this.names.filter((t=>t.startsWith(e))).map((t=>this.getProperty(t))).filter((t=>t.type===E.PATTERN))}getDependencyNames(t){const e=`${t}.`;return this.names.filter((t=>t.startsWith(e)&&!t.slice(e.length).includes("."))).map((t=>this.getProperty(t))).filter((t=>t.type===E.PATTERN||E.PLAIN)).map((t=>t.name))}getExpandedPropertiesByPatternProperty(t){return this.values.filter((t=>t.type===E.EXPANDED)).filter((e=>e.patternProperty===t))}clearStatus(){return this.values.forEach((t=>t.clearStatus()))}get isUpdate(){return this.values.some((t=>t.isUpdate||t.isNew))}}class B{#Z=[];#s;constructor(t){this.#s=t}get queue(){return this.#Z}async notify(t,e=[]){this.#Z.push({name:t,indexes:e}),await this.#s.properties.updateByPatternIndexes({name:t,indexes:e})}clear(){this.#Z.splice(0)}}class D{#J=new Map;#s;constructor(t){this.#s=t}has(t){return this.#J.has(t)}get(t){return this.#J.get(t)}set(t,e){return this.#J.set(t,e),e instanceof Promise&&e.then((e=>this.#J.set(t,e))),e}delete(t){this.#J.delete(t)}}class ${#Y;#tt;#et;#a;#st;#rt;#it;#at={binds:[],loops:[]};#nt=[];#ot=[];#f=[];#ct=[];#lt;#pt;#J;#dt;#ht;#k;#N;#ut;#A;#mt;#yt;constructor(t,e){this.#k=t,this.#Y=e}build(){this.#et=new x(this),this.#st=u,this.#rt=new b(this),this.#it=new P(this),this.#lt=new R(this),this.#pt=new B(this),this.#J=new D(this),this.#dt=e,this.#ht=r.root,this.#N=f,this.#ut=g,this.#A=t.data,this.#mt=w}get parentElement(){return this.#Y}get rootElement(){return this.#tt}get view(){return this.#et}get viewModel(){return this.#a}get viewBuilder(){return this.#st}get viewUpdater(){return this.#rt}get dependencies(){return this.#it}get bindTree(){return this.#at}get allBinds(){return this.#nt}get allLoops(){return this.#ot}get indexesStack(){return this.#ct}get indexes(){return this.#ct[this.#ct.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#f}get currentLoop(){return this.#f[this.#f.length-1]}get properties(){return this.#lt}get notifier(){return this.#pt}get cache(){return this.#J}get context(){return this}get filter(){return this.#dt}get rootBlock(){return this.#ht}get block(){return this.#k}get eventHandler(){return this.#N}get initializer(){return this.#ut}get data(){return this.#A}get dataReflecter(){return this.#mt}get template(){return this.#yt.template}get module(){return this.#yt}get bindRules(){return this.#yt.bindRules}get dependencyRules(){return this.#yt.dependencyRules}set module(t){this.#yt=t,this.#a=void 0!==t.viewModel?t.viewModel:void 0!==t.AppViewModel?Reflect.construct(t.AppViewModel,[]):{},this.#tt=t.template.content.cloneNode(!0);const e=t?.context??t?._;null!=e&&this.reflect(e,t.dialog)}set rootElement(t){this.#tt=t}pushIndexes(t,e){this.#ct.push(t);try{return e()}finally{this.#ct.pop()}}pushLoop({loop:t,key:e},s){this.#f.push({loop:t,key:e});try{return s()}finally{this.#f.pop()}}getPathInfo(t,e=t,s=this.currentLoop?.loop,r=this.currentLoop?.key,i=this.indexes??[]){return"."===t[0]?"."===t?{path:`${s.path}.${r}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${r}.${t}`,pattern:`${s.pattern}.*.${t}`}:{path:y.expand(e,i),pattern:e}}setBindTree({binds:t,loops:e},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...t),s.loops.push(...e)}buildBinds(t=this.bindTree,e=this.allBinds,s=this.allLoops){e.splice(0),s.splice(0);const r=t=>e.push(t),i=t=>s.push(t);t.binds.forEach(r),t.loops.forEach(i);const a=t=>{t.children.forEach((t=>{t.binds.forEach(r),t.loops.forEach(i),t.loops.forEach(a)}))};t.loops.forEach(a)}reflect(t,e){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([e,s])=>{if(null!=s?.get){const r={configurable:!0,enumerable:!0,get:(...t)=>Reflect.apply(s.get,this,t)};Object.defineProperty(t,e,r)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postProcess","postProcess"]].forEach((([e,s])=>{const r={configurable:!0,enumerable:!1,value:"AsyncFunction"===e.constructor.name?async(...t)=>Reflect.apply(this[e],this,t):(...t)=>Reflect.apply(this[e],this,t)};Object.defineProperty(t,s,r)})),null!=e){this.$closeDialog=function(t){e.closeDialog(t)};const s={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$closeDialog,this,t)};Object.defineProperty(t,"closeDialog",s),this.$cancelDialog=function(){e.cancelDialog()};const r={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$cancelDialog,this,t)};Object.defineProperty(t,"cancelDialog",r)}}$notify(t,e=[]){this.notifier.notify(t,e)}$postProcess(t){this.viewUpdater.registPostProcess(t)}async $notifyAll(t,e=[]){this.rootBlock.notifyAll(t,e,this.block)}async $inquiryAll(t,e,s){this.$postProcess((()=>this.rootBlock.inquiryAll(t,e,s,this.block)))}async $openDialog(t,e={}){return m.open(t,e)}}const T="--bind-",C="--bind-class-";class O{dom={selector:""};viewModel={};filters=[];static#ft(t,e,s,r){const i=new O;return i.dom.selector=t,i.dom.property=e,i.viewModel.property=s,i.filters.push(...r),i}static#gt(t,e){const s=new O;return s.dom.selector=t,s.dom.event=e,s}static#wt(t,e){const s=new O;return s.dom.selector=t,s.viewModel.property=e,s}static build(t){const e=[];for(let s=0;s<t.style.length;s++){const r=t.style[s],i=t.style.getPropertyValue(r).trim();if("--events"===r)for(const s of i.split(",")){const r=O.#gt(t.selectorText,s);e.push(r)}else if("--loop"===r){const s=O.#wt(t.selectorText,i);e.push(s)}else if(r.startsWith(C)){const s=i.split("|"),a=s.shift(),n=s,o=O.#ft(t.selectorText,"class."+r.slice(C.length),a,n);e.push(o)}else if(r.startsWith(T)){const s=i.split("|"),a=s.shift(),n=s,o=O.#ft(t.selectorText,r.slice(T.length).replaceAll("-","."),a,n);e.push(o)}}return e}}class S{static spaPath;static filterPath;static localFilter;static setOptions(t,e){this.spaPath=e.spaPath??`${t}-spa`,this.localFilter=e.localFilter??!1,this.filterPath=this.localFilter?e.filterPath??`${this.spaPath}/module/filter`:null}}class L{viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;static async load(t,e,s=S.spaPath,r=new L){const i=await this.loadScript(t,s);if(Object.assign(r,i?.default??{}),void 0===r.html){const e=await this.loadHtml(t,s);Object.assign(r,{html:e})}if(void 0===r.css){const e=await this.loadCss(t,s);Object.assign(r,{css:e})}if(e&&void 0===r.bindCss&&void 0===r.bindRules){const e=await this.loadBindCss(t,s);Object.assign(r,{bindCss:e})}const a=this.buildTemplate(t,r.html,r.css);if(Object.assign(r,{template:a}),void 0===r.bindRules&&void 0!==r.bindCss){const t=this.buildBindRules(r.bindCss);Object.assign(r,{bindRules:t})}return void 0===r.dependencyRules&&(r.dependencyRules=[]),void 0===r.bindRules&&(r.bindRules=[]),r}static async loadScript(t,e=S.spaPath){const s=e.startsWith("https://")||e.startsWith("http://"),r=document.baseURI.lastIndexOf("/"),i=r>=0?document.baseURI.slice(0,r+1):"";return import(s?`${e}/module/${t}.js`:`${i}${e}/module/${t}.js`).catch((t=>{throw console.error(t),t}))}static async loadHtml(t,e=S.spaPath){return fetch(`${e}/html/${t}.html`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadCss(t,e=S.spaPath){return fetch(`${e}/css/${t}.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadBindCss(t,e=S.spaPath){return fetch(`${e}/css/${t}.bind.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(res.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static buildTemplate(t,e,s){const r=document.createElement("template");return r.innerHTML=e,void 0!==s&&(r.innerHTML="<style>\n"+s+"\n</style>\n"+r.innerHTML),r.dataset["x:block"]=t,r}static buildBindRules(t){return class{static collect(t){const e=document.createElement("div");document.body.appendChild(e);const s=e.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=t;const i=[];s.appendChild(r);const a=Array.from(s.styleSheets).find((t=>t.ownerNode===r));return Array.from(a?.cssRules??[]).map((t=>i.push(...O.build(t)))),document.body.removeChild(e),i}}.collect(t)}}class j{#M;#s;#xt=[];#bt;constructor(t=null){this.#bt=t}get context(){return this.#s}get name(){return this.#M}#vt(t,e){return this.#M=t,this.#s=new $(this,e),this.#s.build(),this.#s}async load(t,e,s){const r=this.#vt(t,e);try{const e=await L.load(t,s);e.dialog=this.#bt,r.module=e}catch(t){throw t}}async buildView(e=t.data,s=this.#s){s.properties.build(),s.dependencies.build(),s.dataReflecter.reflect(s,e,s.viewModel),await s.initializer.init(s,e),await s.properties.expandAll(),await s.view.build(),this.#xt.push(...await V.build(s.rootElement)),s.view.appear(),await s.viewUpdater.postProcess()}static async build(e,s,r,i=t.data,a=null){const n=new j(a);return await n.load(e,s,r),await n.buildView(i),n}async notifyAll(t,e,s){const r=this.#s.notifier,i=this.#s.viewModel,a=this.#s.eventHandler,n=this.#s.viewUpdater;for(const r of this.#xt)r.notifyAll(t,e,s);s!==this&&n.updateProcess((async()=>{const n=a.exec(i,"notifyAll",t,e,s),o=()=>r.notify(t);return n instanceof Promise?n.then((()=>o())):o(),n}))}async inquiryAll(t,e,s,r){const i=this.#s.viewModel,a=this.#s.eventHandler,n=this.#s.viewUpdater;for(const i of this.#xt)i.inquiryAll(t,e,s,r);r!==this&&n.updateProcess((async()=>a.exec(i,"inquiryAll",t,e,s,r)))}}class V{static async build(t){return await Promise.all((t=>Array.from(t.querySelectorAll("[data-x\\:block]")))(t).map((t=>(async t=>{const e=t.dataset["x:block"],s="x:withBindCss"in t.dataset;return j.build(e,t,s)})(t))))}}class I{#xt=[];async build(){this.#xt.push(...await V.build(document.body))}async notifyAll(t,e,s){for(const r of this.#xt)r.notifyAll(t,e,s)}async inquiryAll(t,e,s,r){for(const i of this.#xt)i.inquiryAll(t,e,s,r)}}e.regist("falsey",{forward:(t,e=[])=>!t}),e.regist("not",{forward:(t,e=[])=>!t}),e.regist("null",{forward:(t,e=[])=>null==t}),e.regist("style-display",{forward:(t,e=[])=>t?"":"none"}),e.regist("locale-string",{forward:(t,e=[])=>Number(t).toLocaleString()}),e.regist("fixed",{forward:(t,e=[])=>Number(t).toFixed(e[0]??0)}),e.regist("ge",{forward:(t,e=[])=>Number(t)>=Number(e[0]??0)}),e.regist("gt",{forward:(t,e=[])=>Number(t)>Number(e[0]??0)}),e.regist("le",{forward:(t,e=[])=>Number(t)<=Number(e[0]??0)}),e.regist("lt",{forward:(t,e=[])=>Number(t)<Number(e[0]??0)}),e.regist("number-value",{forward:(t,e=[])=>t?.toString()??"",backward:(t,e=[])=>""!==t?Number(t):null});window.datax=class{static root;static async boot(e={},i={}){t.setData(e),S.setOptions(this.getBaseName(),i),await class{static async registLocalFilter(t=S.localFilter,e=S.filterPath){if(t){const t=document.baseURI.lastIndexOf("/"),r=t>=0?document.baseURI.slice(0,t+1):"";await s(108)(`${r}${e}/regist.js`)}}}.registLocalFilter(),this.root=new I(this),r.setRoot(this.root),await this.root.build()}static getBaseName(){const t=location.href.split("/").pop();if(t){const e=t.split(".");return e.pop(),e.join(".")}return t}}})()})();