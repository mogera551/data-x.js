(()=>{var e={108:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=108,e.exports=t}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,s),a.exports}s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{static data={};static setData(e){Object.assign(this.data,e)}}class t{static filterByName=new Map;static regist(e,t){this.filterByName.set(e,t)}static forward(e,t){return e.reduce(((e,t)=>"forward"in t.filter?((e,t)=>e.filter.forward(t,e.options))(t,e):e),t)}static backward(e,t){return e.reduce(((e,t)=>"backward"in t.filter?((e,t)=>e.filter.backward(t,e.options))(t,e):e),t)}}class r{static root={};static setRoot(e){this.root=e}}class i{#e;#t;#s;#r;#i;#a;#n;#o;constructor(e,t){this.#s=e,this.#t=t}get name(){return this.#s}get data(){return this.#t}get block(){return this.#e}get root(){return this.#r}createBackLayer(e=this.#s){const t=document.createElement("div");t.dataset["x:dialog"]=e;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(e=>this.cancelDialog())),t.appendChild(s);const r=document.createElement("div");return r.style.backgroundColor="white",r.style.borderRadius=".375rem",r.style.padding="2rem",r.classList.add("fg"),r.addEventListener("click",(e=>e.stopPropagation())),s.appendChild(r),{root:t,bg:s,fg:r}}async build(e=this.#s,t=this.#t,s=!1){const{root:r,bg:i,fg:a}=this.createBackLayer(e),n=await L.create({name:e,parentElement:a,withBindCss:s,data:t,dialog:this});document.body.appendChild(r),this.#e=n,this.#r=r}static async create(e=this.#s,t=this.#t,s=!1){return new i(e,t).build()}cancelDialog(){this.#o&&this.#o()}closeDialog(e){this.#n&&this.#n(e)}async main(){return new Promise(((e,t)=>{this.#n=e,this.#o=t})).finally((()=>{this.#r.parentNode.removeChild(this.#r)}))}static async open(e,t={}){return(await i.create(e,t)).main()}}class a{name;pattern;indexes;lastName;parentName;constructor({name:e=null,pattern:t=null,indexes:s=null}){this.name=e,this.pattern=t,this.indexes=s,null==e&&null!=t&&null!=s&&(this.name=a.expand(t,s));const r=this.name.split(".");this.lastName=r.pop(),this.parentName=r.join(".")}static expand(e,t,s=t.slice()){let r=!1;const i=e.replaceAll("*",(()=>s.shift()??(r=!0,"*")));return r?null:i}static createByName(e){return new a({name:e})}static createByPatternIndexes(e,t){return new a({pattern:e,indexes:t})}}class n{static async exec(e,t,...s){const r=t[0].toUpperCase()+t.slice(1),i=`event${r}`,a=`on${r}`;if(i in e){const t=Object.getOwnPropertyDescriptor(e,i);return Reflect.apply(t.set,e,[s])}if(a in e)return e[a](...s)}}class o{static async init(e,t,s=e.viewModel,r=e.properties){for(const e of r.values){if(null==e?.init)continue;const r=e.init(t),i=r instanceof Promise?await r:r;e.name.includes(".")?s[e.name]=i:s[`__${e.name}`]=i}return n.exec(s,"init",t)}}class c{static reflect(e,t,s={}){Object.keys(t).forEach((r=>{const i=`$${r}`,a=t=>!1!==t&&e.$postProcess((()=>{e.$notify(i),e.$notifyAll(i)})),n={configurable:!1,enumerable:!0,get:()=>Reflect.get(t,r),set:e=>{const s=Reflect.set(t,r,e);return s instanceof Promise?s.then(a):a(s),s}};Object.defineProperty(s,i,n)}))}}class l{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static matchClass="class.";static matchRadio="radio";static matchCheckbox="checkbox";static getType(e){return e===this.matchRadio?this.RADIO:e===this.matchCheckbox?this.CHECKBOX:e.startsWith(this.matchClass)?this.CLASS:this.VALUE}static async getValue(e,t){const s=Object.getOwnPropertyDescriptor(e,t);return s?.get?await Reflect.apply(s.get,e,[]):e[t]}static async updateDomByValueType(e){const t=e.domProperty.split("."),s=await this.getValue(e.viewModel,e.path),r=(e,t,s,i=e.shift())=>0===e.length?t[i]!==s&&(t[i]=s):r(e,t[i],s),i=s=>r(t,e.dom,e.filter.forward(e.forwardFilters,s));s instanceof Promise?s.then((e=>i(e))):i(s)}static async updateDomByClassType(e){const t=e.domProperty.slice(this.matchClass.length),s=await this.getValue(e.viewModel,e.path),r=s=>e.filter.forward(e.forwardFilters,s)?!e.dom.classList.contains(t)&&e.dom.classList.add(t):e.dom.classList.contains(t)&&e.dom.classList.remove(t);s instanceof Promise?s.then((e=>r(e))):r(s)}static async updateDomByRadioType(e){const t=await this.getValue(e.viewModel,e.path),s=t=>e.dom.checked=e.dom.value===e.filter.forward(e.forwardFilters,t);t instanceof Promise?t.then((e=>s(e))):s(t)}static async updateDomByCheckboxType(e){const t=await this.getValue(e.viewModel,e.path),s=t=>e.dom.checked=(e.filter.forward(e.forwardFilters,t)??[]).includes(e.dom.value);t instanceof Promise?t.then((e=>s(e))):s(t)}static async setValue(e,t,s){const r=Object.getOwnPropertyDescriptor(e,t);r?.set?await Reflect.apply(r.set,e,[s]):bind.viewModel[t]=s}static async updateViewModelByValueType(e){const t=e.domProperty.split("."),s=(e,t,r=e.shift())=>0===e.length?t[r]:s(e,t[r]),r=e.filter.backward(e.backwardFilters,s(t,e.dom));await this.setValue(e.viewModel,e.path,r)}static async updateViewModelByClassType(e){const t=e.domProperty.slice(this.matchClass.length),s=e.dom.classList.contains(t);await this.setValue(e.viewModel,e.path,s)}static async updateViewModelByRadioType(e){if(e.dom.checked){const t=e.dom.value;await this.setValue(e.viewModel,e.path,t)}}static async updateViewModelByCheckboxType(e){const t=new Set(e.viewModel[e.path]??[]);e.dom.checked?t.add(e.dom.value):t.delete(e.dom.value);const s=Array.from(t);await this.setValue(e.viewModel,e.path,s)}static#c={};static#l={};static init(){this.#c[this.VALUE]=this.updateDomByValueType,this.#c[this.CLASS]=this.updateDomByClassType,this.#c[this.RADIO]=this.updateDomByRadioType,this.#c[this.CHECKBOX]=this.updateDomByCheckboxType,this.#l[this.VALUE]=this.updateViewModelByValueType,this.#l[this.CLASS]=this.updateViewModelByClassType,this.#l[this.RADIO]=this.updateViewModelByRadioType,this.#l[this.CHECKBOX]=this.updateViewModelByCheckboxType}static async updateDom(e,t=e.domPropertyType){await Reflect.apply(this.#c[t],this,[e])}static async updateViewModel(e,t=e.domPropertyType){await Reflect.apply(this.#l[t],this,[e])}}class p{#p;#d;#h;#u;#m;#y;#f;#g;#w;#x;#b;#v;constructor(e,s,r){this.#d=e,this.#h=s.dom?.property,this.#u=r.viewModel,this.#m=s.viewModel?.property,this.#y=s.inputable,this.#b=class{static parse(e){return 0==e.length?[]:e.split("|").map((e=>e.split(":"))).map((([e,s])=>({name:e,options:s?.split(";")??[],filter:t.filterByName.get(e)})))}}.parse(s?.filters.join("|"))??[],this.#v=this.#b.slice().reverse(),this.#p=r,this.#f=r.indexes?.slice()??[],this.#x=l.getType(this.#h);const{path:i,pattern:a}=r.getPathInfo(this.#m);this.#g=i,this.#w=a}get dom(){return this.#d}get domProperty(){return this.#h}get viewModel(){return this.#u}get path(){return this.#g}get pattern(){return this.#w}get domPropertyType(){return this.#x}get forwardFilters(){return this.#b}get backwardFilters(){return this.#v}get filter(){return this.#p.filter}async init(e=this.#y){e&&this.attachEvent(),await this.updateDom()}async updateDom(){await l.updateDom(this)}async#P(){await l.updateViewModel(this)}attachEvent(e=this.#d,t=this.#p,s=t.view){e.addEventListener("input",(e=>s.updateProcess(t,(()=>this.#P()))))}}l.init();class d{nodes=[];loops;binds;key}class h{#d;#m;#E=[];#p;#g;#w;#N;constructor(e,t,s){this.#d=e,this.#m=t.viewModel?.property,this.#p=s;const{path:r,pattern:i}=s.getPathInfo(this.#m);this.#g=r,this.#w=i,this.#N=s.loopStack.slice()}get dom(){return this.#d}get path(){return this.#g}get pattern(){return this.#w}get children(){return this.#E}async#k(e,t=this.#d,s=this.#p){return s.pushLoop({loop:this,key:e},(()=>{const r=s.loopStack.map((e=>e.key));return s.pushIndexes(r,(async()=>{const r=document.createDocumentFragment(),i=new d,a=t.content.cloneNode(!0),{binds:n,loops:o}=await s.view.createBindTree(s,a);return Object.assign(i,{key:e,binds:n,loops:o}),r.appendChild(a),i.nodes.push(...Array.from(r.childNodes)),i}))}))}async expand(e=this.#p.viewModel,t=this.#g,s=this.#E,r=this.#d){const i=await e[t];for(const e of Object.keys(i))s.push(await this.#k(e));const a=document.createDocumentFragment(),n=e=>a.appendChild(e);s.forEach((e=>e.nodes.forEach(n))),r.after(a)}#A(e){const t=this.#N.slice(),s=t=>{if(0===t.length)return e();const r=t.pop();return context.pushLoop(r,s)};return s(t)}#M(e){e.loops.forEach((e=>e.contract())),e.nodes.forEach((e=>e.parentNode.removeChild(e)))}contract(e=this.#E){e.forEach((e=>this.#M(e))),e.splice(0)}async update(){this.contract(),await this.#A((async()=>this.expand()))}}class u{#d;#p;#R;#f;#B;constructor(e,t,s){this.#d=e,this.#R=t.dom?.event,this.#p=s,this.#f=s.indexes?.slice()??[],this.#B=this.#D()}get event(){return this.#R}get dom(){return this.#d}init(){this.#T()}#D(){const e=this.#d;return`${this.#R.toLowerCase()}${t="x:name"in e?.dataset?e?.dataset["x:name"]:e?.name?.length>0?e.name:e.tagName.toLowerCase(),t?.length>0?t.at(0).toUpperCase()+t.slice(1):""}`;var t}async#$(e,t=this.#p.viewModel,s=this.#p.eventHandler,r=this.#B,i=this.#f,a=this.#p){return a.pushIndexes(i,(()=>s.exec(t,r,e,...i)))}#T(e=this.#d,t=this.#R,s=this.#p,r=s.view){e.addEventListener(t,(e=>r.updateProcess(s,(()=>this.#$(e)))))}}const m=":not([data-x\\:processed])",y="x:ignore",f=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((e=>`${e}${m}`)).join(","),g=["input","textarea","select","button"].map((e=>`${e}${m}`)).join(",");class w{static async createBindTree(e,t,s=e.bindRules){const{loops:r,binds:i,events:a}=class{static inputable(e){return"INPUT"===e.tagName&&"button"!==e.type||"TEXTAREA"===e.tagName||"SELECT"===e.tagName}static testRadio(e){return"INPUT"===e.tagName&&"radio"===e.type}static testCheckbox(e){return"INPUT"===e.tagName&&"checkbox"===e.type}static parsePropertyName(e){const t=e.split("|");return{property:t.shift(),filters:t}}static parseDataBind(e,t,s=this.inputable(e),r=this.testRadio(e),i=this.testCheckbox(e)){const a=(e,t)=>{if(e.includes("=")){const[a,n]=e.split("="),{property:o,filters:c}=this.parsePropertyName(n);t.dom.property=a,t.viewModel.property=o,t.filters=c;const l=s?r?"radio":i?"checkbox":"value":"";t.inputable=l===a}else{const{property:a,filters:n}=this.parsePropertyName(e);t.dom.property=s?r?"radio":i?"checkbox":"value":"textContent",t.viewModel.property=a,t.filters=n,t.inputable=s}return t},n=t.split(",");if(1==n.length)return[a(t,{dom:{},viewModel:{},filters:[]})];{const e=n.map((e=>a(e,{dom:{},viewModel:{},filters:[]})));return e}}static collectByAttribute(e,t,s=[],r=[],i=[]){return Array.from(t.querySelectorAll(f)).forEach((t=>{if(y in t.dataset)return;const a=t.dataset["x:processing"]?.split(",")??[];if("x:loop"in t.dataset){if("TEMPLATE"!==t.tagName)return;if(a.includes("loop"))return;const s={dom:{},viewModel:{property:t.dataset["x:loop"]},filters:[]};r.push(new h(t,s,e)),a.push("loop")}else{if("x:bind"in t.dataset){if(a.includes("bind"))return;s.push(...this.parseDataBind(t,t.dataset["x:bind"]).map((s=>new p(t,s,e)))),a.push("bind")}if("x:events"in t.dataset){if(a.includes("events"))return;t.dataset["x:events"].split(",").forEach((s=>{const r={dom:{event:s},viewModel:{},filters:[]};i.push(new u(t,r,e))})),a.push("events")}}t.dataset["x:processing"]=a.join(",")})),{binds:s,loops:r,events:i}}static collectByImplicit(e,t,s=[],r=[],i=[]){return Array.from(t.querySelectorAll(g)).forEach((t=>{if(y in t.dataset)return;const r=t.dataset["x:processing"]?.split(",")??[],a=this.testRadio(t),n=this.testCheckbox(t),o={dom:{},viewModel:{},filters:[]};if("BUTTON"===t.tagName||"INPUT"===t.tagName&&"button"===t.type){if(r.includes("events"))return;o.dom.event="click",i.push(new u(t,o,e)),r.push("events")}else{if(r.includes("bind"))return;const{property:i,filters:c}=this.parsePropertyName(t.name);o.dom.property=a?"radio":n?"checkbox":"value",o.viewModel.property=i,o.filters=c,o.inputable=!0,s.push(new p(t,o,e)),r.push("bind")}t.dataset["x:processing"]=r.join(",")})),{binds:s,loops:r,events:i}}static collectByRule(e,t,s,r=[],i=[],a=[]){const n=new Map;return s.forEach((e=>{!n.has(e.dom.selector)&&n.set(e.dom.selector,[]),n.get(e.dom.selector).push(e)})),Array.from(n.keys()).forEach((s=>{t.querySelectorAll(`${s}${m}`).forEach((t=>{if(y in t.dataset)return;const o=this.inputable(t),c=t.dataset["x:processing"]?.split(",")??[],l=c.slice();n.get(s).forEach((s=>{const n=JSON.parse(JSON.stringify(s));if("TEMPLATE"===t.tagName){if(c.includes("loop"))return;((t,s)=>{i.push(new h(s,t,e))})(n,t),l.push("loop")}else if("event"in n.dom){if(c.includes("events"))return;((t,s)=>{a.push(new u(s,t,e))})(n,t),l.push("events")}else{if(c.includes("bind"))return;n.inputable=o,((t,s)=>{r.push(new p(s,t,e))})(n,t),l.push("bind")}})),t.dataset["x:processing"]=l.join(",")}))})),{loops:i,binds:r,events:a}}static collect(e,t,s=[]){const r=[],i=[],a=[];return this.collectByRule(e,t,s,r,i,a),this.collectByAttribute(e,t,r,i,a),this.collectByImplicit(e,t,r,i,a),r.forEach((e=>e.dom.dataset["x:processed"]="")),i.forEach((e=>e.dom.dataset["x:processed"]="")),a.forEach((e=>e.dom.dataset["x:processed"]="")),Array.from(t.querySelectorAll("[data-x\\:processing]")).forEach((e=>{e.removeAttribute("data-x:processing")})),{loops:i,binds:r,events:a}}}.collect(e,t,s);return await Promise.all(r.map((e=>e.expand()))),await Promise.all(i.map((e=>e.init()))),a.forEach((e=>e.init())),{loops:r,binds:i,events:a}}static async build(e,t=e.rootElement){const s=await this.createBindTree(e,t);e.setBindTree(s),e.buildBinds()}static appear(e,t=e.fragment,s=e.parentElement){const r=s.attachShadow({mode:"open"});r.appendChild(t),e.rootElement=r}static attachTo(e,t){e.parentElement=t,this.appear(e)}static async updateDom(e,t=e.notifier,s=e.allBinds,r=e.allLoops,i=e.dependencies){const n=[];t.queue.forEach((({name:e,indexes:t})=>n.push(...i.getReferedProperties(e,t),(({name:e,indexes:t})=>({name:a.expand(e,t),pattern:e,indexes:t}))({name:e,indexes:t}))));const o=new Set(n.map((e=>e.name)));await Promise.all(r.filter((e=>o.has(e.path))).map((e=>e.update()))),await Promise.all(s.filter((e=>o.has(e.path))).map((e=>e.updateDom())))}static async updateProcess(e,t,s=e.notifier,r=e.properties,i=e.postProcess){i.clear(),s.clear(),r.clearStatus(),await t(),await this.updateDom(e),r.isUpdate&&e.buildBinds(),await i.exec()}}class x{parentNodes=[];name;func;childNodes=[];constructor(e){this.name=e}}class b{#C=new Map;#O;#p;constructor(e){this.#p=e}get map(){return this.#C}build(e=this.#C,t=this.#p.dependencyRules){e.clear(),this.#O=this.#p.dependencyRules.slice(),t.forEach((([e,t,s])=>this.add(e,t,s))),this.implicitDependency()}implicitDependency(e=this.#p.properties){for(const t of e.names)e.getDependencyNames(t).forEach((e=>this.add(e,[t])))}add(e,t,s,r=this.#C){r.has(e)||r.set(e,new x(e));const i=r.get(e);i.func=s,t.forEach((e=>{r.has(e)||r.set(e,new x(e));const t=r.get(e);i.childNodes.push(t),t.parentNodes.push(i)}))}getReferedProperties(e,t,s=this.#C){const r=s.get(e),i=t??[],n=(e,t)=>{if(null==e)return t;const s=a.expand(e.name,i);return null!==s&&t.push({name:s,pattern:e.name,indexes:e.func?e.func(i):i}),e.parentNodes.forEach((e=>{t=n(e,t)})),t},o=n(r,[]),c=[];return o.forEach((e=>{const t=new Set(c.map((e=>e.name)));t.has(e)||c.push(e)})),c}}class v{static PLAIN=1;static PATTERN=2;static EXPANDED=3}class P{#s;#w;#S;#L;#p;#j;#I;#V;#q=!0;#U=!1;#F;constructor(e,t,s,r,i,a){this.#p=e,this.#V=t,this.#s=s,this.#w=r,this.#j=i,this.#I=a;const n=s.split(".");this.#S=n.pop(),this.#L=n.join(".")}get context(){return this.#p}get name(){return this.#s}get pathParent(){return this.#L}get pathLastElement(){return this.#S}get desc(){return this.#j}get init(){return this.#I}get type(){return this.#V}get pattern(){return this.#w}get isArray(){return this.testIsArray()}get referedPatternProperties(){return this.getReferedPatternPeoperties()}get value(){return this.getValue()}get isNew(){return this.#q}get isUpdate(){return this.#U}get hasSetter(){return null!=this.desc.set}set desc(e){this.#j=e,Object.defineProperty(this.#p.viewModel,this.#s,e)}set isNew(e){this.#q=e}set isUpdate(e){this.#U=e}testIsArray(){return!1}getReferedPatternPeoperties(){return[]}getValue(){throw new Error("")}clearStatus(){this.isNew=!1,this.isUpdate=!1}static create(e,{name:t=null,desc:s={},patternProperty:r=null,patternIndexes:i=[],requireSetter:a=null,init:n=null}){return null!=r?new k(e,r,i):(null===a&&(a="set"in s),t.includes("*")?new N(e,t,s,a,n):new E(e,t,s,a,n))}}class E extends P{constructor(e,t,s,r,i){super(e,v.PLAIN,t,t,s,i),this.#H(r)}testIsArray(e=this.name,t=this.context.properties){return t.testIsArray(e)}#H(e){this.context.viewModel;const t=this.context.notifier,s=this.context.cache,r=this.pathParent,i=this.pathLastElement,a=this.name.includes("."),n=`__${this.name}`,o=this.name,c=this.desc,l=a?function(e){const a=c.set?Reflect.apply(c.set,this,[e]):this[r][i]=e;return this.isUpdate=!0,s.delete(o),(async()=>{!1!==await a&&await t.notify(o)})()}:function(e){const r=c.set?Reflect.apply(c.set,this,[e]):this[n]=e;return this.isUpdate=!0,s.delete(o),(async()=>{!1!==await r&&await t.notify(o)})()},p={configurable:!0,enumerable:!0,get:a?function(){return s.has(o)?s.get(o):s.set(o,c.get?Reflect.apply(c.get,this,[]):this[r]?.[i])}:function(){return s.has(o)?s.get(o):s.set(o,c.get?Reflect.apply(c.get,this,[]):this[n])}};e&&(p.set=l),this.desc=p}getReferedPatternPeoperties(e=this.context.properties,t=this.name){return e.getReferedPatternPeoperties(t)}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class N extends P{constructor(e,t,s,r,i){super(e,v.PATTERN,t,t,s),this.#H(r)}testIsArray(e=this.pattern,t=this.context.properties){return t.testIsArray(e)}#H(e){const t=this.context,s=(this.context.viewModel,this.pathParent),r=this.pathLastElement,i=this.pattern.split("").filter((e=>"*"===e)).length,a=this.desc,n={configurable:!0,enumerable:!0,get:a.get?a.get:function(){const e="*"===r?(t?.indexes??[]).at(i-1):r;return this[s]?.[e]}};e&&(n.set=a.set?a.set:function(e){const a="*"===r?(t?.indexes??[]).at(i-1):r;this[s][a]=e,this.isUpdate=!0}),this.desc=n}getReferedPatternPeoperties(e=this.context.properties,t=this.pattern){return e.getReferedPatternPeoperties(t)}}class k extends P{#_;#X;constructor(e,t,s){const r=a.expand(t.pattern,s);super(e,v.EXPANDED,r,t.pattern,null,t.init),this.#_=t,this.#X=s.slice(),this.#H()}get patternProperty(){return this.#_}get patternIndexes(){return this.#X}#H(){const e=this.context,t=this.context.cache,s=this.context.viewModel,r=this.context.notifier,i=(this.context.properties,this.patternProperty),a=this.patternIndexes,n=this.name,o={configurable:!0,enumerable:!0,get:()=>e.pushIndexes(a,(()=>t.has(n)?t.get(n):t.set(n,s[i.pattern])))};null!=i.desc.set&&(o.set=o=>e.pushIndexes(a,(()=>{const e=Reflect.apply(i.desc.set,s,[o]);return this.isUpdate=!0,t.delete(n),(async()=>{!1!==await e&&await r.notify(i.pattern,a)})()}))),this.desc=o}testIsArray(e=this.patternProperty.pattern,t=this.context.properties){return t.testIsArray(e)}getReferedPatternPeoperties(e=this.patternProperty){return e.referedPatternProperties}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class A{#p;#z=new Map;#U=!1;constructor(e){this.#p=e}get names(){return Array.from(this.#z.keys())}get values(){return Array.from(this.#z.values())}build(e=this.#p,t=this.#p.viewModel){this.#z.clear();const s=Object.getPrototypeOf(t),r=e=>({configurable:!0,enumerable:!1,writable:!0,value:e?.value}),i=e=>/^\@\@?([a-zA-Z0-9_\.\*])+(#(get|set|init))?$/.test(e),a=e=>/^#(event[a-zA-Z0-9_]+)$/.test(e),n=e=>/^__([a-zA-Z0-9_])+$/.test(e),o=new Map;[t].forEach((e=>{Object.entries(Object.getOwnPropertyDescriptors(e)).forEach((([e,s])=>{if(i(e)||n(e)||a(e))if(n(e))Reflect.defineProperty(t,e,r(s));else if(i(e)){const[r,i]=e.includes("#")?e.split("#"):[e,null],a="@"===e.at(1),n=a?r.slice(2):r.slice(1),c=o.has(n)?o.get(n):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};c.baseName=c.baseName??n,c.originalName=c.originalName??r,c.privateName=c.privateName??`__${n}`,c.get="get"===i?s.value:c.get,c.set="set"===i?s.value:c.set,c.init="init"===i?s.value:c.init,c.requireGet=null==i||c.requireGet,c.requireSet=a,c.privateValue=null==i?s.value:c.privateValue,o.set(n,c),Reflect.deleteProperty(t,e)}else if(a(e)){const r=e,i="set",a=!0,n=r.slice(1),c=o.has(n)?o.get(n):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};c.baseName=c.baseName??n,c.originalName=c.originalName??r,c.privateName=c.privateName??`__${n}`,c.set="set"===i?s.value:c.set,c.requireGet=null==i||c.requireGet,c.requireSet=a,c.privateValue=null==i?s.value:c.privateValue,o.set(n,c),Reflect.deleteProperty(t,e)}}))})),Array.from(o.entries()).forEach((([i,a])=>{a.privateName in t||a.baseName.includes(".")||Reflect.defineProperty(t,a.privateName,r({value:a.privateValue}));const n=Object.getOwnPropertyDescriptor(t,i)??Object.getOwnPropertyDescriptor(s,i)??{};n.get=null!=a.get?a.get:n.get??null,n.set=null!=a.set?a.set:n.set??null;const o=a.init,c=a.requireSet,l=i;this.setProperty(P.create(e,{name:l,desc:n,requireSetter:c,init:o}))})),[t,s].forEach((t=>{Object.entries(Object.getOwnPropertyDescriptors(t)).forEach((([t,s])=>{this.#z.has(t)||(null!=s?.get?this.setProperty(P.create(e,{name:t,desc:s,requireSetter:null!=s?.set})):null!=s?.set&&this.setProperty(P.create(e,{name:t,desc:s,requireSetter:!0})))}))}));const c=[];for(const e of this.#z.keys()){const t=[],s=e.split("."),r=[];s.forEach((e=>{r.push(e),t.push(r.join("."))})),c.push(...t)}Array.from(new Set(c)).filter((e=>!this.#z.has(e))).forEach((r=>{const i=Object.getOwnPropertyDescriptor(t,r)??Object.getOwnPropertyDescriptor(s,r)??{};this.setProperty(P.create(e,{name:r,desc:i,requireSetter:!0}))})),Object.defineProperty(t,"$context",{get:()=>e})}removeProperty(e,t=this.#p.viewModel,s=this.#p.cache,r=this.#z){delete t[e],r.delete(e),s.delete(e)}getProperty(e,t=this.#z){return t.get(e)}setProperty(e,t=this.#z){t.set(e.name,e)}async#W(e){const t=e.type===v.EXPANDED?e.patternIndexes:[],s=await e.value,r=Object.keys(s)??[],i=this.#p;for(const s of e.referedPatternProperties){const e=s.pattern;for(const n of r){const r=t.concat(n);if(!a.expand(e,r).includes("*")){const e=P.create(i,{patternProperty:s,patternIndexes:r,requireSetter:s.hasSetter});this.setProperty(e),s.isArray&&await this.#W(e)}}}}async expand(e,t=null){const s=this.getProperty(e);null!=s&&await this.#W(s)}#G(e){const t=(e.type===v.EXPANDED?e.patternIndexes:[]).join("\t"),s=e=>e.patternIndexes.join("\t").startsWith(t);e.referedPatternProperties.forEach((e=>{this.getExpandedPropertiesByPatternProperty(e).filter(s).forEach((e=>{this.removeProperty(e.name)}))}))}contract(e){const t=this.getProperty(e);null!=t&&this.#G(t)}testIsArray(e,t=this.#z){return t.has(`${e}.*`)}async#K(e,t=this.#p.cache){t.delete(e);const s=this.getProperty(e);null!=s&&s.isArray&&(this.#G(s),await this.#W(s))}async updateByName(e,t=this.#p.cache){await this.#K(e);for(const t of this.#p.dependencies.getReferedProperties(e))e!==t.name&&await this.#K(t.name)}async updateByPatternIndexes({name:e,indexes:t}){const s=a.expand(e,t);await this.updateByName(s)}async expandAll(e=this.#z){await Promise.all(Array.from(e.entries()).map((async([e,t])=>{!e.includes("*")&&t.isArray&&this.#W(t)})))}has(e,t=this.#z){return t.has(e)}getReferedPatternPeoperties(e){const t=`${e}.`;return this.names.filter((e=>e.startsWith(t))).map((e=>this.getProperty(e))).filter((e=>e.type===v.PATTERN))}getDependencyNames(e){const t=`${e}.`;return this.names.filter((e=>e.startsWith(t)&&!e.slice(t.length).includes("."))).map((e=>this.getProperty(e))).filter((e=>e.type===v.PATTERN||v.PLAIN)).map((e=>e.name))}getExpandedPropertiesByPatternProperty(e){return this.values.filter((e=>e.type===v.EXPANDED)).filter((t=>t.patternProperty===e))}clearStatus(){return this.values.forEach((e=>e.clearStatus()))}get isUpdate(){return this.values.some((e=>e.isUpdate||e.isNew))}}class M{#Z=[];#p;constructor(e){this.#p=e}get queue(){return this.#Z}async notify(e,t=[],s=this.#Z,r=this.#p.properties){s.push({name:e,indexes:t}),await r.updateByPatternIndexes({name:e,indexes:t})}clear(e=this.#Z){e.splice(0)}}class R{#J=new Map;#p;constructor(e){this.#p=e}has(e){return this.#J.has(e)}get(e){return this.#J.get(e)}set(e,t){return this.#J.set(e,t),t instanceof Promise&&t.then((t=>this.#J.set(e,t))),t}delete(e){this.#J.delete(e)}}class B{#p;#Z=[];constructor(e){this.#p=e}regist(e,t=this.#Z){t.push(e)}exec(e=this.#p,t=this.#Z,s=e.view){const r=t.slice(),i=[];return r.length>0&&s.updateProcess(e,(()=>{for(const e of r)i.push(e())})),Promise.all(i)}clear(e=this.#Z){e.splice(0)}}class D{#Q;#Y;#ee;#te;#u;#se;#re;#ie={binds:[],loops:[]};#ae=[];#ne=[];#N=[];#oe=[];#ce;#le;#J;#pe;#de;#e;#$;#he;#t;#ue;#me;constructor(e,t){this.#e=e,this.#Q=t}build(){this.#te=w,this.#se=new B(this),this.#re=new b(this),this.#ce=new A(this),this.#le=new M(this),this.#J=new R(this),this.#pe=t,this.#de=r.root,this.#$=n,this.#he=o,this.#t=e.data,this.#ue=c}get parentElement(){return this.#Q}get fragment(){return this.#Y}get rootElement(){return this.#ee??this.#Y}get view(){return this.#te}get viewModel(){return this.#u}get postProcess(){return this.#se}get dependencies(){return this.#re}get bindTree(){return this.#ie}get allBinds(){return this.#ae}get allLoops(){return this.#ne}get indexesStack(){return this.#oe}get indexes(){return this.#oe[this.#oe.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#N}get currentLoop(){return this.#N[this.#N.length-1]}get properties(){return this.#ce}get notifier(){return this.#le}get cache(){return this.#J}get context(){return this}get filter(){return this.#pe}get rootBlock(){return this.#de}get block(){return this.#e}get eventHandler(){return this.#$}get initializer(){return this.#he}get data(){return this.#t}get dataReflecter(){return this.#ue}get template(){return this.#me.template}get module(){return this.#me}get bindRules(){return this.#me.bindRules}get dependencyRules(){return this.#me.dependencyRules}set module(e){this.#me=e,this.#u=void 0!==e.viewModel?e.viewModel:void 0!==e.AppViewModel?Reflect.construct(e.AppViewModel,[]):{},this.#Y=e.template.content.cloneNode(!0);const t=e?.context??e?._;null!=t&&this.reflect(t,e.dialog)}set rootElement(e){this.#ee=e}set parentElement(e){this.#Q=e}pushIndexes(e,t){this.#oe.push(e);try{return t()}finally{this.#oe.pop()}}pushLoop({loop:e,key:t},s){this.#N.push({loop:e,key:t});try{return s()}finally{this.#N.pop()}}getPathInfo(e,t=e,s=this.currentLoop?.loop,r=this.currentLoop?.key,i=this.indexes??[]){return"."===e[0]?"."===e?{path:`${s.path}.${r}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${r}.${e}`,pattern:`${s.pattern}.*.${e}`}:{path:a.expand(t,i),pattern:t}}setBindTree({binds:e,loops:t},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...e),s.loops.push(...t)}buildBinds(e=this.bindTree,t=this.allBinds,s=this.allLoops){t.splice(0),s.splice(0);const r=e=>t.push(e),i=e=>s.push(e);e.binds.forEach(r),e.loops.forEach(i);const a=e=>{e.children.forEach((e=>{e.binds.forEach(r),e.loops.forEach(i),e.loops.forEach(a)}))};e.loops.forEach(a)}reflect(e,t){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([t,s])=>{if(null!=s?.get){const r={configurable:!0,enumerable:!0,get:(...e)=>Reflect.apply(s.get,this,e)};Object.defineProperty(e,t,r)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postProcess","postProcess"]].forEach((([t,s])=>{const r={configurable:!0,enumerable:!1,value:"AsyncFunction"===t.constructor.name?async(...e)=>Reflect.apply(this[t],this,e):(...e)=>Reflect.apply(this[t],this,e)};Object.defineProperty(e,s,r)})),null!=t){this.$closeDialog=function(e){t.closeDialog(e)};const s={configurable:!0,enumerable:!1,value:(...e)=>Reflect.apply(this.$closeDialog,this,e)};Object.defineProperty(e,"closeDialog",s),this.$cancelDialog=function(){t.cancelDialog()};const r={configurable:!0,enumerable:!1,value:(...e)=>Reflect.apply(this.$cancelDialog,this,e)};Object.defineProperty(e,"cancelDialog",r)}}$notify(e,t=[]){this.notifier.notify(e,t)}$postProcess(e){this.postProcess.regist(e)}async $notifyAll(e,t=[]){this.rootBlock.notifyAll(e,t,this.block)}async $inquiryAll(e,t,s){this.$postProcess((()=>this.rootBlock.inquiryAll(e,t,s,this.block)))}async $openDialog(e,t={}){return i.open(e,t)}}const T="--bind-",$="--bind-class-";class C{dom={selector:""};viewModel={};filters=[];static#ye(e,t,s,r){const i=new C;return i.dom.selector=e,i.dom.property=t,i.viewModel.property=s,i.filters.push(...r),i}static#fe(e,t){const s=new C;return s.dom.selector=e,s.dom.event=t,s}static#ge(e,t){const s=new C;return s.dom.selector=e,s.viewModel.property=t,s}static build(e){const t=[];for(let s=0;s<e.style.length;s++){const r=e.style[s],i=e.style.getPropertyValue(r).trim();if("--events"===r)for(const s of i.split(",")){const r=C.#fe(e.selectorText,s);t.push(r)}else if("--loop"===r){const s=C.#ge(e.selectorText,i);t.push(s)}else if(r.startsWith($)){const s=i.split("|"),a=s.shift(),n=s,o=C.#ye(e.selectorText,"class."+r.slice($.length),a,n);t.push(o)}else if(r.startsWith(T)){const s=i.split("|"),a=s.shift(),n=s,o=C.#ye(e.selectorText,r.slice(T.length).replaceAll("-","."),a,n);t.push(o)}}return t}}class O{static spaPath;static filterPath;static localFilter;static setOptions(e,t){this.spaPath=t.spaPath??`${e}-spa`,this.localFilter=t.localFilter??!1,this.filterPath=this.localFilter?t.filterPath??`${this.spaPath}/module/filter`:null}}class S{viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;static async load(e,t,s=O.spaPath,r=new S){const i=await this.loadScript(e,s);if(Object.assign(r,i?.default??{}),void 0===r.html){const t=await this.loadHtml(e,s);Object.assign(r,{html:t})}if(void 0===r.css){const t=await this.loadCss(e,s);Object.assign(r,{css:t})}if(t&&void 0===r.bindCss&&void 0===r.bindRules){const t=await this.loadBindCss(e,s);Object.assign(r,{bindCss:t})}const a=this.buildTemplate(e,r.html,r.css);if(Object.assign(r,{template:a}),void 0===r.bindRules&&void 0!==r.bindCss){const e=this.buildBindRules(r.bindCss);Object.assign(r,{bindRules:e})}return void 0===r.dependencyRules&&(r.dependencyRules=[]),void 0===r.bindRules&&(r.bindRules=[]),r}static async loadScript(e,t=O.spaPath){const s=t.startsWith("https://")||t.startsWith("http://"),r=document.baseURI.lastIndexOf("/"),i=r>=0?document.baseURI.slice(0,r+1):"";return import(s?`${t}/module/${e}.js`:`${i}${t}/module/${e}.js`).catch((e=>{throw console.error(e),e}))}static async loadHtml(e,t=O.spaPath){return fetch(`${t}/html/${e}.html`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(e.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static async loadCss(e,t=O.spaPath){return fetch(`${t}/css/${e}.css`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(e.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static async loadBindCss(e,t=O.spaPath){return fetch(`${t}/css/${e}.bind.css`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(res.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static buildTemplate(e,t,s){const r=document.createElement("template");return r.innerHTML=t,void 0!==s&&(r.innerHTML="<style>\n"+s+"\n</style>\n"+r.innerHTML),r.dataset["x:block"]=e,r}static buildBindRules(e){return class{static collect(e){if(null==e||""===e)return[];const t=document.createElement("div");document.body.appendChild(t);const s=t.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=e;const i=[];s.appendChild(r);const a=Array.from(s.styleSheets).find((e=>e.ownerNode===r));return Array.from(a?.cssRules??[]).map((e=>i.push(...C.build(e)))),document.body.removeChild(t),i}}.collect(e)}}class L{#s;#p;#we=[];#xe;constructor(e=null){this.#xe=e}get context(){return this.#p}get name(){return this.#s}#be(e,t){return this.#s=e,this.#p=new D(this,t),this.#p.build(),this.#p}async load(e,t,s){const r=this.#be(e,t);try{const t=await S.load(e,s);t.dialog=this.#xe,r.module=t}catch(e){throw e}}async build(t=e.data,s=this.#p){s.properties.build(),s.dependencies.build(),s.dataReflecter.reflect(s,t,s.viewModel),await s.initializer.init(s,t),await s.properties.expandAll(),await s.view.build(s),this.#we.push(...await j.build(s.rootElement)),s.view.appear(s),await s.postProcess.exec()}static async create({name:t,parentElement:s=null,withBindCss:r=!1,data:i=e.data,dialog:a=null}){const n=new L(a);return await n.load(t,s,r),await n.build(i),n}async notifyAll(e,t,s){const r=this.#p,i=r.notifier,a=r.viewModel,n=r.eventHandler,o=r.view;for(const r of this.#we)r.notifyAll(e,t,s);s!==this&&o.updateProcess(r,(async()=>{const r=n.exec(a,"notifyAll",e,t,s),o=r instanceof Promise?await r:r;return i.notify(e,t),o}))}async inquiryAll(e,t,s,r){const i=this.#p,a=i.viewModel,n=i.eventHandler,o=i.view;for(const i of this.#we)i.inquiryAll(e,t,s,r);r!==this&&o.updateProcess(i,(async()=>n.exec(a,"inquiryAll",e,t,s,r)))}}class j{static async build(e){return await Promise.all((e=>Array.from(e.querySelectorAll("[data-x\\:block]")))(e).map((e=>(async e=>{const t=e.dataset["x:block"],s="x:withBindCss"in e.dataset;return L.create({name:t,parentElement:e,withBindCss:s})})(e))))}}class I{#we=[];async build(){this.#we.push(...await j.build(document.body))}async notifyAll(e,t,s){for(const r of this.#we)r.notifyAll(e,t,s)}async inquiryAll(e,t,s,r){for(const i of this.#we)i.inquiryAll(e,t,s,r)}}t.regist("falsey",{forward:(e,t=[])=>!e}),t.regist("not",{forward:(e,t=[])=>!e}),t.regist("null",{forward:(e,t=[])=>null==e}),t.regist("style-display",{forward:(e,t=[])=>e?"":"none"}),t.regist("locale-string",{forward:(e,t=[])=>Number(e).toLocaleString()}),t.regist("fixed",{forward:(e,t=[])=>Number(e).toFixed(t[0]??0)}),t.regist("ge",{forward:(e,t=[])=>Number(e)>=Number(t[0]??0)}),t.regist("gt",{forward:(e,t=[])=>Number(e)>Number(t[0]??0)}),t.regist("le",{forward:(e,t=[])=>Number(e)<=Number(t[0]??0)}),t.regist("lt",{forward:(e,t=[])=>Number(e)<Number(t[0]??0)}),t.regist("number-value",{forward:(e,t=[])=>e?.toString()??"",backward:(e,t=[])=>""!==e?Number(e):null});window.datax=class{static root;static async boot(t={},i={}){e.setData(t),O.setOptions(this.getBaseName(),i),await class{static async registLocalFilter(e=O.localFilter,t=O.filterPath){if(e){const e=document.baseURI.lastIndexOf("/"),r=e>=0?document.baseURI.slice(0,e+1):"";await s(108)(`${r}${t}/regist.js`)}}}.registLocalFilter(),this.root=new I(this),r.setRoot(this.root),await this.root.build()}static getBaseName(){const e=location.href.split("/").pop();if(e){const t=e.split(".");return t.pop(),t.join(".")}return e}}})()})();