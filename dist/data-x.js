(()=>{var t={108:t=>{function e(t){return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}e.keys=()=>[],e.resolve=e,e.id=108,t.exports=e}},e={};function s(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,s),a.exports}s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t{static data={};static setData(t){this.data=t}}class e{static root={};static setRoot(t){this.root=t}}class r{static filterByName=new Map;static regist(t,e){this.filterByName.set(t,e)}static forward(t,e){return t.reduce(((t,e)=>"forward"in e.filter?((t,e)=>t.filter.forward(e,t.options))(e,t):t),e)}static backward(t,e){return t.reduce(((t,e)=>"backward"in e.filter?((t,e)=>t.filter.backward(e,t.options))(e,t):t),e)}}class i{#t=new U;#e;#s;#r;constructor(t,e){this.#e=t,this.#s=e}get data(){return this.#e}get callback(){return this.#s}get blocks(){return this.#t.blocks}get block(){return this.#r}set block(t){this.#r=t}async updateProcess(t){this.#t.updateProcess(t)}notifyAll(t,e,s){this.#t.notifyAll(t,e,s),this.callback&&this.callback(this.data)}async inquiryAll(t,e,s,r){await this.#t.inquiryAll(t,e,s,r)}}class a{#r;#e;#i;#t;#a;#n;#o;#l;constructor(t,e){this.#i=t,this.#e=e}get name(){return this.#i}get data(){return this.#e}get block(){return this.#r}get root(){return this.#t}createBackLayer(t=this.#i){const e=document.createElement("div");e.dataset["x:dialog"]=t;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(t=>this.cancelDialog())),e.appendChild(s);const r=document.createElement("div");return r.style.backgroundColor="white",r.style.borderRadius=".375rem",r.style.padding="2rem",r.classList.add("fg"),r.addEventListener("click",(t=>t.stopPropagation())),s.appendChild(r),{root:e,bg:s,fg:r}}async build(t=this.#i,e=this.#e,s=!1){const{root:r,bg:a,fg:n}=this.createBackLayer(t),o=new i(e),l=await q.create({name:t,parentElement:n,withBindCss:s,rootBlock:o,dialog:this});return o.blocks.push(l),document.body.appendChild(r),this.#r=l,this.#t=r,this}static async create(t=this.#i,e=this.#e,s=!1){return new a(t,e).build(t,e,s)}cancelDialog(){this.#l&&this.#l()}closeDialog(t){this.#o&&this.#o(t)}async main(){return new Promise(((t,e)=>{this.#o=t,this.#l=e})).finally((()=>{this.#t.parentNode.removeChild(this.#t)}))}static async open(t,e={}){return(await a.create(t,e)).main()}}class n{name;pattern;indexes;lastName;parentName;constructor({name:t=null,pattern:e=null,indexes:s=null}){this.name=t,this.pattern=e,this.indexes=s,null==t&&null!=e&&null!=s&&(this.name=n.expand(e,s));const r=this.name.split(".");this.lastName=r.pop(),this.parentName=r.join(".")}static expand(t,e,s=e.slice()){let r=!1;const i=t.replaceAll("*",(()=>s.shift()??(r=!0,"*")));return r?null:i}static createByName(t){return new n({name:t})}static createByPatternIndexes(t,e){return new n({pattern:t,indexes:e})}}class o{static async exec(t,e,...s){const r=e[0].toUpperCase()+e.slice(1),i=`event${r}`,a=`on${r}`;if(i in t){const e=Object.getOwnPropertyDescriptor(t,i);return Reflect.apply(e.set,t,[s])}if(a in t)return t[a](...s)}}class l{static async init(t,e,s=t.viewModel,r=t.properties){await o.exec(s,"init",e);for(const t of r.values){if(null==t?.init)continue;const r=t.init(e),i=r instanceof Promise?await r:r;t.name.includes(".")?s[t.name]=i:s[`__${t.name}`]=i}}}const c={suspend:Symbol("")};class d{static reflect(t,e,s={},r=t.notifier){Object.keys(e).forEach((i=>{const a=`$${i}`,n={configurable:!1,enumerable:!0,get:()=>Reflect.get(e,i),set:s=>{Reflect.set(e,i,s),r.notify(new Promise(((e,s)=>{t.$notifyAll(a),e({name:a})})))}};Object.defineProperty(s,a,n)}))}}class p extends FileReader{constructor(){super()}#c(t,e){return new Promise(((s,r)=>{super.addEventListener("load",(({target:t})=>s(t.result))),super.addEventListener("error",(({target:t})=>r(t.error))),super[e](t)}))}readAsArrayBuffer(t){return this.#c(t,"readAsArrayBuffer")}readAsDataURL(t){return this.#c(t,"readAsDataURL")}readAsText(t){return this.#c(t,"readAsText")}}class h{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static FILE=5;static matchClass="class.";static matchFile="file";static matchRadio="radio";static matchCheckbox="checkbox";static getType(t){return t===this.matchFile?this.FILE:t===this.matchRadio?this.RADIO:t===this.matchCheckbox?this.CHECKBOX:t.startsWith(this.matchClass)?this.CLASS:this.VALUE}static async getValue(t,e){const s=Object.getOwnPropertyDescriptor(t,e);return s?.get?await Reflect.apply(s.get,t,[]):t[e]}static async updateDomByValueType(t){const e=t.domProperty.split("."),s=await this.getValue(t.viewModel,t.path),r=(t,e,s,i=t.shift())=>0===t.length?e[i]!==s&&(e[i]=s):r(t,e[i],s),i=s=>r(e,t.dom,t.filter.forward(t.forwardFilters,s));s instanceof Promise?s.then((t=>i(t))):i(s)}static async updateDomByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=await this.getValue(t.viewModel,t.path),r=s=>t.filter.forward(t.forwardFilters,s)?!t.dom.classList.contains(e)&&t.dom.classList.add(e):t.dom.classList.contains(e)&&t.dom.classList.remove(e);s instanceof Promise?s.then((t=>r(t))):r(s)}static async updateDomByRadioType(t){const e=await this.getValue(t.viewModel,t.path),s=e=>t.dom.checked=t.dom.value===t.filter.forward(t.forwardFilters,e);e instanceof Promise?e.then((t=>s(t))):s(e)}static async updateDomByCheckboxType(t){const e=await this.getValue(t.viewModel,t.path),s=e=>t.dom.checked=(t.filter.forward(t.forwardFilters,e)??[]).includes(t.dom.value);e instanceof Promise?e.then((t=>s(t))):s(e)}static async updateDomByFileType(t){}static async setValue(t,e,s){const r=Object.getOwnPropertyDescriptor(t,e);r?.set?await Reflect.apply(r.set,t,[s]):t[e]=s}static async updateViewModelByValueType(t){const e=t.domProperty.split("."),s=(t,e,r=t.shift())=>0===t.length?e[r]:s(t,e[r]),r=t.filter.backward(t.backwardFilters,s(e,t.dom));await this.setValue(t.viewModel,t.path,r)}static async updateViewModelByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=t.dom.classList.contains(e);await this.setValue(t.viewModel,t.path,s)}static async updateViewModelByRadioType(t){if(t.dom.checked){const e=t.dom.value;await this.setValue(t.viewModel,t.path,e)}}static async updateViewModelByCheckboxType(t){const e=new Set(t.viewModel[t.path]??[]);t.dom.checked?e.add(t.dom.value):e.delete(t.dom.value);const s=Array.from(e);await this.setValue(t.viewModel,t.path,s)}static async updateViewModelByFileType(t){if(0==t.dom.files.length)return;const e=new p,s=await e.readAsText(t.dom.files[0]),r=t.filter.backward(t.backwardFilters,s);await this.setValue(t.viewModel,t.path,r)}static#d={};static#p={};static init(){this.#d[this.VALUE]=this.updateDomByValueType,this.#d[this.CLASS]=this.updateDomByClassType,this.#d[this.RADIO]=this.updateDomByRadioType,this.#d[this.CHECKBOX]=this.updateDomByCheckboxType,this.#d[this.FILE]=this.updateDomByFileType,this.#p[this.VALUE]=this.updateViewModelByValueType,this.#p[this.CLASS]=this.updateViewModelByClassType,this.#p[this.RADIO]=this.updateViewModelByRadioType,this.#p[this.CHECKBOX]=this.updateViewModelByCheckboxType,this.#p[this.FILE]=this.updateViewModelByFileType}static async updateDom(t,e=t.domPropertyType){await Reflect.apply(this.#d[e],this,[t])}static async updateViewModel(t,e=t.domPropertyType){await Reflect.apply(this.#p[e],this,[t])}}class u{#h;#u;#m;#f;#y;#g;#w;#b;#x;#P;#v;#k;constructor(t,e,s){this.#u=t,this.#m=e.dom?.property,this.#f=s.viewModel,this.#y=e.viewModel?.property,this.#g=e.inputable,this.#v=class{static parse(t){return 0==t.length?[]:t.split("|").map((t=>t.split(":"))).map((([t,e])=>({name:t,options:e?.split(";")??[],filter:r.filterByName.get(t)})))}}.parse(e?.filters.join("|"))??[],this.#k=this.#v.slice().reverse(),this.#h=s,this.#w=s.indexes?.slice()??[],this.#P=h.getType(this.#m);const{path:i,pattern:a}=s.getPathInfo(this.#y);this.#b=i,this.#x=a}get dom(){return this.#u}get domProperty(){return this.#m}get viewModel(){return this.#f}get path(){return this.#b}get pattern(){return this.#x}get domPropertyType(){return this.#P}get forwardFilters(){return this.#v}get backwardFilters(){return this.#k}get filter(){return this.#h.filter}async init(t=this.#g){t&&this.attachEvent(),await this.updateDom()}async updateDom(){await h.updateDom(this)}async#E(){await h.updateViewModel(this)}attachEvent(t=this.#u,e=this.#h,s=e.view){t.addEventListener("input",(async t=>{await e.$updateProcess((()=>this.#E()))}))}}h.init();class m{nodes=[];loops;binds;key}class f{#u;#y;#N=[];#h;#b;#x;#M;constructor(t,e,s){this.#u=t,this.#y=e.viewModel?.property,this.#h=s;const{path:r,pattern:i}=s.getPathInfo(this.#y);this.#b=r,this.#x=i,this.#M=s.loopStack.slice()}get dom(){return this.#u}get path(){return this.#b}get pattern(){return this.#x}get children(){return this.#N}async#A(t,e=this.#u,s=this.#h){return s.pushLoop({loop:this,key:t},(()=>{const r=s.loopStack.map((t=>t.key));return s.pushIndexes(r,(async()=>{const r=document.createDocumentFragment(),i=new m,a=e.content.cloneNode(!0),{binds:n,loops:o}=await s.view.createBindTree(s,a);return Object.assign(i,{key:t,binds:n,loops:o}),r.appendChild(a),i.nodes.push(...Array.from(r.childNodes)),i}))}))}async expand(t=this.#h.viewModel,e=this.#b,s=this.#N,r=this.#u){const i=await t[e];try{for(const t of Object.keys(i))s.push(await this.#A(t))}catch(t){throw console.log(t,e,i),t}const a=document.createDocumentFragment(),n=t=>a.appendChild(t);s.forEach((t=>t.nodes.forEach(n))),r.after(a)}#B(t,e=this.#h){const s=this.#M.slice(),r=s=>{if(0===s.length)return t();const i=s.pop();return e.pushLoop(i,(()=>r(s)))};return r(s)}#D(t){t.loops.forEach((t=>t.contract())),t.nodes.forEach((t=>t.parentNode.removeChild(t)))}contract(t=this.#N){t.forEach((t=>this.#D(t))),t.splice(0)}async update(){this.contract(),await this.#B((async()=>this.expand()))}}class y{#u;#h;#R;#w;#T;constructor(t,e,s){this.#u=t,this.#R=e.dom?.event,this.#h=s,this.#w=s.indexes?.slice()??[],this.#T=this.#C()}get event(){return this.#R}get dom(){return this.#u}init(){this.#$()}#C(){const t=this.#u;return`${this.#R.toLowerCase()}${e="x:name"in t?.dataset?t?.dataset["x:name"]:t?.name?.length>0?t.name:t.tagName.toLowerCase(),e?.length>0?e.at(0).toUpperCase()+e.slice(1):""}`;var e}async#S(t,e=this.#h.viewModel,s=this.#h.eventHandler,r=this.#T,i=this.#w,a=this.#h){return a.pushIndexes(i,(()=>s.exec(e,r,t,...i)))}#$(t=this.#u,e=this.#R,s=this.#h,r=s.view){t.addEventListener(e,(async t=>{await s.$updateProcess((()=>this.#S(t)))}))}}const g=":not([data-x\\:processed])",w="x:ignore",b=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((t=>`${t}${g}`)).join(","),x=["input","textarea","select","button"].map((t=>`${t}${g}`)).join(",");class P{static async createBindTree(t,e,s=t.bindRules){const{loops:r,binds:i,events:a}=class{static inputable(t){return"INPUT"===t.tagName&&"button"!==t.type||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||!0===t?.isContentEditable}static testFile(t){return"INPUT"===t.tagName&&"file"===t.type}static testRadio(t){return"INPUT"===t.tagName&&"radio"===t.type}static testCheckbox(t){return"INPUT"===t.tagName&&"checkbox"===t.type}static parsePropertyName(t){const e=t.split("|");return{property:e.shift(),filters:e}}static parseDataBind(t,e,s=this.inputable(t),r=this.testFile(t),i=this.testRadio(t),a=this.testCheckbox(t)){const n=(e,n)=>{if(e.includes("=")){const[o,l]=e.split("="),{property:c,filters:d}=this.parsePropertyName(l);n.dom.property=o,n.viewModel.property=c,n.filters=d;const p=new Set(s?r?["file"]:i?["radio"]:a?["checked","checkbox"]:t.isContentEditable?["textContent"]:["value"]:[]);n.inputable=p.has(o)}else{const{property:o,filters:l}=this.parsePropertyName(e);n.dom.property=s?r?"file":i?"radio":a?"checkbox":t.isContentEditable?"textContent":"value":"textContent",n.viewModel.property=o,n.filters=l,n.inputable=s}return n},o=e.split(",");if(1==o.length)return[n(e,{dom:{},viewModel:{},filters:[]})];{const t=o.map((t=>n(t,{dom:{},viewModel:{},filters:[]})));return t}}static collectByAttribute(t,e,s=[],r=[],i=[]){return Array.from(e.querySelectorAll(b)).forEach((e=>{if(w in e.dataset)return;const a=e.dataset["x:processing"]?.split(",")??[];if("x:loop"in e.dataset){if("TEMPLATE"!==e.tagName)return;if(a.includes("loop"))return;const s={dom:{},viewModel:{property:e.dataset["x:loop"]},filters:[]};r.push(new f(e,s,t)),a.push("loop")}else{if("x:bind"in e.dataset){if(a.includes("bind"))return;s.push(...this.parseDataBind(e,e.dataset["x:bind"]).map((s=>new u(e,s,t)))),a.push("bind")}if("x:events"in e.dataset){if(a.includes("events"))return;e.dataset["x:events"].split(",").forEach((s=>{const r={dom:{event:s},viewModel:{},filters:[]};i.push(new y(e,r,t))})),a.push("events")}}e.dataset["x:processing"]=a.join(",")})),{binds:s,loops:r,events:i}}static collectByImplicit(t,e,s=[],r=[],i=[]){return Array.from(e.querySelectorAll(x)).forEach((e=>{if(w in e.dataset)return;const r=e.dataset["x:processing"]?.split(",")??[],a=this.testFile(e),n=this.testRadio(e),o=this.testCheckbox(e),l={dom:{},viewModel:{},filters:[]};if("BUTTON"===e.tagName||"INPUT"===e.tagName&&"button"===e.type){if(r.includes("events"))return;l.dom.event="click",i.push(new y(e,l,t)),r.push("events")}else{if(r.includes("bind"))return;const{property:i,filters:c}=this.parsePropertyName(e.name);l.dom.property=a?"file":n?"radio":o?"checkbox":"value",l.viewModel.property=i,l.filters=c,l.inputable=!0,s.push(new u(e,l,t)),r.push("bind")}e.dataset["x:processing"]=r.join(",")})),{binds:s,loops:r,events:i}}static collectByRule(t,e,s,r=[],i=[],a=[]){const n=new Map;return s.forEach((t=>{!n.has(t.dom.selector)&&n.set(t.dom.selector,[]),n.get(t.dom.selector).push(t)})),Array.from(n.keys()).forEach((s=>{e.querySelectorAll(`${s}${g}`).forEach((e=>{if(w in e.dataset)return;const o=this.inputable(e),l=e.dataset["x:processing"]?.split(",")??[],c=l.slice();n.get(s).forEach((s=>{const n=JSON.parse(JSON.stringify(s));if("TEMPLATE"===e.tagName){if(l.includes("loop"))return;((e,s)=>{i.push(new f(s,e,t))})(n,e),c.push("loop")}else if("event"in n.dom){if(l.includes("events"))return;((e,s)=>{a.push(new y(s,e,t))})(n,e),c.push("events")}else{if(l.includes("bind"))return;n.inputable=o,((e,s)=>{r.push(new u(s,e,t))})(n,e),c.push("bind")}})),e.dataset["x:processing"]=c.join(",")}))})),{loops:i,binds:r,events:a}}static collect(t,e,s=[]){const r=[],i=[],a=[];return this.collectByRule(t,e,s,r,i,a),this.collectByAttribute(t,e,r,i,a),this.collectByImplicit(t,e,r,i,a),r.forEach((t=>t.dom.dataset["x:processed"]="")),i.forEach((t=>t.dom.dataset["x:processed"]="")),a.forEach((t=>t.dom.dataset["x:processed"]="")),Array.from(e.querySelectorAll("[data-x\\:processing]")).forEach((t=>{t.removeAttribute("data-x:processing")})),{loops:i,binds:r,events:a}}}.collect(t,e,s);return await Promise.all(r.map((t=>t.expand()))),await Promise.all(i.map((t=>t.init()))),a.forEach((t=>t.init())),{loops:r,binds:i,events:a}}static async build(t,e=t.rootElement){const s=await this.createBindTree(t,e);t.setBindTree(s),t.buildBinds()}static appear(t,e=t.fragment,s=t.parentElement){const r=s.attachShadow({mode:"open"});r.appendChild(e),t.rootElement=r}static attachTo(t,e){t.parentElement=e,this.appear(t)}static async updateDom(t,e=t.updateQueue,s=t.allBinds,r=t.allLoops,i=t.properties,a=t.viewModel){const n=await Promise.all(e),o=[];for(const{name:t,indexes:e=[]}of n.filter((t=>null!=t))){const s=await i.updateByPatternIndexes({name:t,indexes:e});o.push(...Array.from(s))}const l=new Set(o.map((t=>t.name)));await Promise.all(Array.from(l).map((t=>Reflect.get(a,t))));for(const t of r.filter((t=>l.has(t.path))))await t.update();for(const t of s.filter((t=>l.has(t.path))))await t.updateDom();i.isUpdate&&t.buildBinds()}static async postProcess(t,e=t.postProcess){e.exec()}static async updateProcess(t,e,s=t.notifier,r=t.properties,i=t.postProcess){i.clear(),s.clear(),r.clearStatus(),await e(),await this.updateDom(t),r.isUpdate&&t.buildBinds(),await i.exec()}}class v{parentNodes=[];name;func;childNodes=[];constructor(t){this.name=t}}class k{#L=new Map;#O;#h;constructor(t){this.#h=t}get map(){return this.#L}build(t=this.#L,e=this.#h.dependencyRules){t.clear(),this.#O=this.#h.dependencyRules.slice(),e.forEach((([t,e,s])=>this.add(t,e,s))),this.implicitDependency()}implicitDependency(t=this.#h.properties){for(const e of t.names)t.getDependencyNames(e).forEach((t=>this.add(t,[e])))}add(t,e,s,r=this.#L){r.has(t)||r.set(t,new v(t));const i=r.get(t);i.func=s,e.forEach((t=>{r.has(t)||r.set(t,new v(t));const e=r.get(t);i.childNodes.push(e),e.parentNodes.push(i)}))}getReferedProperties(t,e,s=this.#L,r=this.#h.viewModel){const i=s.get(t),a=new Set,o=e??[],l=(t,e)=>{if(null==t)return e;const s=n.expand(t.name,o);if(null!==s){if(a.has(s))return e;a.add(s);const i=t.func?Reflect.apply(t.func,r,[o]):o;if(!1===i)return e;const n={name:s,pattern:t.name,indexes:i};e.push(n)}return t.parentNodes.forEach((t=>{e=l(t,e)})),e};return l(i,[])}}class E{static PLAIN=1;static PATTERN=2;static EXPANDED=3}class N{#i;#x;#I;#j;#h;#V;#q;#F;#U=!0;#_=!1;#H;constructor(t,e,s,r,i,a){this.#h=t,this.#F=e,this.#i=s,this.#x=r,this.#V=i,this.#q=a;const n=s.split(".");this.#I=n.pop(),this.#j=n.join(".")}get context(){return this.#h}get name(){return this.#i}get pathParent(){return this.#j}get pathLastElement(){return this.#I}get desc(){return this.#V}get init(){return this.#q}get type(){return this.#F}get pattern(){return this.#x}get isArray(){return this.testIsArray()}get referedPatternProperties(){return this.getReferedPatternPeoperties()}get value(){return this.getValue()}get isNew(){return this.#U}get isUpdate(){return this.#_}get hasSetter(){return null!=this.desc.set}set desc(t){this.#V=t,Object.defineProperty(this.#h.viewModel,this.#i,t)}set isNew(t){this.#U=t}set isUpdate(t){this.#_=t}testIsArray(){return!1}getReferedPatternPeoperties(){return[]}getValue(){throw new Error("")}clearStatus(){this.isNew=!1,this.isUpdate=!1}static create(t,{name:e=null,desc:s={},patternProperty:r=null,patternIndexes:i=[],requireSetter:a=null,init:n=null}){return null!=r?new B(t,r,i):(null===a&&(a="set"in s),e.includes("*")?new A(t,e,s,a,n):new M(t,e,s,a,n))}}class M extends N{constructor(t,e,s,r,i){super(t,E.PLAIN,e,e,s,i),this.#X(r)}testIsArray(t=this.name,e=this.context.properties){return e.testIsArray(t)}#X(t){this.context.viewModel;const e=this.context.notifier,s=this.context.cache,r=this.pathParent,i=this.pathLastElement,a=this.name.includes("."),n=`__${this.name}`,o=this.name,l=this.desc,d=a?function(t){const a=l.set?Reflect.apply(l.set,this,[t]):this[r][i]=t;this.isUpdate=!0,s.delete(o),e.notify(new Promise((async(t,e)=>{const s={name:o};t(await a!==c.suspend?s:null)})))}:function(t){const r=l.set?Reflect.apply(l.set,this,[t]):this[n]=t;this.isUpdate=!0,s.delete(o),e.notify(new Promise((async(t,e)=>{const s={name:o};t(await r!==c.suspend?s:null)})))},p={configurable:!0,enumerable:!0,get:a?function(){return s.has(o)?s.get(o):s.set(o,l.get?Reflect.apply(l.get,this,[]):this[r]?.[i])}:function(){return s.has(o)?s.get(o):s.set(o,l.get?Reflect.apply(l.get,this,[]):this[n])}};t&&(p.set=d),this.desc=p}getReferedPatternPeoperties(t=this.context.properties,e=this.name){return t.getReferedPatternPeoperties(e)}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class A extends N{constructor(t,e,s,r,i){super(t,E.PATTERN,e,e,s),this.#X(r)}testIsArray(t=this.pattern,e=this.context.properties){return e.testIsArray(t)}#X(t){const e=this.context,s=(this.context.viewModel,this.pathParent),r=this.pathLastElement,i=this.pattern.split("").filter((t=>"*"===t)).length,a=this.desc,n={configurable:!0,enumerable:!0,get:a.get?a.get:function(){const t="*"===r?(e?.indexes??[]).at(i-1):r;return this[s]?.[t]}};t&&(n.set=a.set?a.set:function(t){const a="*"===r?(e?.indexes??[]).at(i-1):r;this[s][a]=t,this.isUpdate=!0}),this.desc=n}getReferedPatternPeoperties(t=this.context.properties,e=this.pattern){return t.getReferedPatternPeoperties(e)}}class B extends N{#z;#Q;constructor(t,e,s){const r=n.expand(e.pattern,s);super(t,E.EXPANDED,r,e.pattern,null,e.init),this.#z=e,this.#Q=s.slice(),this.#X()}get patternProperty(){return this.#z}get patternIndexes(){return this.#Q}#X(){const t=this.context,e=this.context.cache,s=this.context.viewModel,r=this.context.notifier,i=(this.context.properties,this.patternProperty),a=this.patternIndexes,n=this.name,o={configurable:!0,enumerable:!0,get:()=>t.pushIndexes(a,(()=>e.has(n)?e.get(n):e.set(n,s[i.pattern])))};null!=i.desc.set&&(o.set=o=>t.pushIndexes(a,(()=>{const t=Reflect.apply(i.desc.set,s,[o]);this.isUpdate=!0,e.delete(n),r.notify(new Promise((async(e,s)=>{const r={name:i.pattern,indexes:a};e(await t!==c.suspend?r:null)})))}))),this.desc=o}testIsArray(t=this.patternProperty.pattern,e=this.context.properties){return e.testIsArray(t)}getReferedPatternPeoperties(t=this.patternProperty){return t.referedPatternProperties}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class D{#h;#W=new Map;#_=!1;constructor(t){this.#h=t}get names(){return Array.from(this.#W.keys())}get values(){return Array.from(this.#W.values())}build(t=this.#h,e=this.#h.viewModel){this.#W.clear();const s=Object.getPrototypeOf(e),r=t=>({configurable:!0,enumerable:!1,writable:!0,value:t?.value}),i=t=>/^\@\@?([a-zA-Z0-9_\.\*])+(#(get|set|init)?)?$/.test(t),a=t=>/^#(event[a-zA-Z0-9_]+)$/.test(t),n=t=>/^__([a-zA-Z0-9_])+$/.test(t),o=new Map;[e].forEach((t=>{Object.entries(Object.getOwnPropertyDescriptors(t)).forEach((([t,s])=>{if(i(t)||n(t)||a(t))if(n(t))Reflect.defineProperty(e,t,r(s));else if(i(t)){const[r,i]=t.includes("#")?t.split("#"):[t,null],a="@"===t.at(1),n=a?r.slice(2):r.slice(1),l=o.has(n)?o.get(n):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};l.baseName=l.baseName??n,l.originalName=l.originalName??r,l.privateName=l.privateName??`__${n}`;const c=t=>"function"==typeof t&&0===t.length?t:console.error(`${n}.getter is not function() {}`),d=t=>"function"==typeof t&&1===t.length?t:console.error(`${n}.setter is not function(value) {}`);""===i?(l.get=s?.value?.get?c(s.value.get):l.get,l.set=s?.value?.set?d(s.value.set):l.set,l.init=s?.value?.init?s.value.init:l.init):(l.get="get"===i?c(s.value):l.get,l.set="set"===i?d(s.value):l.set,l.init="init"===i?s.value:l.init),l.requireGet=null==i||l.requireGet,l.requireSet=a,l.privateValue=null==i?s.value:l.privateValue,o.set(n,l),Reflect.deleteProperty(e,t)}else if(a(t)){const r=t,i="set",a=!0,n=r.slice(1),l=o.has(n)?o.get(n):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};l.baseName=l.baseName??n,l.originalName=l.originalName??r,l.privateName=l.privateName??`__${n}`,l.set="set"===i?s.value:l.set,l.requireGet=null==i||l.requireGet,l.requireSet=a,l.privateValue=null==i?s.value:l.privateValue,o.set(n,l),Reflect.deleteProperty(e,t)}}))})),Array.from(o.entries()).forEach((([i,a])=>{a.privateName in e||a.baseName.includes(".")||Reflect.defineProperty(e,a.privateName,r({value:a.privateValue}));const n=Object.getOwnPropertyDescriptor(e,i)??Object.getOwnPropertyDescriptor(s,i)??{};n.get=null!=a.get?a.get:n.get??null,n.set=null!=a.set?a.set:n.set??null;const o=a.init,l=a.requireSet,c=i;this.setProperty(N.create(t,{name:c,desc:n,requireSetter:l,init:o}))})),[e,s].forEach((e=>{Object.entries(Object.getOwnPropertyDescriptors(e)).forEach((([e,s])=>{this.#W.has(e)||(null!=s?.get?this.setProperty(N.create(t,{name:e,desc:s,requireSetter:null!=s?.set})):null!=s?.set&&this.setProperty(N.create(t,{name:e,desc:s,requireSetter:!0})))}))}));const l=[];for(const t of this.#W.keys()){const e=[],s=t.split("."),r=[];s.forEach((t=>{r.push(t),e.push(r.join("."))})),l.push(...e)}Array.from(new Set(l)).filter((t=>!this.#W.has(t))).forEach((r=>{const i=Object.getOwnPropertyDescriptor(e,r)??Object.getOwnPropertyDescriptor(s,r)??{};this.setProperty(N.create(t,{name:r,desc:i,requireSetter:!0}))})),Object.defineProperty(e,"$$context",{get:()=>t})}removeProperty(t,e=this.#h.viewModel,s=this.#h.cache,r=this.#W){delete e[t],r.delete(t),s.delete(t)}getProperty(t,e=this.#W){return e.get(t)}setProperty(t,e=this.#W){e.set(t.name,t)}async#G(t,e){const s=t.type===E.EXPANDED?t.patternIndexes:[],r=await t.value,i=Object.keys(r)??[],a=this.#h;for(const r of t.referedPatternProperties){const t=r.pattern;for(const o of i){const i=s.concat(o),l=n.expand(t,i);if(null!=l&&!l.includes("*")){const t=N.create(a,{patternProperty:r,patternIndexes:i,requireSetter:r.hasSetter});this.setProperty(t),e.add(this.#K(t)),r.isArray&&await this.#G(t,e)}}}}async expand(t,e=null){const s=this.getProperty(t);null!=s&&await this.#G(s)}#Z(t){const e=(t.type===E.EXPANDED?t.patternIndexes:[]).join("\t"),s=t=>t.patternIndexes.join("\t").startsWith(e);t.referedPatternProperties.forEach((t=>{this.getExpandedPropertiesByPatternProperty(t).filter(s).forEach((t=>{this.removeProperty(t.name)}))}))}testIsArray(t,e=this.#W){return e.has(`${t}.*`)}#K(t){if(null==t)return null;const{name:e,pattern:s,patternIndexes:r,indexes:i=r??null}=t;return{name:e,pattern:s,indexes:i}}async#J(t,e,s=this.#h.cache){s.delete(t);const r=this.getProperty(t);return e.add(this.#K(r)??{name:t,pattern:t,indexes:null}),null!=r&&r.isArray&&(this.#Z(r),await this.#G(r,e)),e}async updateByPatternIndexes({name:t,indexes:e}){const s=n.expand(t,e),r=new Set;await this.#J(s,r);for(const i of this.#h.dependencies.getReferedProperties(t,e))s!==i.name&&await this.#J(i.name,r);return r}async expandAll(t=this.#W){await Promise.all(Array.from(t.entries()).map((async([t,e])=>{!t.includes("*")&&e.isArray&&this.#G(e,new Set)})))}has(t,e=this.#W){return e.has(t)}getReferedPatternPeoperties(t){const e=`${t}.`;return this.names.filter((t=>t.startsWith(e))).map((t=>this.getProperty(t))).filter((t=>t.type===E.PATTERN))}getDependencyNames(t){const e=`${t}.`;return this.names.filter((t=>t.startsWith(e)&&!t.slice(e.length).includes("."))).map((t=>this.getProperty(t))).filter((t=>t.type===E.PATTERN||E.PLAIN)).map((t=>t.name))}getExpandedPropertiesByPatternProperty(t){return this.values.filter((t=>t.type===E.EXPANDED)).filter((e=>e.patternProperty===t))}clearStatus(){return this.values.forEach((t=>t.clearStatus()))}get isUpdate(){return this.values.some((t=>t.isUpdate||t.isNew))}}class R{#Y=[];#h;constructor(t){this.#h=t}get queue(){return this.#Y}notify(t,e=this.#Y){e.push(t)}dequeue(t=this.#Y){const e=t.slice();return t.splice(0),e}async updatePaths(t=this.#h.properties){const e=await Promise.all(this.#Y),s=[];for(const{name:r,indexes:i=[]}of e.filter((t=>null!=t))){const e=await t.updateByPatternIndexes({name:r,indexes:i});console.log("paths = ",e,{name:r,indexes:i}),s.push(...Array.from(e))}return s}clear(t=this.#Y){t.splice(0)}}class T{#tt=new Map;#h;constructor(t){this.#h=t}has(t){return this.#tt.has(t)}get(t){return this.#tt.get(t)}set(t,e){const s=e=>{"object"==typeof e&&null!==e&&"__notifiable"in e&&(e.__name=t),this.#tt.set(t,e)};return s(e),e instanceof Promise&&e.then((t=>s(t))),e}delete(t){this.#tt.delete(t)}}class C{#h;#Y=[];constructor(t){this.#h=t}regist(t,e=this.#Y){e.push(t)}exec(t=this.#h,e=this.#Y,s=t.view){const r=e.slice();e.splice(0);const i=[];if(r.length>0)for(const t of r)i.push(t());return Promise.all(i)}clear(t=this.#Y){t.splice(0)}}class ${#i;#h;constructor(t){this.#h=t}has(t,e){return"__notifiable"===e||Reflect.has(t,e)}get(t,e,s){return"__notifiable"===e||("__name"===e?this.#i:Reflect.get(t,e,s))}set(t,e,s,r){if("__name"===e)return this.#i=s,!0;if("length"===e){const t=this.#i;null!=t&&this.#h.notifier.notify({name:t})}return Reflect.set(t,e,s,r)}static notifiable(t,e){return new Proxy(e,new $(t))}}class S{#et;#st;#rt;#it;#f;#at;#nt;#ot={binds:[],loops:[]};#lt=[];#ct=[];#M=[];#dt=[];#pt;#ht;#tt;#ut;#mt;#r;#S;#ft;#yt;#gt;#wt=[];constructor(t,e,s){this.#r=t,this.#et=e,this.#mt=s}build(){this.#it=P,this.#at=new C(this),this.#nt=new k(this),this.#pt=new D(this),this.#ht=new R(this),this.#tt=new T(this),this.#ut=r,this.#S=o,this.#ft=l,this.#yt=d}get parentElement(){return this.#et}get fragment(){return this.#st}get rootElement(){return this.#rt??this.#st}get view(){return this.#it}get viewModel(){return this.#f}get postProcess(){return this.#at}get dependencies(){return this.#nt}get bindTree(){return this.#ot}get allBinds(){return this.#lt}get allLoops(){return this.#ct}get indexesStack(){return this.#dt}get indexes(){return this.#dt[this.#dt.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#M}get currentLoop(){return this.#M[this.#M.length-1]}get properties(){return this.#pt}get notifier(){return this.#ht}get cache(){return this.#tt}get context(){return this}get filter(){return this.#ut}get rootBlock(){return this.#mt}get block(){return this.#r}get eventHandler(){return this.#S}get initializer(){return this.#ft}get data(){return this.#mt.data}get dataReflecter(){return this.#yt}get template(){return this.#gt.template}get module(){return this.#gt}get moduleDatas(){return this.#gt.moduleDatas}get bindRules(){return this.#gt.bindRules}get dependencyRules(){return this.#gt.dependencyRules}get isBlockModule(){return this.#gt.useModule}get symbols(){return c}get updateQueue(){return this.#wt}get notifiable(){return $}set module(t){this.#gt=t,this.#f=void 0!==t.viewModel?t.viewModel:void 0!==t.AppViewModel?Reflect.construct(t.AppViewModel,[]):{},this.#st=t.template.content.cloneNode(!0);const e=t?.context??t?._;null!=e&&this.reflect(e,t.dialog)}set rootElement(t){this.#rt=t}set parentElement(t){this.#et=t}copyUpdateQueue(){this.#wt=this.#ht.dequeue()}pushIndexes(t,e){this.#dt.push(t);const s=e();return s instanceof Promise?s.finally((()=>this.#dt.pop())):this.#dt.pop(),s}pushLoop({loop:t,key:e},s){this.#M.push({loop:t,key:e});const r=s();return r instanceof Promise?r.finally((()=>this.#M.pop())):this.#M.pop(),r}getPathInfo(t,e=t,s=this.currentLoop?.loop,r=this.currentLoop?.key,i=this.indexes??[]){return"."===t[0]?"."===t?{path:`${s.path}.${r}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${r}.${t}`,pattern:`${s.pattern}.*.${t}`}:{path:n.expand(e,i),pattern:e}}setBindTree({binds:t,loops:e},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...t),s.loops.push(...e)}buildBinds(t=this.bindTree,e=this.allBinds,s=this.allLoops){e.splice(0),s.splice(0);const r=t=>e.push(t),i=t=>s.push(t);t.binds.forEach(r),t.loops.forEach(i);const a=t=>{t.children.forEach((t=>{t.binds.forEach(r),t.loops.forEach(i),t.loops.forEach(a)}))};t.loops.forEach(a)}reflect(t,e){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([e,s])=>{if(null!=s?.get){const r={configurable:!0,enumerable:!0,get:(...t)=>Reflect.apply(s.get,this,t)};Object.defineProperty(t,e,r)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postProcess","postProcess"],["$updateProcess","updateProcess"],["$notifiable","notifiable"]].forEach((([e,s])=>{const r={configurable:!0,enumerable:!1,value:"AsyncFunction"===e.constructor.name?async(...t)=>Reflect.apply(this[e],this,t):(...t)=>Reflect.apply(this[e],this,t)};Object.defineProperty(t,s,r)})),null!=e){this.$closeDialog=function(t){e.closeDialog(t)};const s={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$closeDialog,this,t)};Object.defineProperty(t,"closeDialog",s),this.$cancelDialog=function(){e.cancelDialog()};const r={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$cancelDialog,this,t)};Object.defineProperty(t,"cancelDialog",r)}}$notify(t,e=[]){this.notifier.notify({name:t,indexes:e})}$postProcess(t){this.postProcess.regist(t)}$notifyAll(t,e=[]){this.rootBlock.notifyAll(t,e,this.block)}$notifiable(t){return this.notifiable.notifiable(this,t)}async $updateProcess(t){this.rootBlock.updateProcess(t)}$inquiryAll(t,e,s){return this.$postProcess((()=>this.rootBlock.inquiryAll(t,e,s,this.block)))}async $openDialog(t,e={}){return a.open(t,e)}}const L="--bind-",O="--bind-class-";class I{dom={selector:""};viewModel={};filters=[];static#bt(t,e,s,r){const i=new I;return i.dom.selector=t,i.dom.property=e,i.viewModel.property=s,i.filters.push(...r),i}static#xt(t,e){const s=new I;return s.dom.selector=t,s.dom.event=e,s}static#Pt(t,e){const s=new I;return s.dom.selector=t,s.viewModel.property=e,s}static build(t){const e=[];for(let s=0;s<t.style.length;s++){const r=t.style[s],i=t.style.getPropertyValue(r).trim();if("--events"===r)for(const s of i.split(",")){const r=I.#xt(t.selectorText,s);e.push(r)}else if("--loop"===r){const s=I.#Pt(t.selectorText,i);e.push(s)}else if(r.startsWith(O)){const s=i.split("|"),a=s.shift(),n=s,o=I.#bt(t.selectorText,"class."+r.slice(O.length),a,n);e.push(o)}else if(r.startsWith(L)){const s=i.split("|"),a=s.shift(),n=s,o=I.#bt(t.selectorText,r.slice(L.length).replaceAll("-","."),a,n);e.push(o)}}return e}}class j{static spaPath;static spaCssPath;static spaHtmlPath;static spaModulePath;static filterPath;static localFilter;static modulePath=".";static setOptions(t,e){this.spaPath=e.spaPath??(t?`${t}-spa`:"spa"),this.spaCssPath=`${this.spaPath}/css`,this.spaHtmlPath=`${this.spaPath}/html`,this.spaModulePath=`${this.spaPath}/module`,this.modulePath=e.modulePath??".",this.localFilter=e.localFilter??!1,this.filterPath=this.localFilter?e.filterPath??`${this.spaPath}/module/filter`:null}}class V{name;viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;useModule;moduleDatas;static async load({name:t,useModule:e,withBindCss:s,module:r=new V}){const i=e?null:j.spaCssPath,a=e?null:j.spaHtmlPath,n=e?null:j.spaModulePath,o=e?j.modulePath:null;r.name=t,r.useModule=e;const l=await this.loadScript(t,o??n);if(Object.assign(r,l?.default??{}),void 0===r.html&&null!==a){const e=await this.loadHtml(t,a);Object.assign(r,{html:e})}if(void 0===r.css&&null!==i){const e=await this.loadCss(t,i);Object.assign(r,{css:e})}if(s&&void 0===r.bindCss&&null!==i&&void 0===r.bindRules){const e=await this.loadBindCss(t,i);Object.assign(r,{bindCss:e})}return this.build(t,r,e)}static build(t,e,s=!1){e.useModule=s;const r=this.buildTemplate(t,e.html,e.css);if(Object.assign(e,{template:r}),void 0===e.bindRules&&void 0!==e.bindCss){const t=this.buildBindRules(e.bindCss);Object.assign(e,{bindRules:t})}return void 0===e.dependencyRules&&(e.dependencyRules=[]),void 0===e.bindRules&&(e.bindRules=[]),e}static async loadScript(t,e){const s=e.startsWith("https://")||e.startsWith("http://")||"/"===e[0],r=document.baseURI.lastIndexOf("/"),i=r>=0?document.baseURI.slice(0,r+1):"";return import(s?`${e}/${t}.js`:`${i}${e}/${t}.js`).catch((t=>{throw console.error(t),t}))}static async loadHtml(t,e){return fetch(`${e}/${t}.html`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadCss(t,e){return fetch(`${e}/${t}.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadBindCss(t,e){return fetch(`${e}/${t}.bind.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(res.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static buildTemplate(t,e,s){const r=document.createElement("template");return r.innerHTML=e,void 0!==s&&(r.innerHTML="<style>\n"+s+"\n</style>\n"+r.innerHTML),r.dataset["x:block"]=t,r}static buildBindRules(t){return class{static collect(t){if(null==t||""===t)return[];const e=document.createElement("div");document.body.appendChild(e);const s=e.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=t;const i=[];s.appendChild(r);const a=Array.from(s.styleSheets).find((t=>t.ownerNode===r));return Array.from(a?.cssRules??[]).map((t=>i.push(...I.build(t)))),document.body.removeChild(e),i}}.collect(t)}}class q{#i;#h;#vt=[];#kt;constructor(t=null){this.#kt=t}get context(){return this.#h}get name(){return this.#i}#Et(t,e,s){return this.#i=t,this.#h=new S(this,e,s),this.#h.build(),this.#h}async load({name:t,parentElement:e,useModule:s,moduleData:r,withBindCss:i,rootBlock:a}){const n=this.#Et(t,e,a);try{const e=t=>{const e=a.block.context.moduleDatas[t];return V.build(t,e)},o=s&&a?.block?e(t):null!=r?V.build(t,r,s):await V.load({name:t,useModule:s,withBindCss:i});s&&(a.block??(a.block=this)),o.dialog=this.#kt,n.module=o}catch(t){throw t}}async build({data:t,useModule:e,rootBlock:s,context:r=this.#h}){r.properties.build(),r.dependencies.build(),r.dataReflecter.reflect(r,t,r.viewModel),await r.initializer.init(r,t),await r.properties.expandAll(),await r.view.build(r),this.#vt.push(...await F.build(r.rootElement,e,s)),(!r.isBlockModule||null!=r.parentElement)&&r.view.appear(r),await r.postProcess.exec()}static async create({name:t,parentElement:s=null,useModule:r=!1,moduleData:i=null,withBindCss:a=!1,rootBlock:n=e.root,data:o=n.data,dialog:l=null}){const c=new q(l);return await c.load({name:t,parentElement:s,useModule:r,moduleData:i,withBindCss:a,rootBlock:n}),await c.build({data:o,useModule:r,rootBlock:n}),c}notifyAll(t,e,s){const r=this.#h,i=r.notifier,a=r.viewModel,n=r.eventHandler;r.view,s!==this&&i.notify(new Promise((async(r,i)=>{const o=n.exec(a,"notifyAll",t,e,s);o instanceof Promise&&await o,r({name:t,indexes:e})})));for(const r of this.#vt)r.notifyAll(t,e,s)}prepareUpdate(){const t=[];this.context.copyUpdateQueue(),t.push(this.context.updateQueue.length>0);for(const e of this.#vt)t.push(e.prepareUpdate());return!t.every((t=>!1===t))}async updateDom(){const t=[];t.push(this.context.view.updateDom(this.context));for(const e of this.#vt)t.push(e.updateDom());return Promise.all(t)}async postProcess(){const t=[];t.push(this.context.view.postProcess(this.context));for(const e of this.#vt)t.push(e.postProcess());return Promise.all(t)}async inquiryAll(t,e,s,r){const i=this.#h,a=i.viewModel,n=i.eventHandler,o=[];r!==this&&o.push(n.exec(a,"inquiryAll",t,e,s,r));for(const i of this.#vt)o.push(i.inquiryAll(t,e,s,r));await Promise.all(o)}attachTo(t,e=this.#h,s=e.view){s.attachTo(e,t)}}class F{static async build(t,s=!1,r=e.root){return await Promise.all((t=>Array.from(t.querySelectorAll("[data-x\\:block]")))(t).map((t=>(async t=>{const e=t.dataset["x:block"],i="x:withBindCss"in t.dataset;return q.create({name:e,parentElement:t,withBindCss:i,useModule:s,rootBlock:r})})(t))))}}class U{#vt=[];get blocks(){return this.#vt}get data(){return t.data}async build(){this.#vt.push(...await F.build(document.body))}async updateProcess(t){const e=()=>{const t=[];for(const e of this.#vt)t.push(e.prepareUpdate());return!t.every((t=>!1===t))},s=()=>{const t=[];for(const e of this.#vt)t.push(e.updateDom());return Promise.all(t)},r=()=>{const t=[];for(const e of this.#vt)t.push(e.postProcess());return Promise.all(t)};for(await t();e();)await s(),await r()}notifyAll(t,e,s){for(const r of this.#vt)r.notifyAll(t,e,s)}inquiryAll(t,e,s,r){const i=[];for(const a of this.#vt)i.push(a.inquiryAll(t,e,s,r));return Promise.all(i)}}r.regist("falsey",{forward:(t,e=[])=>!t}),r.regist("not",{forward:(t,e=[])=>!t}),r.regist("null",{forward:(t,e=[])=>null==t}),r.regist("style-display",{forward:(t,e=[])=>t?"":"none"}),r.regist("locale-string",{forward:(t,e=[])=>Number(t).toLocaleString()}),r.regist("fixed",{forward:(t,e=[])=>Number(t).toFixed(e[0]??0)}),r.regist("ge",{forward:(t,e=[])=>Number(t)>=Number(e[0]??0)}),r.regist("gt",{forward:(t,e=[])=>Number(t)>Number(e[0]??0)}),r.regist("le",{forward:(t,e=[])=>Number(t)<=Number(e[0]??0)}),r.regist("lt",{forward:(t,e=[])=>Number(t)<Number(e[0]??0)}),r.regist("number-value",{forward:(t,e=[])=>t?.toString()??"",backward:(t,e=[])=>""!==t?Number(t):null}),r.regist("b64",{forward:(t,e=[])=>atob(t),backward:(t,e=[])=>btoa(t)});class _{static root;static booting=!1;static booted=!1;static async boot({data:r={},options:i={}}={}){this.booting=!0;try{t.setData(r),j.setOptions(this.getBaseName(),i),await class{static async registLocalFilter(t=j.localFilter,e=j.filterPath){if(t){const t=document.baseURI.lastIndexOf("/"),r=t>=0?document.baseURI.slice(0,t+1):"";await s(108)(`${r}${e}/regist.js`)}}}.registLocalFilter(),this.root=new U,e.setRoot(this.root),await this.root.build()}finally{this.booting=!1,this.booted=!0}}static getBaseName(){const t=location.href.split("/").pop();if(t){const e=t.split(".");return e.pop(),e.join(".")}return t}static async createBlockModule(t,{alias:e=null,data:s={},path:r=null,handler:a=null,parentElement:n=null}){const o={useModule:!0,rootBlock:new i(s,a)};return"object"==typeof t&&null!==t?(o.moduleData=t,o.name=e??"__blockModule"):"."===t[0]||"/"===t[0]?(o.path=t,o.name=e??"__blockModule"):o.name=t,o.parentElement=n,q.create(o)}static getSymbol(t){return c[t]}}document.addEventListener("DOMContentLoaded",(function(){_.booted||_.booting||_.boot()})),window.datax=_})()})();