(()=>{var e={108:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=108,e.exports=t}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{static data={};static setData(e){Object.assign(this.data,e)}}class t{static filterByName=new Map;static regist(e,t){this.filterByName.set(e,t)}static forward(e,t){return e.reduce(((e,t)=>"forward"in t.filter?((e,t)=>e.filter.forward(t,e.options))(t,e):e),t)}static backward(e,t){return e.reduce(((e,t)=>"backward"in t.filter?((e,t)=>e.filter.backward(t,e.options))(t,e):e),t)}}class r{static root={};static setRoot(e){this.root=e}}class i{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static matchClass="class.";static matchRadio="radio";static matchCheckbox="checkbox";static getType(e){return e===this.matchRadio?this.RADIO:e===this.matchCheckbox?this.CHECKBOX:e.startsWith(this.matchClass)?this.CLASS:this.VALUE}static updateDomByValueType(e){const t=e.domProperty.split("."),s=e.viewModel[e.path],r=(e,t,s,i=e.shift())=>0===e.length?t[i]!==s&&(t[i]=s):r(e,t[i],s),i=s=>r(t,e.dom,e.filter.forward(e.forwardFilters,s));s instanceof Promise?s.then((e=>i(e))):i(s)}static updateDomByClassType(e){const t=e.domProperty.slice(this.matchClass.length),s=e.viewModel[e.path],r=s=>e.filter.forward(e.forwardFilters,s)?!e.dom.classList.contains(t)&&e.dom.classList.add(t):e.dom.classList.contains(t)&&e.dom.classList.remove(t);s instanceof Promise?s.then((e=>r(e))):r(s)}static updateDomByRadioType(e){const t=e.viewModel[e.path],s=t=>e.dom.checked=e.dom.value===e.filter.forward(e.forwardFilters,t);t instanceof Promise?t.then((e=>s(e))):s(t)}static updateDomByCheckboxType(e){const t=e.viewModel[e.path],s=t=>e.dom.checked=(e.filter.forward(e.forwardFilters,t)??[]).includes(e.dom.value);t instanceof Promise?t.then((e=>s(e))):s(t)}static setValue=(e,t)=>{const s=Object.getOwnPropertyDescriptor(e.viewModel,e.path);return s?.set?Reflect.apply(s.set,e.viewModel,[t]):e.viewModel[path]=t};static updateViewModelByValueType(e){const t=e.domProperty.split("."),s=(e,t,r=e.shift())=>0===e.length?t[r]:s(e,t[r]),r=e.filter.backward(e.backwardFilters,s(t,e.dom));return this.setValue(e,r)}static updateViewModelByClassType(e){const t=e.domProperty.slice(this.matchClass.length),s=e.dom.classList.contains(t);return this.setValue(e,s)}static updateViewModelByRadioType(e){if(e.dom.checked){const t=e.dom.value;return this.setValue(e,t)}}static updateViewModelByCheckboxType(e){const t=new Set(e.viewModel[e.path]??[]);e.dom.checked?t.add(e.dom.value):t.delete(e.dom.value);const s=Array.from(t);return this.setValue(e,s)}static#e={};static#t={};static init(){this.#e[this.VALUE]=this.updateDomByValueType,this.#e[this.CLASS]=this.updateDomByClassType,this.#e[this.RADIO]=this.updateDomByRadioType,this.#e[this.CHECKBOX]=this.updateDomByCheckboxType,this.#t[this.VALUE]=this.updateViewModelByValueType,this.#t[this.CLASS]=this.updateViewModelByClassType,this.#t[this.RADIO]=this.updateViewModelByRadioType,this.#t[this.CHECKBOX]=this.updateViewModelByCheckboxType}static updateDom(e,t=e.domPropertyType){Reflect.apply(this.#e[t],this,[e])}static updateViewModel(e,t=e.domPropertyType){return Reflect.apply(this.#t[t],this,[e])}}class n{#s;#r;#i;#n;#a;#o;#c;#l;#p;#d;#h;#u;constructor(e,s,r){this.#r=e,this.#i=s.dom?.property,this.#n=r.viewModel,this.#a=s.viewModel?.property,this.#o=s.inputable,this.#h=class{static parse(e){return 0==e.length?[]:e.split("|").map((e=>e.split(":"))).map((([e,s])=>({name:e,options:s?.split(";")??[],filter:t.filterByName.get(e)})))}}.parse(s?.filters.join("|"))??[],this.#u=this.#h.slice().reverse(),this.#s=r,this.#c=r.indexes?.slice()??[],this.#d=i.getType(this.#i);const{path:n,pattern:a}=r.getPathInfo(this.#a);this.#l=n,this.#p=a}get dom(){return this.#r}get domProperty(){return this.#i}get viewModel(){return this.#n}get path(){return this.#l}get pattern(){return this.#p}get domPropertyType(){return this.#d}get forwardFilters(){return this.#h}get backwardFilters(){return this.#u}get filter(){return this.#s.filter}init(e=this.#o){e&&this.attachEvent(),this.updateDom()}updateDom(){i.updateDom(this)}updateViewModel(){i.updateViewModel(this)}attachEvent(e=this.#r,t=this.#s.viewUpdater){e.addEventListener("input",(e=>t.updateProcess((()=>this.updateViewModel()))))}}i.init();class a{nodes=[];loops;binds;key}class o{#r;#n;#a;#m=[];#s;#l;#p;#y;constructor(e,t,s){this.#r=e,this.#n=s.viewModel,this.#a=t.viewModel?.property,this.#s=s;const{path:r,pattern:i}=s.getPathInfo(this.#a);this.#l=r,this.#p=i,this.#y=s.loopStack.slice()}get dom(){return this.#r}get viewModel(){return this.#n}get path(){return this.#l}get pattern(){return this.#p}get children(){return this.#m}async createChild(e,t=this.#r,s=this.#s){return s.pushLoop({loop:this,key:e},(async()=>{const r=s.loopStack.map((e=>e.key));return s.pushIndexes(r,(async()=>{const r=document.createDocumentFragment(),i=new a;i.key=e;const n=t.content.cloneNode(!0),o=await s.viewBuilder.build(s,n);return i.binds=o.binds,i.loops=o.loops,r.appendChild(n),Array.from(r.childNodes).forEach((e=>i.nodes.push(e))),i}))}))}async expand(){const e=await this.viewModel[this.path],t=await Promise.all(Object.keys(e).map((e=>this.createChild(e))));this.#m.push(...t);const s=document.createDocumentFragment(),r=e=>s.appendChild(e);this.#m.forEach((e=>e.nodes.forEach(r))),this.#r.after(s)}restoreStack(e){const t=this.#y.slice(),s=t=>{if(0===t.length)return e();const r=t.pop();return context.pushLoop(r,s)};return s(t)}removeChild(e){e.loops.forEach((e=>e.contract())),e.nodes.forEach((e=>e.parentNode.removeChild(e)))}contract(e=this.#m){e.forEach((e=>this.removeChild(e))),e.splice(0)}async update(){this.contract(),await this.restoreStack((async()=>this.expand()))}}class c{#r;#s;#f;#g;#c;#w;#x;constructor(e,t,s){this.#r=e,this.#f=t,this.#g=t.dom?.event,this.#s=s,this.#c=s.indexes?.slice()??[],this.#w=this.getHandlerName()}get event(){return this.#g}get dom(){return this.#r}get handlerName(){return this.#w}init(){this.attachEvent()}getHandlerName(){const e=this.#r;return`${this.#g.toLowerCase()}${t="x:name"in e?.dataset?e?.dataset["x:name"]:e?.name?.length>0?e.name:e.tagName.toLowerCase(),t?.length>0?t.at(0).toUpperCase()+t.slice(1):""}`;var t}async eventHandler(e,t=this.#s.viewModel,s=this.#s.eventHandler,r=this.handlerName,i=this.#c,n=this.#s){return n.pushIndexes(i,(async()=>s.exec(t,r,e,...i)))}attachEvent(e=this.#r,t=this.#g,s=this.#s.viewUpdater){e.addEventListener(t,(e=>s.updateProcess((async()=>await this.eventHandler(e)))))}}const l=":not([data-x\\:processed])",p="x:ignore",d=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((e=>`${e}${l}`)).join(","),h=["input","textarea","select","button"].map((e=>`${e}${l}`)).join(",");class u{static async build(e,t,s=e.bindRules){const{loops:r,binds:i,events:a}=class{static inputable(e){return"INPUT"===e.tagName&&"button"!==e.type||"TEXTAREA"===e.tagName||"SELECT"===e.tagName}static testRadio(e){return"INPUT"===e.tagName&&"radio"===e.type}static testCheckbox(e){return"INPUT"===e.tagName&&"checkbox"===e.type}static parsePropertyName(e){const t=e.split("|");return{property:t.shift(),filters:t}}static parseDataBind(e,t,s=this.inputable(e),r=this.testRadio(e),i=this.testCheckbox(e)){const n=(e,t)=>{if(e.includes("=")){const[n,a]=e.split("="),{property:o,filters:c}=this.parsePropertyName(a);t.dom.property=n,t.viewModel.property=o,t.filters=c;const l=s?r?"radio":i?"checkbox":"value":"";t.inputable=l===n}else{const{property:n,filters:a}=this.parsePropertyName(e);t.dom.property=s?r?"radio":i?"checkbox":"value":"textContent",t.viewModel.property=n,t.filters=a,t.inputable=s}return t},a=t.split(",");if(1==a.length)return[n(t,{dom:{},viewModel:{},filters:[]})];{const e=a.map((e=>n(e,{dom:{},viewModel:{},filters:[]})));return e}}static collectByAttribute(e,t,s=[],r=[],i=[]){return Array.from(t.querySelectorAll(d)).forEach((t=>{if(p in t.dataset)return;const a=t.dataset["x:processing"]?.split(",")??[];if("x:loop"in t.dataset){if("TEMPLATE"!==t.tagName)return;if(a.includes("loop"))return;const s={dom:{},viewModel:{property:t.dataset["x:loop"]},filters:[]};r.push(new o(t,s,e)),a.push("loop")}else{if("x:bind"in t.dataset){if(a.includes("bind"))return;s.push(...this.parseDataBind(t,t.dataset["x:bind"]).map((s=>new n(t,s,e)))),a.push("bind")}if("x:events"in t.dataset){if(a.includes("events"))return;t.dataset["x:events"].split(",").forEach((s=>{const r={dom:{event:s},viewModel:{},filters:[]};i.push(new c(t,r,e))})),a.push("events")}}t.dataset["x:processing"]=a.join(",")})),{binds:s,loops:r,events:i}}static collectByImplicit(e,t,s=[],r=[],i=[]){return Array.from(t.querySelectorAll(h)).forEach((t=>{if(p in t.dataset)return;const r=t.dataset["x:processing"]?.split(",")??[],a=this.testRadio(t),o=this.testCheckbox(t),l={dom:{},viewModel:{},filters:[]};if("BUTTON"===t.tagName||"INPUT"===t.tagName&&"button"===t.type){if(r.includes("events"))return;l.dom.event="click",i.push(new c(t,l,e)),r.push("events")}else{if(r.includes("bind"))return;const{property:i,filters:c}=this.parsePropertyName(t.name);l.dom.property=a?"radio":o?"checkbox":"value",l.viewModel.property=i,l.filters=c,l.inputable=!0,s.push(new n(t,l,e)),r.push("bind")}t.dataset["x:processing"]=r.join(",")})),{binds:s,loops:r,events:i}}static collectByRule(e,t,s,r=[],i=[],a=[]){const d=new Map;return s.forEach((e=>{!d.has(e.dom.selector)&&d.set(e.dom.selector,[]),d.get(e.dom.selector).push(e)})),Array.from(d.keys()).forEach((s=>{t.querySelectorAll(`${s}${l}`).forEach((t=>{if(p in t.dataset)return;const l=this.inputable(t),h=t.dataset["x:processing"]?.split(",")??[],u=h.slice();d.get(s).forEach((s=>{const p=JSON.parse(JSON.stringify(s));if("TEMPLATE"===t.tagName){if(h.includes("loop"))return;((t,s)=>{i.push(new o(s,t,e))})(p,t),u.push("loop")}else if("event"in p.dom){if(h.includes("events"))return;((t,s)=>{a.push(new c(s,t,e))})(p,t),u.push("events")}else{if(h.includes("bind"))return;p.inputable=l,((t,s)=>{r.push(new n(s,t,e))})(p,t),u.push("bind")}})),t.dataset["x:processing"]=u.join(",")}))})),{loops:i,binds:r,events:a}}static collect(e,t,s=[]){const r=[],i=[],n=[];return this.collectByRule(e,t,s,r,i,n),this.collectByAttribute(e,t,r,i,n),this.collectByImplicit(e,t,r,i,n),r.forEach((e=>e.dom.dataset["x:processed"]="")),i.forEach((e=>e.dom.dataset["x:processed"]="")),n.forEach((e=>e.dom.dataset["x:processed"]="")),Array.from(t.querySelectorAll("[data-x\\:processing]")).forEach((e=>{e.removeAttribute("data-x:processing")})),{loops:i,binds:r,events:n}}}.collect(e,t,s);return await Promise.all(r.map((e=>e.expand()))),i.forEach((e=>e.init())),a.forEach((e=>e.init())),{loops:r,binds:i,events:a}}}class m{#b;#v;#P;#E;#N;#k;#A;#M;constructor(e,t){this.#P=e,this.#v=t}get name(){return this.#P}get data(){return this.#v}get block(){return this.#b}get root(){return this.#E}createBackLayer(e=this.#P){const t=document.createElement("div");t.dataset["x:dialog"]=e;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(e=>this.cancelDialog())),t.appendChild(s);const r=document.createElement("div");return r.style.backgroundColor="white",r.style.borderRadius=".375rem",r.style.padding="2rem",r.classList.add("fg"),r.addEventListener("click",(e=>e.stopPropagation())),s.appendChild(r),{root:t,bg:s,fg:r}}async create(e=this.#P,t=this.#v,s=!1){const{root:r,bg:i,fg:n}=this.createBackLayer(e),a=await j.build(e,n,s,t,this);document.body.appendChild(r),this.#b=a,this.#E=r}cancelDialog(){this.#M&&this.#M()}closeDialog(e){this.#A&&this.#A(e)}async main(){return new Promise(((e,t)=>{this.#A=e,this.#M=t})).finally((()=>{this.#E.parentNode.removeChild(this.#E)}))}static async open(e,t={}){const s=new m(e,t);return s.create(),s.main()}}class y{name;pattern;indexes;lastName;parentName;constructor({name:e=null,pattern:t=null,indexes:s=null}){this.name=e,this.pattern=t,this.indexes=s,null==e&&null!=t&&null!=s&&(this.name=y.expand(t,s));const r=this.name.split(".");this.lastName=r.pop(),this.parentName=r.join(".")}static expand(e,t,s=t.slice()){return e.replaceAll("*",(()=>s.shift()))}static createByName(e){return new y({name:e})}static createByPatternIndexes(e,t){return new y({pattern:e,indexes:t})}}class f{static async exec(e,t,...s){const r=t[0].toUpperCase()+t.slice(1),i=`event${r}`,n=`on${r}`;if(i in e){const t=Object.getOwnPropertyDescriptor(e,i);return Reflect.apply(t.set,e,[s])}if(n in e)return e[n](...s)}}class g{static async init(e,t,s=e.viewModel,r=e.properties){const i=[];for(const e of r.values){const r=t=>e.name.includes(".")?s[e.name]=t:s[`__${e.name}`]=t;e?.init&&("AsyncFunction"===e.init.constructor.name?i.push(e.init(t).then((e=>r(e)))):r(e.init(t)))}return await Promise.all(i),f.exec(s,"init",t)}}class w{static reflect(e,t,s={}){Object.keys(t).forEach((r=>{const i=`$${r}`,n=t=>!1!==t&&e.$postProcess((()=>{e.$notify(i),e.$notifyAll(i)})),a={configurable:!1,enumerable:!0,get:()=>Reflect.get(t,r),set:e=>{const s=Reflect.set(t,r,e);return s instanceof Promise?s.then(n):n(s),s}};Object.defineProperty(s,i,a)}))}}class x{#s;constructor(e){this.#s=e}async build(e=this.#s,t=this.#s.viewBuilder,s=this.#s.rootElement){const r=await t.build(e,s);e.setBindTree(r),e.buildBinds()}appear(e=this.#s){const t=e.parentElement.attachShadow({mode:"open"});t.appendChild(e.rootElement),e.rootElement=t}}class b{#s;#B=[];constructor(e){this.#s=e}registPostProcess(e){this.#B.push(e)}async postProcess(){const e=this.#B.slice(),t=[];return e.length>0&&this.updateProcess((()=>{for(const s of e)t.push(s())})),Promise.all(t)}clearPostProcess(){this.#B.splice(0)}async updateDom(e=this.#s.notifier,t=this.#s.allBinds,s=this.#s.allLoops,r=this.#s.dependencies){const i=[];e.queue.forEach((({name:e,indexes:t})=>i.push(...r.getReferedProperties(e,t),(({name:e,indexes:t})=>({name:y.expand(e,t),pattern:e,indexes:t}))({name:e,indexes:t}))));const n=new Set(i.map((e=>e.name)));await Promise.all(s.filter((e=>n.has(e.path))).map((async e=>e.update()))),t.filter((e=>n.has(e.path))).forEach((e=>e.updateDom()))}async updateProcess(e,t=this.#s,s=this.#s.notifier,r=this.#s.properties){this.clearPostProcess(),s.clear(),r.clearStatus(),await e(),await this.updateDom(),r.isUpdate&&t.buildBinds(),await this.postProcess()}}class v{parentNodes=[];name;func;childNodes=[];constructor(e){this.name=e}}class P{#R=new Map;#D;#s;constructor(e){this.#s=e}get map(){return this.#R}build(e=this.#R,t=this.#s.dependencyRules){e.clear(),this.#D=this.#s.dependencyRules.slice(),t.forEach((([e,t,s])=>this.add(e,t,s))),this.implicitDependency()}implicitDependency(e=this.#s.properties){for(const t of e.names)e.getDependencyNames(t).forEach((e=>this.add(e,[t])))}add(e,t,s,r=this.#R){r.has(e)||r.set(e,new v(e));const i=r.get(e);i.func=s,t.forEach((e=>{r.has(e)||r.set(e,new v(e));const t=r.get(e);i.childNodes.push(t),t.parentNodes.push(i)}))}getReferedProperties(e,t,s=this.#R){const r=s.get(e),i=(e,s)=>(null==e||(s.push({name:y.expand(e.name,t??[]),pattern:e.name,indexes:e.func?e.func(t):t}),e.parentNodes.forEach((e=>{s=i(e,s)}))),s),n=i(r,[]),a=[];return n.forEach((e=>{const t=new Set(a.map((e=>e.name)));t.has(e)||a.push(e)})),a}}class E{static PLAIN=1;static PATTERN=2;static EXPANDED=3}class N{#P;#p;#$;#T;#s;#C;#S;#O;#L=!0;#j=!1;#I;constructor(e,t,s,r,i,n){this.#s=e,this.#O=t,this.#P=s,this.#p=r,this.#C=i,this.#S=n;const a=s.split(".");this.#$=a.pop(),this.#T=a.join(".")}get context(){return this.#s}get name(){return this.#P}get pathParent(){return this.#T}get pathLastElement(){return this.#$}get desc(){return this.#C}get init(){return this.#S}get type(){return this.#O}get pattern(){return this.#p}get isArray(){return this.testIsArray()}get referedPatternProperties(){return this.getReferedPatternPeoperties()}get value(){return this.getValue()}get isNew(){return this.#L}get isUpdate(){return this.#j}get hasSetter(){return null!=this.desc.set}set desc(e){this.#C=e,Object.defineProperty(this.#s.viewModel,this.#P,e)}set isNew(e){this.#L=e}set isUpdate(e){this.#j=e}testIsArray(){return!1}getReferedPatternPeoperties(){return[]}getValue(){throw new Error("")}clearStatus(){this.isNew=!1,this.isUpdate=!1}static create(e,{name:t=null,desc:s={},patternProperty:r=null,patternIndexes:i=[],requireSetter:n=null,init:a=null}){return null!=r?new M(e,r,i):(null===n&&(n="set"in s),t.includes("*")?new A(e,t,s,n,a):new k(e,t,s,n,a))}}class k extends N{constructor(e,t,s,r,i){super(e,E.PLAIN,t,t,s,i),this.#V(r)}testIsArray(e=this.name,t=this.context.properties){return t.testIsArray(e)}#V(e){this.context.viewModel;const t=this.context.notifier,s=this.context.cache,r=this.pathParent,i=this.pathLastElement,n=this.name.includes("."),a=`__${this.name}`,o=this.name,c=this.desc,l=n?function(e){const n=c.set?Reflect.apply(c.set,this,[e]):this[r][i]=e;this.isUpdate=!0,s.delete(o);const a=e=>!1!==e&&t.notify(o);return n instanceof Promise?n.then((()=>a())):a(n),n}:function(e){const r=c.set?Reflect.apply(c.set,this,[e]):this[a]=e;this.isUpdate=!0,s.delete(o);const i=e=>!1!==e&&t.notify(o);return r instanceof Promise?r.then((()=>i())):i(r),r},p={configurable:!0,enumerable:!0,get:n?function(){return s.has(o)?s.get(o):s.set(o,c.get?Reflect.apply(c.get,this,[]):this[r]?.[i])}:function(){return s.has(o)?s.get(o):s.set(o,c.get?Reflect.apply(c.get,this,[]):this[a])}};e&&(p.set=l),this.desc=p}getReferedPatternPeoperties(e=this.context.properties,t=this.name){return e.getReferedPatternPeoperties(t)}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class A extends N{constructor(e,t,s,r,i){super(e,E.PATTERN,t,t,s),this.#V(r)}testIsArray(e=this.pattern,t=this.context.properties){return t.testIsArray(e)}#V(e){const t=this.context,s=(this.context.viewModel,this.pathParent),r=this.pathLastElement,i=this.pattern.split("").filter((e=>"*"===e)).length,n=this.desc,a={configurable:!0,enumerable:!0,get:n.get?n.get:function(){const e="*"===r?(t?.indexes??[]).at(i-1):r;return this[s]?.[e]}};e&&(a.set=n.set?n.set:function(e){const n="*"===r?(t?.indexes??[]).at(i-1):r;this[s][n]=e,this.isUpdate=!0}),this.desc=a}getReferedPatternPeoperties(e=this.context.properties,t=this.pattern){return e.getReferedPatternPeoperties(t)}}class M extends N{#U;#q;constructor(e,t,s){const r=y.expand(t.pattern,s);super(e,E.EXPANDED,r,t.pattern,null,t.init),this.#U=t,this.#q=s.slice(),this.#V()}get patternProperty(){return this.#U}get patternIndexes(){return this.#q}#V(){const e=this.context,t=this.context.cache,s=this.context.viewModel,r=this.context.notifier,i=(this.context.properties,this.patternProperty),n=this.patternIndexes,a=this.name,o={configurable:!0,enumerable:!0,get:()=>e.pushIndexes(n,(()=>t.has(a)?t.get(a):t.set(a,s[i.pattern])))};null!=i.desc.set&&(o.set=o=>e.pushIndexes(n,(()=>{const e=Reflect.apply(i.desc.set,s,[o]);this.isUpdate=!0,t.delete(a);const c=e=>!1!==e&&r.notify(i.pattern,n);return e instanceof Promise?e.then((()=>c())):c(e),e}))),this.desc=o}testIsArray(e=this.patternProperty.pattern,t=this.context.properties){return t.testIsArray(e)}getReferedPatternPeoperties(e=this.patternProperty){return e.referedPatternProperties}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class B{#s;#F=new Map;#j=!1;constructor(e){this.#s=e}get names(){return Array.from(this.#F.keys())}get values(){return Array.from(this.#F.values())}build(e=this.#s,t=this.#s.viewModel){this.#F.clear();const s=Object.getPrototypeOf(t),r=e=>({configurable:!0,enumerable:!1,writable:!0,value:e?.value}),i=e=>/^\@\@?([a-zA-Z0-9_\.\*])+(#(get|set|init))?$/.test(e),n=e=>/^#(event[a-zA-Z0-9_]+)$/.test(e),a=e=>/^__([a-zA-Z0-9_])+$/.test(e),o=new Map;[t].forEach((e=>{Object.entries(Object.getOwnPropertyDescriptors(e)).forEach((([e,s])=>{if(i(e)||a(e)||n(e))if(a(e))Reflect.defineProperty(t,e,r(s));else if(i(e)){const[r,i]=e.includes("#")?e.split("#"):[e,null],n="@"===e.at(1),a=n?r.slice(2):r.slice(1),c=o.has(a)?o.get(a):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};c.baseName=c.baseName??a,c.originalName=c.originalName??r,c.privateName=c.privateName??`__${a}`,c.get="get"===i?s.value:c.get,c.set="set"===i?s.value:c.set,c.init="init"===i?s.value:c.init,c.requireGet=null==i||c.requireGet,c.requireSet=n,c.privateValue=null==i?s.value:c.privateValue,o.set(a,c),Reflect.deleteProperty(t,e)}else if(n(e)){const r=e,i="set",n=!0,a=r.slice(1),c=o.has(a)?o.get(a):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};c.baseName=c.baseName??a,c.originalName=c.originalName??r,c.privateName=c.privateName??`__${a}`,c.set="set"===i?s.value:c.set,c.requireGet=null==i||c.requireGet,c.requireSet=n,c.privateValue=null==i?s.value:c.privateValue,o.set(a,c),Reflect.deleteProperty(t,e)}}))})),Array.from(o.entries()).forEach((([i,n])=>{n.privateName in t||n.baseName.includes(".")||Reflect.defineProperty(t,n.privateName,r({value:n.privateValue}));const a=Object.getOwnPropertyDescriptor(t,i)??Object.getOwnPropertyDescriptor(s,i)??{};a.get=null!=n.get?n.get:a.get??null,a.set=null!=n.set?n.set:a.set??null;const o=n.init,c=n.requireSet,l=i;this.setProperty(N.create(e,{name:l,desc:a,requireSetter:c,init:o}))})),[t,s].forEach((t=>{Object.entries(Object.getOwnPropertyDescriptors(t)).forEach((([t,s])=>{this.#F.has(t)||(null!=s?.get?this.setProperty(N.create(e,{name:t,desc:s,requireSetter:null!=s?.set})):null!=s?.set&&this.setProperty(N.create(e,{name:t,desc:s,requireSetter:!0})))}))}));const c=[];for(const e of this.#F.keys()){const t=[],s=e.split("."),r=[];s.forEach((e=>{r.push(e),t.push(r.join("."))})),c.push(...t)}Array.from(new Set(c)).filter((e=>!this.#F.has(e))).forEach((r=>{const i=Object.getOwnPropertyDescriptor(t,r)??Object.getOwnPropertyDescriptor(s,r)??{};this.setProperty(N.create(e,{name:r,desc:i,requireSetter:!0}))})),Object.defineProperty(t,"$context",{get:()=>e})}removeProperty(e,t=this.#s.viewModel,s=this.#s.cache,r=this.#F){delete t[e],r.delete(e),s.delete(e)}getProperty(e,t=this.#F){return t.get(e)}setProperty(e,t=this.#F){t.set(e.name,e)}async#H(e){const t=e.type===E.EXPANDED?e.patternIndexes:[],s=await e.value,r=this.#s;await Promise.all(e.referedPatternProperties.map((async e=>{const i=e.pattern;await Promise.all((Object.keys(s)??[]).map((async s=>{const n=t.concat(s);if(!y.expand(i,n).includes("*")){const t=N.create(r,{patternProperty:e,patternIndexes:n,requireSetter:e.hasSetter});this.setProperty(t),e.isArray&&this.#H(t)}})))})))}async expand(e,t=null){const s=this.getProperty(e);null!=s&&await this.#H(s)}#_(e){const t=(e.type===E.EXPANDED?e.patternIndexes:[]).join("\t"),s=e=>e.patternIndexes.join("\t").startsWith(t);e.referedPatternProperties.forEach((e=>{this.getExpandedPropertiesByPatternProperty(e).filter(s).forEach((e=>{this.removeProperty(e.name)}))}))}contract(e){const t=this.getProperty(e);null!=t&&this.#_(t)}testIsArray(e,t=this.#F){return t.has(`${e}.*`)}async#X(e,t=this.#s.cache){t.delete(e);const s=this.getProperty(e);null!=s&&s.isArray&&(this.#_(s),this.#H(s))}async updateByName(e,t=this.#s.cache){await this.#X(e),this.#s.dependencies.getReferedProperties(e).forEach((t=>e!=t.name&&this.#X(t.name)))}async updateByPatternIndexes({name:e,indexes:t}){const s=y.expand(e,t);await this.updateByName(s)}async expandAll(e=this.#F){await Promise.all(Array.from(e.entries()).map((async([e,t])=>{!e.includes("*")&&t.isArray&&this.#H(t)})))}has(e,t=this.#F){return t.has(e)}getReferedPatternPeoperties(e){const t=`${e}.`;return this.names.filter((e=>e.startsWith(t))).map((e=>this.getProperty(e))).filter((e=>e.type===E.PATTERN))}getDependencyNames(e){const t=`${e}.`;return this.names.filter((e=>e.startsWith(t)&&!e.slice(t.length).includes("."))).map((e=>this.getProperty(e))).filter((e=>e.type===E.PATTERN||E.PLAIN)).map((e=>e.name))}getExpandedPropertiesByPatternProperty(e){return this.values.filter((e=>e.type===E.EXPANDED)).filter((t=>t.patternProperty===e))}clearStatus(){return this.values.forEach((e=>e.clearStatus()))}get isUpdate(){return this.values.some((e=>e.isUpdate||e.isNew))}}class R{#z=[];#s;constructor(e){this.#s=e}get queue(){return this.#z}async notify(e,t=[]){this.#z.push({name:e,indexes:t}),await this.#s.properties.updateByPatternIndexes({name:e,indexes:t})}clear(){this.#z.splice(0)}}class D{#W=new Map;#s;constructor(e){this.#s=e}has(e){return this.#W.has(e)}get(e){return this.#W.get(e)}set(e,t){return this.#W.set(e,t),t}delete(e){this.#W.delete(e)}}class ${#G;#K;#Q;#n;#Z;#J;#Y;#ee={binds:[],loops:[]};#te=[];#se=[];#y=[];#re=[];#ie;#ne;#W;#ae;#oe;#b;#ce;#le;#v;#pe;#de;constructor(e,t){this.#b=e,this.#G=t}build(){this.#Q=new x(this),this.#Z=u,this.#J=new b(this),this.#Y=new P(this),this.#ie=new B(this),this.#ne=new R(this),this.#W=new D(this),this.#ae=t,this.#oe=r.root,this.#ce=f,this.#le=g,this.#v=e.data,this.#pe=w}get parentElement(){return this.#G}get rootElement(){return this.#K}get view(){return this.#Q}get viewModel(){return this.#n}get viewBuilder(){return this.#Z}get viewUpdater(){return this.#J}get dependencies(){return this.#Y}get bindTree(){return this.#ee}get allBinds(){return this.#te}get allLoops(){return this.#se}get indexesStack(){return this.#re}get indexes(){return this.#re[this.#re.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#y}get currentLoop(){return this.#y[this.#y.length-1]}get properties(){return this.#ie}get notifier(){return this.#ne}get cache(){return this.#W}get context(){return this}get filter(){return this.#ae}get rootBlock(){return this.#oe}get block(){return this.#b}get eventHandler(){return this.#ce}get initializer(){return this.#le}get data(){return this.#v}get dataReflecter(){return this.#pe}get template(){return this.#de.template}get module(){return this.#de}get bindRules(){return this.#de.bindRules}get dependencyRules(){return this.#de.dependencyRules}set module(e){this.#de=e,this.#n=void 0!==e.viewModel?e.viewModel:void 0!==e.AppViewModel?Reflect.construct(e.AppViewModel,[]):{},this.#K=e.template.content.cloneNode(!0);const t=e?.context??e?._;null!=t&&this.reflect(t,e.dialog)}set rootElement(e){this.#K=e}pushIndexes(e,t){this.#re.push(e);try{return t()}finally{this.#re.pop()}}pushLoop({loop:e,key:t},s){this.#y.push({loop:e,key:t});try{return s()}finally{this.#y.pop()}}getPathInfo(e,t=e,s=this.currentLoop?.loop,r=this.currentLoop?.key,i=this.indexes??[]){return"."===e[0]?"."===e?{path:`${s.path}.${r}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${r}.${e}`,pattern:`${s.pattern}.*.${e}`}:{path:y.expand(t,i),pattern:t}}setBindTree({binds:e,loops:t},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...e),s.loops.push(...t)}buildBinds(e=this.bindTree,t=this.allBinds,s=this.allLoops){t.splice(0),s.splice(0);const r=e=>t.push(e),i=e=>s.push(e);e.binds.forEach(r),e.loops.forEach(i);const n=e=>{e.children.forEach((e=>{e.binds.forEach(r),e.loops.forEach(i),e.loops.forEach(n)}))};e.loops.forEach(n)}reflect(e,t){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([t,s])=>{if(null!=s?.get){const r={configurable:!0,enumerable:!0,get:(...e)=>Reflect.apply(s.get,this,e)};Object.defineProperty(e,t,r)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postProcess","postProcess"]].forEach((([t,s])=>{const r={configurable:!0,enumerable:!1,value:"AsyncFunction"===t.constructor.name?async(...e)=>Reflect.apply(this[t],this,e):(...e)=>Reflect.apply(this[t],this,e)};Object.defineProperty(e,s,r)})),null!=t){this.$closeDialog=function(e){t.closeDialog(e)};const s={configurable:!0,enumerable:!1,value:(...e)=>Reflect.apply(this.$closeDialog,this,e)};Object.defineProperty(e,"closeDialog",s),this.$cancelDialog=function(){t.cancelDialog()};const r={configurable:!0,enumerable:!1,value:(...e)=>Reflect.apply(this.$cancelDialog,this,e)};Object.defineProperty(e,"cancelDialog",r)}}$notify(e,t=[]){this.notifier.notify(e,t)}$postProcess(e){this.viewUpdater.registPostProcess(e)}async $notifyAll(e,t=[]){this.rootBlock.notifyAll(e,t,this.block)}async $inquiryAll(e,t,s){this.$postProcess((()=>this.rootBlock.inquiryAll(e,t,s,this.block)))}async $openDialog(e,t={}){return m.open(e,t)}}const T="--bind-",C="--bind-class-";class S{dom={selector:""};viewModel={};filters=[];static createBind(e,t,s,r){const i=new S;return i.dom.selector=e,i.dom.property=t,i.viewModel.property=s,i.filters.push(...r),i}static createEvent(e,t){const s=new S;return s.dom.selector=e,s.dom.event=t,s}static createLoop(e,t){const s=new S;return s.dom.selector=e,s.viewModel.property=t,s}static build(e){const t=[];for(let s=0;s<e.style.length;s++){const r=e.style[s],i=e.style.getPropertyValue(r).trim();if("--events"===r)for(const s of i.split(",")){const r=S.createEvent(e.selectorText,s);t.push(r)}else if("--loop"===r){const s=S.createLoop(e.selectorText,i);t.push(s)}else if(r.startsWith(C)){const s=i.split("|"),n=s.shift(),a=s,o=S.createBind(e.selectorText,"class."+r.slice(C.length),n,a);t.push(o)}else if(r.startsWith(T)){const s=i.split("|"),n=s.shift(),a=s,o=S.createBind(e.selectorText,r.slice(T.length).replaceAll("-","."),n,a);t.push(o)}}return t}}class O{static spaPath;static filterPath;static localFilter;static setOptions(e,t){this.spaPath=t.spaPath??`${e}-spa`,this.localFilter=t.localFilter??!1,this.filterPath=this.localFilter?t.filterPath??`${this.spaPath}/module/filter`:null}}class L{viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;static async load(e,t,s=O.spaPath,r=new L){const i=await this.loadScript(e,s);if(Object.assign(r,i?.default??{}),void 0===r.html){const t=await this.loadHtml(e,s);Object.assign(r,{html:t})}if(void 0===r.css){const t=await this.loadCss(e,s);Object.assign(r,{css:t})}if(t&&void 0===r.bindCss&&void 0===r.bindRules){const t=await this.loadBindCss(e,s);Object.assign(r,{bindCss:t})}const n=this.buildTemplate(e,r.html,r.css);if(Object.assign(r,{template:n}),void 0===r.bindRules&&void 0!==r.bindCss){const e=this.buildBindRules(r.bindCss);Object.assign(r,{bindRules:e})}return void 0===r.dependencyRules&&(r.dependencyRules=[]),void 0===r.bindRules&&(r.bindRules=[]),r}static async loadScript(e,t=O.spaPath){const s=t.startsWith("https://")||t.startsWith("http://"),r=document.baseURI.lastIndexOf("/"),i=r>=0?document.baseURI.slice(0,r+1):"";return import(s?`${t}/module/${e}.js`:`${i}${t}/module/${e}.js`).catch((e=>{throw console.error(e),e}))}static async loadHtml(e,t=O.spaPath){return fetch(`${t}/html/${e}.html`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(e.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static async loadCss(e,t=O.spaPath){return fetch(`${t}/css/${e}.css`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(e.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static async loadBindCss(e,t=O.spaPath){return fetch(`${t}/css/${e}.bind.css`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(res.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static buildTemplate(e,t,s){const r=document.createElement("template");return r.innerHTML=t,void 0!==s&&(r.innerHTML="<style>\n"+s+"\n</style>\n"+r.innerHTML),r.dataset["x:block"]=e,r}static buildBindRules(e){return class{static collect(e){const t=document.createElement("div");document.body.appendChild(t);const s=t.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=e;const i=[];s.appendChild(r);const n=Array.from(s.styleSheets).find((e=>e.ownerNode===r));return Array.from(n?.cssRules??[]).map((e=>i.push(...S.build(e)))),document.body.removeChild(t),i}}.collect(e)}}class j{#P;#s;#he=[];#ue;constructor(e=null){this.#ue=e}get context(){return this.#s}get name(){return this.#P}createContext(e,t){return this.#P=e,this.#s=new $(this,t),this.#s.build(),this.#s}async load(e,t,s){const r=this.createContext(e,t);try{const t=await L.load(e,s);t.dialog=this.#ue,r.module=t}catch(e){throw e}}async buildView(t=e.data,s=this.#s){s.properties.build(),s.dependencies.build(),s.dataReflecter.reflect(s,t,s.viewModel),await s.initializer.init(s,t),await s.properties.expandAll(),await s.view.build(),this.#he.push(...await I.build(s.rootElement)),s.view.appear(),await s.viewUpdater.postProcess()}static async build(t,s,r,i=e.data,n=null){const a=new j(n);return await a.load(t,s,r),await a.buildView(i),a}async notifyAll(e,t,s){const r=this.#s.notifier,i=this.#s.viewModel,n=this.#s.eventHandler,a=this.#s.viewUpdater;for(const r of this.#he)r.notifyAll(e,t,s);s!==this&&a.updateProcess((async()=>{const a=n.exec(i,"notifyAll",e,t,s),o=()=>r.notify(e);return a instanceof Promise?a.then((()=>o())):o(),a}))}async inquiryAll(e,t,s,r){const i=this.#s.viewModel,n=this.#s.eventHandler,a=this.#s.viewUpdater;for(const i of this.#he)i.inquiryAll(e,t,s,r);r!==this&&a.updateProcess((async()=>n.exec(i,"inquiryAll",e,t,s,r)))}}class I{static async build(e){return await Promise.all((e=>Array.from(e.querySelectorAll("[data-x\\:block]")))(e).map((e=>(async e=>{const t=e.dataset["x:block"],s="x:withBindCss"in e.dataset;return j.build(t,e,s)})(e))))}}class V{#he=[];async build(){this.#he.push(...await I.build(document.body))}async notifyAll(e,t,s){for(const r of this.#he)r.notifyAll(e,t,s)}async inquiryAll(e,t,s,r){for(const i of this.#he)i.inquiryAll(e,t,s,r)}}t.regist("falsey",{forward:(e,t=[])=>!e}),t.regist("not",{forward:(e,t=[])=>!e}),t.regist("null",{forward:(e,t=[])=>null==e}),t.regist("style-display",{forward:(e,t=[])=>e?"":"none"}),t.regist("locale-string",{forward:(e,t=[])=>Number(e).toLocaleString()}),t.regist("fixed",{forward:(e,t=[])=>Number(e).toFixed(t[0]??0)}),t.regist("ge",{forward:(e,t=[])=>Number(e)>=Number(t[0]??0)}),t.regist("gt",{forward:(e,t=[])=>Number(e)>Number(t[0]??0)}),t.regist("le",{forward:(e,t=[])=>Number(e)<=Number(t[0]??0)}),t.regist("lt",{forward:(e,t=[])=>Number(e)<Number(t[0]??0)}),t.regist("number-value",{forward:(e,t=[])=>e?.toString()??"",backward:(e,t=[])=>""!==e?Number(e):null});window.datax=class{static root;static async boot(t={},i={}){e.setData(t),O.setOptions(this.getBaseName(),i),await class{static async registLocalFilter(e=O.localFilter,t=O.filterPath){if(e){const e=document.baseURI.lastIndexOf("/"),r=e>=0?document.baseURI.slice(0,e+1):"";await s(108)(`${r}${t}/regist.js`)}}}.registLocalFilter(),this.root=new V(this),r.setRoot(this.root),await this.root.build()}static getBaseName(){const e=location.href.split("/").pop();if(e){const t=e.split(".");return t.pop(),t.join(".")}return e}}})()})();