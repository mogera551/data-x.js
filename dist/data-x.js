(()=>{var e={108:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=108,e.exports=t}},t={};function s(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,s),r.exports}s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{static data={};static setData(e){this.data=e}}class t{static root={};static setRoot(e){this.root=e}}class o{static filterByName=new Map;static regist(e,t){this.filterByName.set(e,t)}static forward(e,t){return e.reduce(((e,t)=>"forward"in t.filter?((e,t)=>e.filter.forward(t,e.options))(t,e):e),t)}static backward(e,t){return e.reduce(((e,t)=>"backward"in t.filter?((e,t)=>e.filter.backward(t,e.options))(t,e):e),t)}}class i{#e=new Q;#t;#s;#o;constructor(e,t){this.#t=e,this.#s=t}get data(){return this.#t}get callback(){return this.#s}get blocks(){return this.#e.blocks}get block(){return this.#o}set block(e){this.#o=e}async updateProcess(e){this.#e.updateProcess(e)}notifyAll(e,t,s){this.#e.notifyAll(e,t,s),this.callback&&this.callback(this.data)}async inquiryAll(e,t,s,o){await this.#e.inquiryAll(e,t,s,o)}}class r{#o;#t;#i;#e;#r;#a;#n;#l;constructor(e,t){this.#i=e,this.#t=t}get name(){return this.#i}get data(){return this.#t}get block(){return this.#o}get root(){return this.#e}createBackLayer(e=this.#i){const t=document.createElement("div");t.dataset["x:dialog"]=e;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(e=>this.cancelDialog())),t.appendChild(s);const o=document.createElement("div");return o.style.backgroundColor="white",o.style.borderRadius=".375rem",o.style.padding="2rem",o.classList.add("fg"),o.addEventListener("click",(e=>e.stopPropagation())),s.appendChild(o),{root:t,bg:s,fg:o}}async build(e=this.#i,t=this.#t,s=!1){const{root:o,bg:r,fg:a}=this.createBackLayer(e),n=new i(t),l=await U.create({name:e,parentElement:a,withBindCss:s,rootBlock:n,dialog:this});return n.blocks.push(l),document.body.appendChild(o),this.#o=l,this.#e=o,this}static async create(e=this.#i,t=this.#t,s=!1){return new r(e,t).build(e,t,s)}cancelDialog(){this.#l&&this.#l()}closeDialog(e){this.#n&&this.#n(e)}async main(){return new Promise(((e,t)=>{this.#n=e,this.#l=t})).finally((()=>{this.#e.parentNode.removeChild(this.#e)}))}static async open(e,t={}){return(await r.create(e,t)).main()}}class a{static expand(e,t,s=t.slice()){let o=!1;const i=e.replaceAll("*",(()=>s.shift()??(o=!0,"*")));return o?null:i}}class n{static async exec(e,t,...s){const o=t[0].toUpperCase()+t.slice(1),i=`event${o}`,r=`on${o}`;if(i in e){const t=Object.getOwnPropertyDescriptor(e,i);return Reflect.apply(t.set,e,[s])}if(r in e)return e[r](...s)}}class l{static async init(e,t,s=e.proxyViewModel,o=e.properties){await n.exec(s,"init",t);for(const e of o){if(null==e?.init)continue;const o=e.init(t),i=o instanceof Promise?await o:o;e.nameInfo.isPrimitive?s[e.nameInfo.privateName]=i:s[e.name]=i}}}const c={suspend:Symbol("")};class d{static reflect(e,t,s={},o=e.notifier){Object.keys(t).forEach((i=>{const r=`$${i}`,a={configurable:!1,enumerable:!0,get:()=>Reflect.get(t,i),set:s=>{Reflect.set(t,i,s),o.notify(new Promise(((t,s)=>{e.$notifyAll(r),t({name:r})})))}};Object.defineProperty(s,r,a)}))}}class u extends FileReader{constructor(){super()}#c(e,t){return new Promise(((s,o)=>{super.addEventListener("load",(({target:e})=>s(e.result))),super.addEventListener("error",(({target:e})=>o(e.error))),super[t](e)}))}readAsArrayBuffer(e){return this.#c(e,"readAsArrayBuffer")}readAsDataURL(e){return this.#c(e,"readAsDataURL")}readAsText(e){return this.#c(e,"readAsText")}}class p{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static FILE=5;static matchClass="class.";static matchFile="file";static matchRadio="radio";static matchCheckbox="checkbox";static getType(e){return e===this.matchFile?this.FILE:e===this.matchRadio?this.RADIO:e===this.matchCheckbox?this.CHECKBOX:e.startsWith(this.matchClass)?this.CLASS:this.VALUE}static async getValue(e,t){return e[t]}static async updateDomByValueType(e){const t=e.domProperty.split("."),s=await this.getValue(e.proxyViewModel,e.path),o=(e,t,s,i=e.shift())=>0===e.length?t[i]!==s&&(t[i]=s):o(e,t[i],s),i=s=>o(t,e.dom,e.filter.forward(e.forwardFilters,s));s instanceof Promise?s.then((e=>i(e))):i(s)}static async updateDomByClassType(e){const t=e.domProperty.slice(this.matchClass.length),s=await this.getValue(e.proxyViewModel,e.path),o=s=>e.filter.forward(e.forwardFilters,s)?!e.dom.classList.contains(t)&&e.dom.classList.add(t):e.dom.classList.contains(t)&&e.dom.classList.remove(t);s instanceof Promise?s.then((e=>o(e))):o(s)}static async updateDomByRadioType(e){const t=await this.getValue(e.proxyViewModel,e.path),s=t=>e.dom.checked=e.dom.value===e.filter.forward(e.forwardFilters,t);t instanceof Promise?t.then((e=>s(e))):s(t)}static async updateDomByCheckboxType(e){const t=await this.getValue(e.proxyViewModel,e.path),s=t=>e.dom.checked=(e.filter.forward(e.forwardFilters,t)??[]).includes(e.dom.value);t instanceof Promise?t.then((e=>s(e))):s(t)}static async updateDomByFileType(e){}static async setValue(e,t,s){e[t]=s}static async updateViewModelByValueType(e){const t=e.domProperty.split("."),s=(e,t,o=e.shift())=>0===e.length?t[o]:s(e,t[o]),o=e.filter.backward(e.backwardFilters,s(t,e.dom));await this.setValue(e.proxyViewModel,e.path,o)}static async updateViewModelByClassType(e){const t=e.domProperty.slice(this.matchClass.length),s=e.dom.classList.contains(t);await this.setValue(e.proxyViewModel,e.path,s)}static async updateViewModelByRadioType(e){if(e.dom.checked){const t=e.dom.value;await this.setValue(e.proxyViewModel,e.path,t)}}static async updateViewModelByCheckboxType(e){const t=new Set(e.proxyViewModel[e.path]??[]);e.dom.checked?t.add(e.dom.value):t.delete(e.dom.value);const s=Array.from(t);await this.setValue(e.proxyViewModel,e.path,s)}static async updateViewModelByFileType(e){if(0==e.dom.files.length)return;const t=new u,s=await t.readAsText(e.dom.files[0]),o=e.filter.backward(e.backwardFilters,s);await this.setValue(e.proxyViewModel,e.path,o)}static#d={};static#u={};static init(){this.#d[this.VALUE]=this.updateDomByValueType,this.#d[this.CLASS]=this.updateDomByClassType,this.#d[this.RADIO]=this.updateDomByRadioType,this.#d[this.CHECKBOX]=this.updateDomByCheckboxType,this.#d[this.FILE]=this.updateDomByFileType,this.#u[this.VALUE]=this.updateViewModelByValueType,this.#u[this.CLASS]=this.updateViewModelByClassType,this.#u[this.RADIO]=this.updateViewModelByRadioType,this.#u[this.CHECKBOX]=this.updateViewModelByCheckboxType,this.#u[this.FILE]=this.updateViewModelByFileType}static async updateDom(e,t=e.domPropertyType){await Reflect.apply(this.#d[t],this,[e])}static async updateViewModel(e,t=e.domPropertyType){await Reflect.apply(this.#u[t],this,[e])}}class h{#p;#h;#m;#f;#y;#g;#w;#b;#x;#v;#P;#k;constructor(e,t,s){this.#h=e,this.#m=t.dom?.property,this.#f=s.proxyViewModel,this.#y=t.viewModel?.property,this.#g=t.inputable,this.#P=class{static parse(e){return 0==e.length?[]:e.split("|").map((e=>e.split(":"))).map((([e,t])=>({name:e,options:t?.split(";")??[],filter:o.filterByName.get(e)})))}}.parse(t?.filters.join("|"))??[],this.#k=this.#P.slice().reverse(),this.#p=s,this.#w=s.indexes?.slice()??[],this.#v=p.getType(this.#m);const{path:i,pattern:r}=s.getPathInfo(this.#y);this.#b=i,this.#x=r}get dom(){return this.#h}get domProperty(){return this.#m}get proxyViewModel(){return this.#f}get path(){return this.#b}get pattern(){return this.#x}get domPropertyType(){return this.#v}get forwardFilters(){return this.#P}get backwardFilters(){return this.#k}get filter(){return this.#p.filter}async init(e=this.#g){e&&this.attachEvent(),await this.updateDom()}async updateDom(){await p.updateDom(this)}async#E(){await p.updateViewModel(this)}attachEvent(e=this.#h,t=this.#p,s=t.view){e.addEventListener("input",(async e=>{await t.$updateProcess((()=>this.#E()))}))}}p.init();class m{nodes=[];loops;binds;key}class f{#h;#y;#M=[];#p;#b;#x;#B;constructor(e,t,s){this.#h=e,this.#y=t.viewModel?.property,this.#p=s;const{path:o,pattern:i}=s.getPathInfo(this.#y);this.#b=o,this.#x=i,this.#B=s.loopStack.slice()}get dom(){return this.#h}get path(){return this.#b}get pattern(){return this.#x}get children(){return this.#M}async#C(e,t=this.#h,s=this.#p){return s.pushLoop({loop:this,key:e},(()=>{const o=s.loopStack.map((e=>e.key));return s.pushIndexes(o,(async()=>{const o=document.createDocumentFragment(),i=new m,r=t.content.cloneNode(!0),{binds:a,loops:n}=await s.view.createBindTree(s,r);return Object.assign(i,{key:e,binds:a,loops:n}),o.appendChild(r),i.nodes.push(...Array.from(o.childNodes)),i}))}))}async expand(e=this.#p.proxyViewModel,t=this.#b,s=this.#M,o=this.#h){const i=await e[t];try{for(const e of Object.keys(i))s.push(await this.#C(e))}catch(e){throw console.log(e,t,i),e}const r=document.createDocumentFragment(),a=e=>r.appendChild(e);s.forEach((e=>e.nodes.forEach(a))),o.after(r)}#A(e,t=this.#p){const s=this.#B.slice(),o=s=>{if(0===s.length)return e();const i=s.pop();return t.pushLoop(i,(()=>o(s)))};return o(s)}#R(e){e.loops.forEach((e=>e.contract())),e.nodes.forEach((e=>e.parentNode.removeChild(e)))}contract(e=this.#M){e.forEach((e=>this.#R(e))),e.splice(0)}async update(){this.contract(),await this.#A((async()=>this.expand()))}}class y{#h;#p;#$;#w;#D;constructor(e,t,s){this.#h=e,this.#$=t.dom?.event,this.#p=s,this.#w=s.indexes?.slice()??[],this.#D=this.#T()}get event(){return this.#$}get dom(){return this.#h}init(){this.#V()}#T(){const e=this.#h;return`${this.#$.toLowerCase()}${t="x:name"in e?.dataset?e?.dataset["x:name"]:e?.name?.length>0?e.name:e.tagName.toLowerCase(),t?.length>0?t.at(0).toUpperCase()+t.slice(1):""}`;var t}async#N(e,t=this.#p.proxyViewModel,s=this.#p.eventHandler,o=this.#D,i=this.#w,r=this.#p){return r.pushIndexes(i,(()=>s.exec(t,o,e,...i)))}#V(e=this.#h,t=this.#$,s=this.#p,o=s.view){e.addEventListener(t,(async e=>{await s.$updateProcess((()=>this.#N(e)))}))}}const g=":not([data-x\\:processed])",w="x:ignore",b=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((e=>`${e}${g}`)).join(","),x=["input","textarea","select","button"].map((e=>`${e}${g}`)).join(",");class v{static async createBindTree(e,t,s=e.bindRules){const{loops:o,binds:i,events:r}=class{static inputable(e){return"INPUT"===e.tagName&&"button"!==e.type||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||!0===e?.isContentEditable}static testFile(e){return"INPUT"===e.tagName&&"file"===e.type}static testRadio(e){return"INPUT"===e.tagName&&"radio"===e.type}static testCheckbox(e){return"INPUT"===e.tagName&&"checkbox"===e.type}static parsePropertyName(e){const t=e.split("|");return{property:t.shift(),filters:t}}static parseDataBind(e,t,s=this.inputable(e),o=this.testFile(e),i=this.testRadio(e),r=this.testCheckbox(e)){const a=(t,a)=>{if(t.includes("=")){const[n,l]=t.split("="),{property:c,filters:d}=this.parsePropertyName(l);a.dom.property=n,a.viewModel.property=c,a.filters=d;const u=new Set(s?o?["file"]:i?["radio"]:r?["checked","checkbox"]:e.isContentEditable?["textContent"]:["value"]:[]);a.inputable=u.has(n)}else{const{property:n,filters:l}=this.parsePropertyName(t);a.dom.property=s?o?"file":i?"radio":r?"checkbox":e.isContentEditable?"textContent":"value":"textContent",a.viewModel.property=n,a.filters=l,a.inputable=s}return a},n=t.split(",");if(1==n.length)return[a(t,{dom:{},viewModel:{},filters:[]})];{const e=n.map((e=>a(e,{dom:{},viewModel:{},filters:[]})));return e}}static collectByAttribute(e,t,s=[],o=[],i=[]){return Array.from(t.querySelectorAll(b)).forEach((t=>{if(w in t.dataset)return;const r=t.dataset["x:processing"]?.split(",")??[];if("x:loop"in t.dataset){if("TEMPLATE"!==t.tagName)return;if(r.includes("loop"))return;const s={dom:{},viewModel:{property:t.dataset["x:loop"]},filters:[]};o.push(new f(t,s,e)),r.push("loop")}else{if("x:bind"in t.dataset){if(r.includes("bind"))return;s.push(...this.parseDataBind(t,t.dataset["x:bind"]).map((s=>new h(t,s,e)))),r.push("bind")}if("x:events"in t.dataset){if(r.includes("events"))return;t.dataset["x:events"].split(",").forEach((s=>{const o={dom:{event:s},viewModel:{},filters:[]};i.push(new y(t,o,e))})),r.push("events")}}t.dataset["x:processing"]=r.join(",")})),{binds:s,loops:o,events:i}}static collectByImplicit(e,t,s=[],o=[],i=[]){return Array.from(t.querySelectorAll(x)).forEach((t=>{if(w in t.dataset)return;const o=t.dataset["x:processing"]?.split(",")??[],r=this.testFile(t),a=this.testRadio(t),n=this.testCheckbox(t),l={dom:{},viewModel:{},filters:[]};if("BUTTON"===t.tagName||"INPUT"===t.tagName&&"button"===t.type){if(o.includes("events"))return;l.dom.event="click",i.push(new y(t,l,e)),o.push("events")}else{if(o.includes("bind"))return;const{property:i,filters:c}=this.parsePropertyName(t.name);l.dom.property=r?"file":a?"radio":n?"checkbox":"value",l.viewModel.property=i,l.filters=c,l.inputable=!0,s.push(new h(t,l,e)),o.push("bind")}t.dataset["x:processing"]=o.join(",")})),{binds:s,loops:o,events:i}}static collectByRule(e,t,s,o=[],i=[],r=[]){const a=new Map;return s.forEach((e=>{!a.has(e.dom.selector)&&a.set(e.dom.selector,[]),a.get(e.dom.selector).push(e)})),Array.from(a.keys()).forEach((s=>{t.querySelectorAll(`${s}${g}`).forEach((t=>{if(w in t.dataset)return;const n=this.inputable(t),l=t.dataset["x:processing"]?.split(",")??[],c=l.slice();a.get(s).forEach((s=>{const a=JSON.parse(JSON.stringify(s));if("TEMPLATE"===t.tagName){if(l.includes("loop"))return;((t,s)=>{i.push(new f(s,t,e))})(a,t),c.push("loop")}else if("event"in a.dom){if(l.includes("events"))return;((t,s)=>{r.push(new y(s,t,e))})(a,t),c.push("events")}else{if(l.includes("bind"))return;a.inputable=n,((t,s)=>{o.push(new h(s,t,e))})(a,t),c.push("bind")}})),t.dataset["x:processing"]=c.join(",")}))})),{loops:i,binds:o,events:r}}static collect(e,t,s=[]){const o=[],i=[],r=[];return this.collectByRule(e,t,s,o,i,r),this.collectByAttribute(e,t,o,i,r),this.collectByImplicit(e,t,o,i,r),o.forEach((e=>e.dom.dataset["x:processed"]="")),i.forEach((e=>e.dom.dataset["x:processed"]="")),r.forEach((e=>e.dom.dataset["x:processed"]="")),Array.from(t.querySelectorAll("[data-x\\:processing]")).forEach((e=>{e.removeAttribute("data-x:processing")})),{loops:i,binds:o,events:r}}}.collect(e,t,s);return await Promise.all(o.map((e=>e.expand()))),await Promise.all(i.map((e=>e.init()))),r.forEach((e=>e.init())),{loops:o,binds:i,events:r}}static async build(e,t=e.rootElement){const s=await this.createBindTree(e,t);e.setBindTree(s),e.buildBinds()}static appear(e,t=e.fragment,s=e.parentElement){const o=s.attachShadow({mode:"open"});o.appendChild(t),e.rootElement=o}static attachTo(e,t){e.parentElement=t,this.appear(e)}static async updateDom(e,t=e.updateQueue,s=e.allBinds,o=e.allLoops,i=e.properties,r=e.dependencies,n=e.proxyViewModel,l=e.cache){const c=await Promise.all(t),d=[];for(const{name:e,indexes:t=[]}of c.filter((e=>null!=e))){d.push(a.expand(e,t));for(const s of r.getReferedProperties(e,t))d.push(s.name)}const u=new Set(d);await Promise.all(Array.from(u).map((e=>{l.delete(e),Reflect.get(n,e)})));for(const e of o.filter((e=>u.has(e.path))))await e.update();for(const e of s.filter((e=>u.has(e.path))))await e.updateDom();e.buildBinds()}static async postProcess(e,t=e.postProcess){t.exec()}static async updateProcess(e,t,s=e.notifier,o=e.properties,i=e.postProcess){i.clear(),s.clear(),o.clearStatus(),await t(),await this.updateDom(e),o.isUpdate&&e.buildBinds(),await i.exec()}}class P{parentNodes=[];name;func;childNodes=[];constructor(e){this.name=e}}class k{#O=new Map;#S;#p;constructor(e){this.#p=e}get map(){return this.#O}build(e=this.#O,t=this.#p.dependencyRules){e.clear(),this.#S=this.#p.dependencyRules.slice(),t.forEach((([e,t,s])=>this.add(e,t,s))),this.implicitDependency()}implicitDependency(e=this.#p.props,t=this.#p.properties){for(const s of t)e.getDependencyNames(t,s.name).forEach((e=>this.add(e,[s.name])))}add(e,t,s,o=this.#O){o.has(e)||o.set(e,new P(e));const i=o.get(e);i.func=s,t.forEach((e=>{o.has(e)||o.set(e,new P(e));const t=o.get(e);i.childNodes.push(t),t.parentNodes.push(i)}))}getReferedProperties(e,t,s=this.#O,o=this.#p.proxyViewModel){const i=s.get(e),r=new Set,n=t??[],l=(e,t)=>{if(null==e)return t;const s=a.expand(e.name,n);if(null!==s){if(r.has(s))return t;r.add(s);const i=e.func?Reflect.apply(e.func,o,[n]):n;if(!1===i)return t;const a={name:s,pattern:e.name,indexes:i};t.push(a)}return e.parentNodes.forEach((e=>{t=l(e,t)})),t};return l(i,[])}}class E{#j=[];#p;constructor(e){this.#p=e}get queue(){return this.#j}notify(e,t=this.#j){t.push(e)}dequeue(e=this.#j){const t=e.slice();return e.splice(0),t}clear(e=this.#j){e.splice(0)}}class M{#L=new Map;#p;constructor(e){this.#p=e}has(e){return this.#L.has(e)}get(e){return this.#L.get(e)}set(e,t){const s=t=>{"object"==typeof t&&null!==t&&"__notifiable"in t&&(t.__name=e),this.#L.set(e,t)};return s(t),t instanceof Promise&&t.then((e=>s(e))),t}delete(e){this.#L.delete(e);const t=`${e}.`;Array.from(this.#L.keys()).filter((e=>e.startsWith(t))).forEach((e=>this.#L.delete(e)))}}class B{#p;#j=[];constructor(e){this.#p=e}regist(e,t=this.#j){t.push(e)}exec(e=this.#p,t=this.#j,s=e.view){const o=t.slice();t.splice(0);const i=[];if(o.length>0)for(const e of o)i.push(e());return Promise.all(i)}clear(e=this.#j){e.splice(0)}}class C{#i;#p;constructor(e){this.#p=e}has(e,t){return"__notifiable"===t||Reflect.has(e,t)}get(e,t,s){return"__notifiable"===t||("__name"===t?this.#i:Reflect.get(e,t,s))}set(e,t,s,o){if("__name"===t)return this.#i=s,!0;if("length"===t){const e=this.#i;null!=e&&this.#p.notifier.notify({name:e})}return Reflect.set(e,t,s,o)}static notifiable(e,t){return new Proxy(t,new C(e))}}class A{name;parent;last;loops;privateName;isPath;isPattern;isPrimitive;static get(e){const t=new A;t.name=e;const s=e.includes("."),o=e.includes("*");if(t.isPath=s&&!o,t.isPattern=s&&o,t.isPrimitive=!t.isPath&&!t.isPattern,t.isPath||t.isPattern){const s=e.split(".");t.last=s.pop(),t.parent=s.join(".")}return t.isPattern&&(t.loops=e.split("").filter((e=>"*"===e)).length),t.isPrimitive&&(t.privateName=`__${e}`),t}}class R{static createDefault(e,t){return t.isPrimitive?class{static create(e,{privateName:t}){return{get:function(){return this[t]},set:function(e){this[t]=e}}}}.create(e,t):t.isPath?class{static create(e,{parent:t,last:s}){return{get:function(){return this[t]?.[s]},set:function(e){this[t][s]=e}}}}.create(e,t):t.isPattern?class{static create(e,{parent:t,last:s,loops:o}){const i=e=>"*"===s?e.indexes.at(o-1):s;return{get:function(){return this[t]?.[i(e)]},set:function(s){this[t][i(e)]=s}}}}.create(e,t):null}static wrapGetter(e,t){return function(){const s=e.indexes??[],o=e.proxyViewModel;return Reflect.apply(t,o,[...s])}}static wrapSetter(e,t){return function(s){const o=e.indexes??[],i=e.proxyViewModel;return Reflect.apply(t,i,[s,...o])}}}const $=new RegExp(/^(\@\@?)([a-zA-Z0-9_\.\*]+)(#(get|set|init)?)?$/),D=new RegExp(/^(#)(event[a-zA-Z0-9_]+)$/),T=new RegExp(/^__([a-zA-Z0-9_])+$/),V=(e,t)=>{do{t(e),e=Object.getPrototypeOf(e)}while(e!==Object.prototype)};class N{name;nameInfo;init}class O{static build(e,t=e.viewModel){const s=[],o=e=>({configurable:!0,enumerable:!1,writable:!0,value:e?.value}),i=new Map;V(t,(e=>{Object.entries(Object.getOwnPropertyDescriptors(e)).forEach((([s,r])=>{const a=(e=>$.exec(e))(s),n=(e=>D.exec(e))(s),l=(e=>T.exec(e))(s);null===a&&null===l&&null===n||(null!==l?Reflect.defineProperty(t,s,o(r)):null!==a?((([,e,t,s,o],r)=>{const a=i.has(t)?i.get(t):{baseName:null,get:null,set:null,init:null,requireSet:void 0,initValue:void 0};a.baseName=a.baseName??t;const n=(e,s)=>"function"==typeof e?e:console.error(`${t}.${s} is not function`);null!=s&&null==o?("object"!=typeof r.value&&console.error(`${t}.# is not object`),a.get=a.get??r.value?.get?n(r.value.get,"#get"):a.get,a.set=a.set??r.value?.set?n(r.value.set,"#set"):a.set,a.init=a.init??r.value?.init?n(r.value.init,"#init"):a.init):null!=s&&null!=o&&(a.get=a.get??"get"===o?n(r.value,"#get"):a.get,a.set=a.set??"set"===o?n(r.value,"#set"):a.set,a.init=a.init??"init"===o?n(r.value,"#init"):a.init),a.requireSet=void 0===a.requireSet?"@@"==e:a.requireSet,void 0!==a.requireSet&&a.requireSet!=("@@"==e)&&console.error("@@ is not match"),a.initValue=null==s?r?.value:a.initValue,i.set(t,a)})(a,r),Reflect.deleteProperty(e,s)):null!==n&&((([,,e],t)=>{const s=i.has(e)?i.get(e):{baseName:null,get:null,set:null,init:null,requireSet:void 0,initValue:void 0};var o;s.baseName=s.baseName??e,s.set=s.set??("function"==typeof(o=t.value)?o:console.error(`#${e} is not function`)),s.requireSet=!0,i.set(e,s)})(n,r),Reflect.deleteProperty(e,s)))}))}));const r=(e,t)=>e!==Object.prototype?Object.getOwnPropertyDescriptor(e,t)??r(Object.getPrototypeOf(e)):{};Array.from(i.entries()).forEach((([i,a])=>{const n=A.get(i);!(n.privateName in t)&&n.isPrimitive&&Reflect.defineProperty(t,n.privateName,o({value:a.initValue}));const l=r(t,i),c=R.createDefault(e,n),d={configurable:!0,enumerable:!0};d.get=(a.get?R.wrapGetter(e,a.get):null)??l.get??c.get,a.requireSet&&(d.set=(a.set?R.wrapSetter(e,a.set):null)??l.set??c.set),Object.defineProperty(t,i,d),s.push(Object.assign(new N,{name:i,nameInfo:n,init:a?.init}))})),V(t,(o=>{t!==o&&Object.entries(Object.getOwnPropertyDescriptors(o)).forEach((([o,i])=>{if(t.hasOwnProperty(o))return;if(null==i?.get&&null==i?.set)return;const r=A.get(o);if(null==i?.get&&null!=i?.set){const t=R.createDefault(e,r);i.get=t.get}i.enumerable=!0,Object.defineProperty(t,o,i),s.push(Object.assign(new N,{name:o,nameInfo:r}))}))}));const a=[];return Array.from(Object.keys(t)).forEach((e=>{const t=e.split(".").reduce(((e,t)=>(e.push(e.at(-1)?.slice()??[]),e.at(-1).push(t),e)),[]);a.push(...t.map((e=>e.join("."))))})),Array.from(new Set(a)).filter((e=>!t.hasOwnProperty(e))).forEach((o=>{const i={configurable:!0,enumerable:!0},r=A.get(o),a=R.createDefault(e,r);i.get=a.get,Object.defineProperty(t,o,i),s.push(Object.assign(new N,{name:o,nameInfo:r}))})),s}static getDependencyNames(e,t){const s=`${t}.`;return e.map((e=>e.name)).filter((e=>e.startsWith(s)&&!e.slice(s.length).includes(".")))}}class S{#p;#F=new Map;#q=new Map;constructor(e){this.#p=e}patternToRegExp(e){return new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([a-zA-Z0-9_]+)")+"$")}getExpandName(e,t,s=this.#F,o=this.#q){if(s.has(t))return s.get(t);for(const i of Object.keys(e)){if(!i.includes("*"))continue;o.has(i)||o.set(i,this.patternToRegExp(i));const e=o.get(i).exec(t)?.slice(1);if(null!=e){const o={name:t,pattern:i,indexes:e};return s.set(t,o),o}}}get(e,t,s,o=this.#p,i=o.cache){if(i.has(t))return i.get(t);if(t in e){const o=Reflect.get(e,t,s);return t.includes("*")?o:i.set(t,o)}{const r=this.getExpandName(e,t);if(null!=r)return o.pushIndexes(r.indexes,(()=>{const o=Reflect.get(e,r.pattern,s);return i.set(t,o)}))}console.error(`undefied property "${t}"`)}set(e,t,s,o,i=this.#p,r=i.cache,a=i.notifier){r.has(t)&&r.delete(t);const n=(e,t)=>{a.notify(new Promise((async(s,o)=>{s(await e!==c.suspend?t:null)})))};if(t in e){const i=Object.getOwnPropertyDescriptor(e,t),r=i?.set?Reflect.apply(i.set,o,[s]):Reflect.set(e,t,s,o);return i?.set&&n(r,{name:t}),!0}{const r=this.getExpandName(e,t);if(null!=r)return i.pushIndexes(r.indexes,(()=>{const t=Object.getOwnPropertyDescriptor(e,r.pattern),i=t?.set?Reflect.apply(t.set,o,[s]):Reflect.set(e,r.pattern,s,o);n(i,{name:r.pattern,indexes:r.indexes})})),!0}console.error(`undefied property "${t}"`)}}class j{#I;#_;#U;#H;#Q;#z;#W;#X={binds:[],loops:[]};#K=[];#Z=[];#B=[];#G=[];#J;#Y;#L;#ee;#o;#te;#se=[];#f;constructor(e,t,s){this.#o=e,this.#I=t,this.#ee=s}build(){this.#H=v,this.#z=new B(this),this.#W=new k(this),this.#Y=new E(this),this.#L=new M(this)}get parentElement(){return this.#I}get fragment(){return this.#_}get rootElement(){return this.#U??this.#_}get view(){return this.#H}get viewModel(){return this.#Q}get postProcess(){return this.#z}get dependencies(){return this.#W}get bindTree(){return this.#X}get allBinds(){return this.#K}get allLoops(){return this.#Z}get indexesStack(){return this.#G}get indexes(){return this.#G[this.#G.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#B}get currentLoop(){return this.#B[this.#B.length-1]}get properties(){return this.#J}get notifier(){return this.#Y}get cache(){return this.#L}get context(){return this}get rootBlock(){return this.#ee}get block(){return this.#o}get data(){return this.#ee.data}get template(){return this.#te.template}get module(){return this.#te}get moduleDatas(){return this.#te.moduleDatas}get bindRules(){return this.#te.bindRules}get dependencyRules(){return this.#te.dependencyRules}get isBlockModule(){return this.#te.useModule}get symbols(){return c}get updateQueue(){return this.#se}get notifiable(){return C}get props(){return O}get filter(){return o}get eventHandler(){return n}get initializer(){return l}get dataReflecter(){return d}get proxyHandler(){return S}get proxyViewModel(){return this.#f}set module(e){this.#te=e,this.#Q=void 0!==e.viewModel?e.viewModel:void 0!==e.AppViewModel?Reflect.construct(e.AppViewModel,[]):{},this.#_=e.template.content.cloneNode(!0);const t=e?.context??e?._;null!=t&&this.reflect(t,e.dialog),this.#f=new Proxy(this.#Q,Reflect.construct(this.proxyHandler,[this]))}set rootElement(e){this.#U=e}set parentElement(e){this.#I=e}set properties(e){this.#J=e}copyUpdateQueue(){this.#se=this.#Y.dequeue()}pushIndexes(e,t){this.#G.push(e);const s=t();return s instanceof Promise?s.finally((()=>this.#G.pop())):this.#G.pop(),s}pushLoop({loop:e,key:t},s){this.#B.push({loop:e,key:t});const o=s();return o instanceof Promise?o.finally((()=>this.#B.pop())):this.#B.pop(),o}getPathInfo(e,t=e,s=this.currentLoop?.loop,o=this.currentLoop?.key,i=this.indexes??[]){return"."===e[0]?"."===e?{path:`${s.path}.${o}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${o}.${e}`,pattern:`${s.pattern}.*.${e}`}:{path:a.expand(t,i),pattern:t}}setBindTree({binds:e,loops:t},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...e),s.loops.push(...t)}buildBinds(e=this.bindTree,t=this.allBinds,s=this.allLoops){t.splice(0),s.splice(0);const o=e=>t.push(e),i=e=>s.push(e);e.binds.forEach(o),e.loops.forEach(i);const r=e=>{e.children.forEach((e=>{e.binds.forEach(o),e.loops.forEach(i),e.loops.forEach(r)}))};e.loops.forEach(r)}reflect(e,t){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([t,s])=>{if(null!=s?.get){const o={configurable:!0,enumerable:!0,get:(...e)=>Reflect.apply(s.get,this,e)};Object.defineProperty(e,t,o)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postProcess","postProcess"],["$updateProcess","updateProcess"],["$notifiable","notifiable"]].forEach((([t,s])=>{const o={configurable:!0,enumerable:!1,value:"AsyncFunction"===t.constructor.name?async(...e)=>Reflect.apply(this[t],this,e):(...e)=>Reflect.apply(this[t],this,e)};Object.defineProperty(e,s,o)})),null!=t){this.$closeDialog=function(e){t.closeDialog(e)};const s={configurable:!0,enumerable:!1,value:(...e)=>Reflect.apply(this.$closeDialog,this,e)};Object.defineProperty(e,"closeDialog",s),this.$cancelDialog=function(){t.cancelDialog()};const o={configurable:!0,enumerable:!1,value:(...e)=>Reflect.apply(this.$cancelDialog,this,e)};Object.defineProperty(e,"cancelDialog",o)}}$notify(e,t=[]){this.notifier.notify({name:e,indexes:t})}$postProcess(e){this.postProcess.regist(e)}$notifyAll(e,t=[]){this.rootBlock.notifyAll(e,t,this.block)}$notifiable(e){return this.notifiable.notifiable(this,e)}async $updateProcess(e){this.rootBlock.updateProcess(e)}$inquiryAll(e,t,s){return this.$postProcess((()=>this.rootBlock.inquiryAll(e,t,s,this.block)))}async $openDialog(e,t={}){return r.open(e,t)}}const L="--bind-",F="--bind-class-";class q{dom={selector:""};viewModel={};filters=[];static#oe(e,t,s,o){const i=new q;return i.dom.selector=e,i.dom.property=t,i.viewModel.property=s,i.filters.push(...o),i}static#ie(e,t){const s=new q;return s.dom.selector=e,s.dom.event=t,s}static#re(e,t){const s=new q;return s.dom.selector=e,s.viewModel.property=t,s}static build(e){const t=[];for(let s=0;s<e.style.length;s++){const o=e.style[s],i=e.style.getPropertyValue(o).trim();if("--events"===o)for(const s of i.split(",")){const o=q.#ie(e.selectorText,s);t.push(o)}else if("--loop"===o){const s=q.#re(e.selectorText,i);t.push(s)}else if(o.startsWith(F)){const s=i.split("|"),r=s.shift(),a=s,n=q.#oe(e.selectorText,"class."+o.slice(F.length),r,a);t.push(n)}else if(o.startsWith(L)){const s=i.split("|"),r=s.shift(),a=s,n=q.#oe(e.selectorText,o.slice(L.length).replaceAll("-","."),r,a);t.push(n)}}return t}}class I{static spaPath;static spaCssPath;static spaHtmlPath;static spaModulePath;static filterPath;static localFilter;static modulePath=".";static setOptions(e,t){this.spaPath=t.spaPath??(e?`${e}-spa`:"spa"),this.spaCssPath=`${this.spaPath}/css`,this.spaHtmlPath=`${this.spaPath}/html`,this.spaModulePath=`${this.spaPath}/module`,this.modulePath=t.modulePath??".",this.localFilter=t.localFilter??!1,this.filterPath=this.localFilter?t.filterPath??`${this.spaPath}/module/filter`:null}}class _{name;viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;useModule;moduleDatas;static async load({name:e,useModule:t,withBindCss:s,module:o=new _}){const i=t?null:I.spaCssPath,r=t?null:I.spaHtmlPath,a=t?null:I.spaModulePath,n=t?I.modulePath:null;o.name=e,o.useModule=t;const l=await this.loadScript(e,n??a);if(Object.assign(o,l?.default??{}),void 0===o.html&&null!==r){const t=await this.loadHtml(e,r);Object.assign(o,{html:t})}if(void 0===o.css&&null!==i){const t=await this.loadCss(e,i);Object.assign(o,{css:t})}if(s&&void 0===o.bindCss&&null!==i&&void 0===o.bindRules){const t=await this.loadBindCss(e,i);Object.assign(o,{bindCss:t})}return this.build(e,o,t)}static build(e,t,s=!1){t.useModule=s;const o=this.buildTemplate(e,t.html,t.css);if(Object.assign(t,{template:o}),void 0===t.bindRules&&void 0!==t.bindCss){const e=this.buildBindRules(t.bindCss);Object.assign(t,{bindRules:e})}return void 0===t.dependencyRules&&(t.dependencyRules=[]),void 0===t.bindRules&&(t.bindRules=[]),t}static async loadScript(e,t){const s=t.startsWith("https://")||t.startsWith("http://")||"/"===t[0],o=document.baseURI.lastIndexOf("/"),i=o>=0?document.baseURI.slice(0,o+1):"";return import(s?`${t}/${e}.js`:`${i}${t}/${e}.js`).catch((e=>{throw console.error(e),e}))}static async loadHtml(e,t){return fetch(`${t}/${e}.html`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(e.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static async loadCss(e,t){return fetch(`${t}/${e}.css`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(e.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static async loadBindCss(e,t){return fetch(`${t}/${e}.bind.css`).then((e=>{if(!e.ok)throw console.error("response.ok:",e.ok),console.error("esponse.status:",e.status),console.error("esponse.statusText:",e.statusText),new Error(res.statusText);return e.text()})).catch((e=>{throw console.error(e),e}))}static buildTemplate(e,t,s){const o=document.createElement("template");return o.innerHTML=t,void 0!==s&&(o.innerHTML="<style>\n"+s+"\n</style>\n"+o.innerHTML),o.dataset["x:block"]=e,o}static buildBindRules(e){return class{static collect(e){if(null==e||""===e)return[];const t=document.createElement("div");document.body.appendChild(t);const s=t.attachShadow({mode:"open"}),o=document.createElement("style");o.textContent=e;const i=[];s.appendChild(o);const r=Array.from(s.styleSheets).find((e=>e.ownerNode===o));return Array.from(r?.cssRules??[]).map((e=>i.push(...q.build(e)))),document.body.removeChild(t),i}}.collect(e)}}class U{#i;#p;#ae=[];#ne;constructor(e=null){this.#ne=e}get context(){return this.#p}get name(){return this.#i}#le(e,t,s){return this.#i=e,this.#p=new j(this,t,s),this.#p.build(),this.#p}async load({name:e,parentElement:t,useModule:s,moduleData:o,withBindCss:i,rootBlock:r}){const a=this.#le(e,t,r);try{const t=e=>{const t=r.block.context.moduleDatas[e];return _.build(e,t)},n=s&&r?.block?t(e):null!=o?_.build(e,o,s):await _.load({name:e,useModule:s,withBindCss:i});s&&(r.block??(r.block=this)),n.dialog=this.#ne,a.module=n}catch(e){throw e}}async build({data:e,useModule:t,rootBlock:s,context:o=this.#p}){o.properties=o.props.build(o),o.dependencies.build(),o.dataReflecter.reflect(o,e,o.proxyViewModel),await o.initializer.init(o,e),await o.view.build(o),this.#ae.push(...await H.build(o.rootElement,t,s)),(!o.isBlockModule||null!=o.parentElement)&&o.view.appear(o),await o.postProcess.exec()}static async create({name:e,parentElement:s=null,useModule:o=!1,moduleData:i=null,withBindCss:r=!1,rootBlock:a=t.root,data:n=a.data,dialog:l=null}){const c=new U(l);return await c.load({name:e,parentElement:s,useModule:o,moduleData:i,withBindCss:r,rootBlock:a}),await c.build({data:n,useModule:o,rootBlock:a}),c}notifyAll(e,t,s){const o=this.#p,i=o.notifier,r=o.proxyViewModel,a=o.eventHandler;o.view,s!==this&&i.notify(new Promise((async(o,i)=>{const n=a.exec(r,"notifyAll",e,t,s);n instanceof Promise&&await n,o({name:e,indexes:t})})));for(const o of this.#ae)o.notifyAll(e,t,s)}prepareUpdate(){const e=[];this.context.copyUpdateQueue(),e.push(this.context.updateQueue.length>0);for(const t of this.#ae)e.push(t.prepareUpdate());return!e.every((e=>!1===e))}async updateDom(){const e=[];e.push(this.context.view.updateDom(this.context));for(const t of this.#ae)e.push(t.updateDom());return Promise.all(e)}async postProcess(){const e=[];e.push(this.context.view.postProcess(this.context));for(const t of this.#ae)e.push(t.postProcess());return Promise.all(e)}async inquiryAll(e,t,s,o){const i=this.#p,r=i.proxyViewModel,a=i.eventHandler,n=[];o!==this&&n.push(a.exec(r,"inquiryAll",e,t,s,o));for(const i of this.#ae)n.push(i.inquiryAll(e,t,s,o));await Promise.all(n)}attachTo(e,t=this.#p,s=t.view){s.attachTo(t,e)}}class H{static async build(e,s=!1,o=t.root){return await Promise.all((e=>Array.from(e.querySelectorAll("[data-x\\:block]")))(e).map((e=>(async e=>{const t=e.dataset["x:block"],i="x:withBindCss"in e.dataset;return U.create({name:t,parentElement:e,withBindCss:i,useModule:s,rootBlock:o})})(e))))}}class Q{#ae=[];get blocks(){return this.#ae}get data(){return e.data}async build(){this.#ae.push(...await H.build(document.body))}async updateProcess(e){const t=()=>{const e=[];for(const t of this.#ae)e.push(t.prepareUpdate());return!e.every((e=>!1===e))},s=()=>{const e=[];for(const t of this.#ae)e.push(t.updateDom());return Promise.all(e)},o=()=>{const e=[];for(const t of this.#ae)e.push(t.postProcess());return Promise.all(e)};for(await e();t();)await s(),await o()}notifyAll(e,t,s){for(const o of this.#ae)o.notifyAll(e,t,s)}inquiryAll(e,t,s,o){const i=[];for(const r of this.#ae)i.push(r.inquiryAll(e,t,s,o));return Promise.all(i)}}o.regist("falsey",{forward:(e,t=[])=>!e}),o.regist("not",{forward:(e,t=[])=>!e}),o.regist("null",{forward:(e,t=[])=>null==e}),o.regist("style-display",{forward:(e,t=[])=>e?"":"none"}),o.regist("locale-string",{forward:(e,t=[])=>Number(e).toLocaleString()}),o.regist("fixed",{forward:(e,t=[])=>Number(e).toFixed(t[0]??0)}),o.regist("ge",{forward:(e,t=[])=>Number(e)>=Number(t[0]??0)}),o.regist("gt",{forward:(e,t=[])=>Number(e)>Number(t[0]??0)}),o.regist("le",{forward:(e,t=[])=>Number(e)<=Number(t[0]??0)}),o.regist("lt",{forward:(e,t=[])=>Number(e)<Number(t[0]??0)}),o.regist("number-value",{forward:(e,t=[])=>e?.toString()??"",backward:(e,t=[])=>""!==e?Number(e):null}),o.regist("b64",{forward:(e,t=[])=>atob(e),backward:(e,t=[])=>btoa(e)});class z{static root;static booting=!1;static booted=!1;static async boot({data:o={},options:i={}}={}){this.booting=!0;try{e.setData(o),I.setOptions(this.getBaseName(),i),await class{static async registLocalFilter(e=I.localFilter,t=I.filterPath){if(e){const e=document.baseURI.lastIndexOf("/"),o=e>=0?document.baseURI.slice(0,e+1):"";await s(108)(`${o}${t}/regist.js`)}}}.registLocalFilter(),this.root=new Q,t.setRoot(this.root),await this.root.build()}finally{this.booting=!1,this.booted=!0}}static getBaseName(){const e=location.href.split("/").pop();if(e){const t=e.split(".");return t.pop(),t.join(".")}return e}static async createBlockModule(e,{alias:t=null,data:s={},path:o=null,handler:r=null,parentElement:a=null}){const n={useModule:!0,rootBlock:new i(s,r)};return"object"==typeof e&&null!==e?(n.moduleData=e,n.name=t??"__blockModule"):"."===e[0]||"/"===e[0]?(n.path=e,n.name=t??"__blockModule"):n.name=e,n.parentElement=a,U.create(n)}static getSymbol(e){return c[e]}}document.addEventListener("DOMContentLoaded",(function(){z.booted||z.booting||z.boot()})),window.datax=z})()})();