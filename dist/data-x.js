(()=>{"use strict";class t{static data={};static setData(t){this.data=t}}class e{static root={};static setRoot(t){this.root=t}}class s{static filterByName=new Map;static regist(t,e){this.filterByName.set(t,e)}static forward(t,e){return t.reduce(((t,e)=>"forward"in e.filter?((t,e)=>t.filter.forward(e,t.options))(e,t):t),e)}static backward(t,e){return t.reduce(((t,e)=>"backward"in e.filter?((t,e)=>t.filter.backward(e,t.options))(e,t):t),e)}}class i{#t=new Q;#e;#s;#i;constructor(t,e){this.#e=t,this.#s=e}get data(){return this.#e}get callback(){return this.#s}get blocks(){return this.#t.blocks}get block(){return this.#i}set block(t){this.#i=t}async updateProcess(t){this.#t.updateProcess(t)}notifyAll(t,e,s){this.#t.notifyAll(t,e,s),this.callback&&this.callback(this.data)}async inquiryAll(t,e,s,i){await this.#t.inquiryAll(t,e,s,i)}}class o{#i;#e;#o;#t;#a;#r;#n;#l;constructor(t,e){this.#o=t,this.#e=e}get name(){return this.#o}get data(){return this.#e}get block(){return this.#i}get root(){return this.#t}createBackLayer(t=this.#o){const e=document.createElement("div");e.dataset["x:dialog"]=t;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(t=>this.cancelDialog())),e.appendChild(s);const i=document.createElement("div");return i.style.backgroundColor="white",i.style.borderRadius=".375rem",i.style.padding="2rem",i.classList.add("fg"),i.addEventListener("click",(t=>t.stopPropagation())),s.appendChild(i),{root:e,bg:s,fg:i}}async build(t=this.#o,e=this.#e,s=!1){const{root:o,bg:a,fg:r}=this.createBackLayer(t),n=new i(e),l=await U.create({name:t,parentElement:r,withBindCss:s,rootBlock:n,dialog:this});return n.blocks.push(l),document.body.appendChild(o),this.#i=l,this.#t=o,this}static async create(t=this.#o,e=this.#e,s=!1){return new o(t,e).build(t,e,s)}cancelDialog(){this.#l&&this.#l()}closeDialog(t){this.#n&&this.#n(t)}async main(){return new Promise(((t,e)=>{this.#n=t,this.#l=e})).finally((()=>{this.#t.parentNode.removeChild(this.#t)}))}static async open(t,e={}){return(await o.create(t,e)).main()}}class a{static expand(t,e,s=e.slice()){let i=!1;const o=t.replaceAll("*",(()=>s.shift()??(i=!0,"*")));return i?null:o}}class r{static async exec(t,e,...s){if(e in t){const i=Object.getOwnPropertyDescriptor(t,e);return Reflect.apply(i.set,t,s)}}}class n{static async init(t,e,s=t.proxyViewModel,i=t.properties){await r.exec(s,"init",e);for(const t of i){if(null==t?.init)continue;const i=Reflect.apply(t.init,s,[e]),o=i instanceof Promise?await i:i;t.nameInfo.isPrimitive?s[t.nameInfo.privateName]=o:s[t.name]=o}}}const l={suspend:Symbol("")};class c{static reflect(t,e,s={},i=t.notifier){Object.keys(e).forEach((o=>{const a=`$${o}`,r={configurable:!1,enumerable:!0,get:()=>Reflect.get(e,o),set:s=>{Reflect.set(e,o,s),i.notify(new Promise(((e,s)=>{t.$notifyAll(a),e({name:a})})))}};Object.defineProperty(s,a,r)}))}}class d extends FileReader{constructor(){super()}#c(t,e){return new Promise(((s,i)=>{super.addEventListener("load",(({target:t})=>s(t.result))),super.addEventListener("error",(({target:t})=>i(t.error))),super[e](t)}))}readAsArrayBuffer(t){return this.#c(t,"readAsArrayBuffer")}readAsDataURL(t){return this.#c(t,"readAsDataURL")}readAsText(t){return this.#c(t,"readAsText")}}class u{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static FILE=5;static MULTI=6;static matchClass="class.";static matchFile="file";static matchRadio="radio";static matchCheckbox="checkbox";static matchMulti="multi";static getType(t){return t===this.matchFile?this.FILE:t===this.matchRadio?this.RADIO:t===this.matchCheckbox?this.CHECKBOX:t===this.matchMulti?this.MULTI:t.startsWith(this.matchClass)?this.CLASS:this.VALUE}static async getValue(t,e){return t[e]}static async updateDomByValueType(t){const e=t.domProperty.split("."),s=await this.getValue(t.proxyViewModel,t.path),i=(t,e,s,o=t.shift())=>0===t.length?e[o]!==s&&(e[o]=s):i(t,e[o],s),o=s=>i(e,t.dom,t.filter.forward(t.forwardFilters,s));s instanceof Promise?s.then((t=>o(t))):o(s)}static async updateDomByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=await this.getValue(t.proxyViewModel,t.path),i=s=>t.filter.forward(t.forwardFilters,s)?!t.dom.classList.contains(e)&&t.dom.classList.add(e):t.dom.classList.contains(e)&&t.dom.classList.remove(e);s instanceof Promise?s.then((t=>i(t))):i(s)}static async updateDomByRadioType(t){const e=await this.getValue(t.proxyViewModel,t.path),s=e=>t.dom.checked=t.dom.value===t.filter.forward(t.forwardFilters,e);e instanceof Promise?e.then((t=>s(t))):s(e)}static async updateDomByCheckboxType(t){const e=await this.getValue(t.proxyViewModel,t.path),s=e=>t.dom.checked=(t.filter.forward(t.forwardFilters,e)??[]).includes(t.dom.value);e instanceof Promise?e.then((t=>s(t))):s(e)}static async updateDomByFileType(t){}static async updateDomByMultiType(t){const e=await this.getValue(t.proxyViewModel,t.path),s=e=>{const s=t.filter.forward(t.forwardFilters,e)??[];Array.from(t.dom.options).forEach((t=>t.selected=s.includes(t.value)))};e instanceof Promise?e.then((t=>s(t))):s(e)}static async setValue(t,e,s){t[e]=s}static async updateViewModelByValueType(t){const e=t.domProperty.split("."),s=(t,e,i=t.shift())=>0===t.length?e[i]:s(t,e[i]),i=t.filter.backward(t.backwardFilters,s(e,t.dom));await this.setValue(t.proxyViewModel,t.path,i)}static async updateViewModelByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=t.dom.classList.contains(e);await this.setValue(t.proxyViewModel,t.path,s)}static async updateViewModelByRadioType(t){if(t.dom.checked){const e=t.dom.value;await this.setValue(t.proxyViewModel,t.path,e)}}static async updateViewModelByCheckboxType(t){const e=new Set(t.proxyViewModel[t.path]??[]);t.dom.checked?e.add(t.dom.value):e.delete(t.dom.value);const s=Array.from(e);await this.setValue(t.proxyViewModel,t.path,s)}static async updateViewModelByFileType(t){if(0==t.dom.files.length)return;const e=new d,s=await e.readAsText(t.dom.files[0]),i=t.filter.backward(t.backwardFilters,s);await this.setValue(t.proxyViewModel,t.path,i)}static async updateViewModelByMultiType(t){const e=Array.from(t.dom.selectedOptions).map((t=>t.value));await this.setValue(t.proxyViewModel,t.path,e)}static#d={};static#u={};static init(){this.#d[this.VALUE]=this.updateDomByValueType,this.#d[this.CLASS]=this.updateDomByClassType,this.#d[this.RADIO]=this.updateDomByRadioType,this.#d[this.CHECKBOX]=this.updateDomByCheckboxType,this.#d[this.FILE]=this.updateDomByFileType,this.#d[this.MULTI]=this.updateDomByMultiType,this.#u[this.VALUE]=this.updateViewModelByValueType,this.#u[this.CLASS]=this.updateViewModelByClassType,this.#u[this.RADIO]=this.updateViewModelByRadioType,this.#u[this.CHECKBOX]=this.updateViewModelByCheckboxType,this.#u[this.FILE]=this.updateViewModelByFileType,this.#u[this.MULTI]=this.updateViewModelByMultiType}static async updateDom(t,e=t.domPropertyType){await Reflect.apply(this.#d[e],this,[t])}static async updateViewModel(t,e=t.domPropertyType){await Reflect.apply(this.#u[e],this,[t])}}class p{#p;#h;#m;#f;#y;#g;#b;#w;#x;#P;#v;#k;constructor(t,e,i){this.#h=t,this.#m=e.dom?.property,this.#f=i.proxyViewModel,this.#y=e.viewModel?.property,this.#g=e.inputable,this.#v=class{static parse(t){return 0==t.length?[]:t.split("|").map((t=>t.split(":"))).map((([t,e])=>({name:t,options:e?.split(";")??[],filter:s.filterByName.get(t)})))}}.parse(e?.filters.join("|"))??[],this.#k=this.#v.slice().reverse(),this.#p=i,this.#b=i.indexes?.slice()??[],this.#P=u.getType(this.#m);const{path:o,pattern:a}=i.getPathInfo(this.#y);this.#w=o,this.#x=a}get dom(){return this.#h}get domProperty(){return this.#m}get proxyViewModel(){return this.#f}get path(){return this.#w}get pattern(){return this.#x}get domPropertyType(){return this.#P}get forwardFilters(){return this.#v}get backwardFilters(){return this.#k}get filter(){return this.#p.filter}async init(t=this.#g){t&&this.attachEvent(),await this.updateDom()}async updateDom(){await u.updateDom(this)}async#M(){await u.updateViewModel(this)}attachEvent(t=this.#h,e=this.#p,s=e.view){t.addEventListener("input",(async t=>{await e.$updateProcess((()=>this.#M()))}))}}u.init();class h{nodes=[];loops;binds;key}class m{#h;#y;#E=[];#p;#w;#x;#B;constructor(t,e,s){this.#h=t,this.#y=e.viewModel?.property,this.#p=s;const{path:i,pattern:o}=s.getPathInfo(this.#y);this.#w=i,this.#x=o,this.#B=s.loopStack.slice()}get dom(){return this.#h}get path(){return this.#w}get pattern(){return this.#x}get children(){return this.#E}async#R(t,e=this.#h,s=this.#p){return s.pushLoop({loop:this,key:t},(()=>{const i=s.loopStack.map((t=>t.key));return s.pushIndexes(i,(async()=>{const i=document.createDocumentFragment(),o=new h,a=e.content.cloneNode(!0),{binds:r,loops:n}=await s.view.createBindTree(s,a);return Object.assign(o,{key:t,binds:r,loops:n}),i.appendChild(a),o.nodes.push(...Array.from(i.childNodes)),o}))}))}async expand(t=this.#p.proxyViewModel,e=this.#w,s=this.#E,i=this.#h){const o=await t[e];try{for(const t of Object.keys(o))s.push(await this.#R(t))}catch(t){throw console.log(t,e,o),t}const a=document.createDocumentFragment(),r=t=>a.appendChild(t);s.forEach((t=>t.nodes.forEach(r))),i.after(a)}#A(t,e=this.#p){const s=this.#B.slice(),i=s=>{if(0===s.length)return t();const o=s.pop();return e.pushLoop(o,(()=>i(s)))};return i(s)}#C(t){t.loops.forEach((t=>t.contract())),t.nodes.forEach((t=>t.parentNode.removeChild(t)))}contract(t=this.#E){t.forEach((t=>this.#C(t))),t.splice(0)}async update(){this.contract(),await this.#A((async()=>this.expand()))}}class f{#h;#p;#T;#b;#V;constructor(t,e,s){this.#h=t,this.#T=e.dom?.event,this.#p=s,this.#b=s.indexes?.slice()??[],this.#V=this.#D()}get event(){return this.#T}get dom(){return this.#h}init(){this.#$()}#D(){const t=this.#h;return`${this.#T.toLowerCase()}${e="x:name"in t?.dataset?t?.dataset["x:name"]:t?.name?.length>0?t.name:t.tagName.toLowerCase(),e?.length>0?e.at(0).toUpperCase()+e.slice(1):""}`;var e}async#N(t,e=this.#p.proxyViewModel,s=this.#p.eventHandler,i=this.#V,o=this.#b,a=this.#p){return a.pushIndexes(o,(()=>s.exec(e,i,t)))}#$(t=this.#h,e=this.#T,s=this.#p,i=s.view){t.addEventListener(e,(async t=>{await s.$updateProcess((()=>this.#N(t)))}))}}const y=":not([data-x\\:processed])",g="x:ignore",b=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((t=>`${t}${y}`)).join(","),w=["input","textarea","select","button"].map((t=>`${t}${y}`)).join(",");class x{static async createBindTree(t,e,s=t.bindRules){const{loops:i,binds:o,events:a}=class{static inputable(t){return"INPUT"===t.tagName&&"button"!==t.type||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||!0===t?.isContentEditable}static testFile(t){return"INPUT"===t.tagName&&"file"===t.type}static testRadio(t){return"INPUT"===t.tagName&&"radio"===t.type}static testCheckbox(t){return"INPUT"===t.tagName&&"checkbox"===t.type}static testMulti(t){return"SELECT"===t.tagName&&!0===t.multiple}static parsePropertyName(t){const e=t.split("|");return{property:e.shift(),filters:e}}static parseDataBind(t,e,s=this.inputable(t),i=this.testFile(t),o=this.testRadio(t),a=this.testCheckbox(t),r=this.testMulti(t)){const n=(e,n)=>{if(e.includes("=")){const[l,c]=e.split("="),{property:d,filters:u}=this.parsePropertyName(c);n.dom.property=l,n.viewModel.property=d,n.filters=u;const p=new Set(s?i?["file"]:o?["radio"]:a?["checked","checkbox"]:r?["multi"]:t.isContentEditable?["textContent"]:["value"]:[]);n.inputable=p.has(l)}else{const{property:l,filters:c}=this.parsePropertyName(e);n.dom.property=s?i?"file":o?"radio":a?"checkbox":r?"multi":t.isContentEditable?"textContent":"value":"textContent",n.viewModel.property=l,n.filters=c,n.inputable=s}return n},l=e.split(",");if(1==l.length)return[n(e,{dom:{},viewModel:{},filters:[]})];{const t=l.map((t=>n(t,{dom:{},viewModel:{},filters:[]})));return t}}static collectByAttribute(t,e,s=[],i=[],o=[]){return Array.from(e.querySelectorAll(b)).forEach((e=>{if(g in e.dataset)return;const a=e.dataset["x:processing"]?.split(",")??[];if("x:loop"in e.dataset){if("TEMPLATE"!==e.tagName)return;if(a.includes("loop"))return;const s={dom:{},viewModel:{property:e.dataset["x:loop"]},filters:[]};i.push(new m(e,s,t)),a.push("loop")}else{if("x:bind"in e.dataset){if(a.includes("bind"))return;s.push(...this.parseDataBind(e,e.dataset["x:bind"]).map((s=>new p(e,s,t)))),a.push("bind")}if("x:events"in e.dataset){if(a.includes("events"))return;e.dataset["x:events"].split(",").forEach((s=>{const i={dom:{event:s},viewModel:{},filters:[]};o.push(new f(e,i,t))})),a.push("events")}}e.dataset["x:processing"]=a.join(",")})),{binds:s,loops:i,events:o}}static collectByImplicit(t,e,s=[],i=[],o=[]){return Array.from(e.querySelectorAll(w)).forEach((e=>{if(g in e.dataset)return;const i=e.dataset["x:processing"]?.split(",")??[],a=this.testFile(e),r=this.testRadio(e),n=this.testCheckbox(e),l=this.testMulti(e),c={dom:{},viewModel:{},filters:[]};if("BUTTON"===e.tagName||"INPUT"===e.tagName&&"button"===e.type){if(i.includes("events"))return;c.dom.event="click",o.push(new f(e,c,t)),i.push("events")}else{if(i.includes("bind"))return;const{property:o,filters:d}=this.parsePropertyName(e.name);c.dom.property=a?"file":r?"radio":n?"checkbox":l?"multi":"value",c.viewModel.property=o,c.filters=d,c.inputable=!0,s.push(new p(e,c,t)),i.push("bind")}e.dataset["x:processing"]=i.join(",")})),{binds:s,loops:i,events:o}}static collectByRule(t,e,s,i=[],o=[],a=[]){const r=new Map;return s.forEach((t=>{!r.has(t.dom.selector)&&r.set(t.dom.selector,[]),r.get(t.dom.selector).push(t)})),Array.from(r.keys()).forEach((s=>{e.querySelectorAll(`${s}${y}`).forEach((e=>{if(g in e.dataset)return;const n=this.inputable(e),l=e.dataset["x:processing"]?.split(",")??[],c=l.slice();r.get(s).forEach((s=>{const r=JSON.parse(JSON.stringify(s));if("TEMPLATE"===e.tagName){if(l.includes("loop"))return;((e,s)=>{o.push(new m(s,e,t))})(r,e),c.push("loop")}else if("event"in r.dom){if(l.includes("events"))return;((e,s)=>{a.push(new f(s,e,t))})(r,e),c.push("events")}else{if(l.includes("bind"))return;r.inputable=n,((e,s)=>{i.push(new p(s,e,t))})(r,e),c.push("bind")}})),e.dataset["x:processing"]=c.join(",")}))})),{loops:o,binds:i,events:a}}static collect(t,e,s=[]){const i=[],o=[],a=[];return this.collectByRule(t,e,s,i,o,a),this.collectByAttribute(t,e,i,o,a),this.collectByImplicit(t,e,i,o,a),i.forEach((t=>t.dom.dataset["x:processed"]="")),o.forEach((t=>t.dom.dataset["x:processed"]="")),a.forEach((t=>t.dom.dataset["x:processed"]="")),Array.from(e.querySelectorAll("[data-x\\:processing]")).forEach((t=>{t.removeAttribute("data-x:processing")})),{loops:o,binds:i,events:a}}}.collect(t,e,s);return await Promise.all(i.map((t=>t.expand()))),await Promise.all(o.map((t=>t.init()))),a.forEach((t=>t.init())),{loops:i,binds:o,events:a}}static async build(t,e=t.rootElement){const s=await this.createBindTree(t,e);t.setBindTree(s),t.buildBinds()}static appear(t,e=t.fragment,s=t.parentElement){const i=s.attachShadow({mode:"open"});i.appendChild(e),t.rootElement=i}static attachTo(t,e){t.parentElement=e,this.appear(t)}static async updateDom(t,e=t.updateQueue,s=t.allBinds,i=t.allLoops,o=t.properties,r=t.dependencies,n=t.proxyViewModel,l=t.cache){const c=await Promise.all(e),d=[];for(const{name:t,indexes:e=[]}of c.filter((t=>null!=t))){d.push(a.expand(t,e));for(const s of r.getReferedProperties(t,e))d.push(s.name)}const u=new Set(d);await Promise.all(Array.from(u).map((t=>{l.delete(t),Reflect.get(n,t)})));for(const t of i.filter((t=>u.has(t.path))))await t.update();for(const t of s.filter((t=>u.has(t.path))))await t.updateDom();t.buildBinds()}static async postProcess(t,e=t.postProcess){e.exec()}static async updateProcess(t,e,s=t.notifier,i=t.properties,o=t.postProcess){o.clear(),s.clear(),i.clearStatus(),await e(),await this.updateDom(t),i.isUpdate&&t.buildBinds(),await o.exec()}}class P{parentNodes=[];name;func;childNodes=[];constructor(t){this.name=t}}class v{#O=new Map;#S;#p;constructor(t){this.#p=t}get map(){return this.#O}build(t=this.#O,e=this.#p.dependencyRules){t.clear(),this.#S=this.#p.dependencyRules.slice(),e.forEach((([t,e,s])=>this.add(t,e,s))),this.implicitDependency()}implicitDependency(t=this.#p.props,e=this.#p.properties){for(const s of e)t.getDependencyNames(e,s.name).forEach((t=>this.add(t,[s.name])))}add(t,e,s,i=this.#O){i.has(t)||i.set(t,new P(t));const o=i.get(t);o.func=s,e.forEach((t=>{i.has(t)||i.set(t,new P(t));const e=i.get(t);o.childNodes.push(e),e.parentNodes.push(o)}))}getReferedProperties(t,e,s=this.#O,i=this.#p.proxyViewModel){const o=s.get(t),r=new Set,n=e??[],l=(t,e)=>{if(null==t)return e;const s=a.expand(t.name,n);if(null!==s){if(r.has(s))return e;r.add(s);const o=t.func?Reflect.apply(t.func,i,[n]):n;if(!1===o)return e;const a={name:s,pattern:t.name,indexes:o};e.push(a)}return t.parentNodes.forEach((t=>{e=l(t,e)})),e};return l(o,[])}}class k{#j=[];#p;constructor(t){this.#p=t}get queue(){return this.#j}notify(t,e=this.#j){e.push(t)}dequeue(t=this.#j){const e=t.slice();return t.splice(0),e}clear(t=this.#j){t.splice(0)}}class M{#L=new Map;#p;constructor(t){this.#p=t}has(t){return this.#L.has(t)}get(t){return this.#L.get(t)}set(t,e){const s=e=>{"object"==typeof e&&null!==e&&"__notifiable"in e&&(e.__name=t),this.#L.set(t,e)};return s(e),e instanceof Promise&&e.then((t=>s(t))),e}delete(t){this.#L.delete(t);const e=`${t}.`;Array.from(this.#L.keys()).filter((t=>t.startsWith(e))).forEach((t=>this.#L.delete(t)))}}class E{#p;#j=[];constructor(t){this.#p=t}get queue(){return this.#j}regist(t,e=this.#j){e.push(t)}exec(t=this.#p,e=this.#j,s=t.view){const i=e.slice();e.splice(0);const o=[];if(i.length>0)for(const t of i)o.push(t());return Promise.all(o)}clear(t=this.#j){t.splice(0)}}class B{#o;#p;constructor(t){this.#p=t}has(t,e){return"__notifiable"===e||Reflect.has(t,e)}get(t,e,s){return"__notifiable"===e||("__name"===e?this.#o:Reflect.get(t,e,s))}set(t,e,s,i){if("__name"===e)return this.#o=s,!0;if("length"===e){const t=this.#o;null!=t&&this.#p.notifier.notify({name:t})}return Reflect.set(t,e,s,i)}static notifiable(t,e){return new Proxy(e,new B(t))}}class R{name;parent;last;loops;privateName;isPath;isPattern;isPrimitive;static get(t){const e=new R;e.name=t;const s=t.includes("."),i=t.includes("*");if(e.isPath=s&&!i,e.isPattern=s&&i,e.isPrimitive=!e.isPath&&!e.isPattern,e.isPath||e.isPattern){const s=t.split(".");e.last=s.pop(),e.parent=s.join(".")}return e.isPattern&&(e.loops=t.split("").filter((t=>"*"===t)).length),e.isPrimitive&&(e.privateName=`__${t}`),e}}class A{static createDefault(t,e){return e.isPrimitive?class{static create(t,{privateName:e}){return{get:function(){return this[e]},set:function(t){this[e]=t}}}}.create(t,e):e.isPath?class{static create(t,{parent:e,last:s}){return{get:function(){return this[e]?.[s]},set:function(t){this[e][s]=t}}}}.create(t,e):e.isPattern?class{static create(t,{parent:e,last:s,loops:i}){const o=t=>"*"===s?t.indexes.at(i-1):s;return{get:function(){return this[e]?.[o(t)]},set:function(s){this[e][o(t)]=s}}}}.create(t,e):null}static wrapGetter(t,e){return function(){const s=t.indexes??[],i=t.proxyViewModel;return Reflect.apply(e,i,[...s])}}static wrapSetter(t,e){return function(s){const i=t.indexes??[],o=t.proxyViewModel;return Reflect.apply(e,o,[s,...i])}}}const C=new RegExp(/^(\@\@?)([a-zA-Z0-9_\.\*]+)(#(get|set|init)?)?$/),T=new RegExp(/^(#)([a-zA-Z0-9_]+)$/),V=new RegExp(/^__([a-zA-Z0-9_])+$/),D=(t,e)=>{do{e(t),t=Object.getPrototypeOf(t)}while(t!==Object.prototype)};class ${name;nameInfo;init}class N{static build(t,e=t.viewModel){const s=[],i=t=>({configurable:!0,enumerable:!1,writable:!0,value:t?.value}),o=new Map;D(e,(t=>{Object.entries(Object.getOwnPropertyDescriptors(t)).forEach((([s,a])=>{const r=(t=>C.exec(t))(s),n=(t=>T.exec(t))(s),l=(t=>V.exec(t))(s);null===r&&null===l&&null===n||(null!==l?Reflect.defineProperty(e,s,i(a)):null!==r?((([,t,e,s,i],a)=>{const r=o.has(e)?o.get(e):{baseName:null,get:null,set:null,init:null,requireSet:void 0,initValue:void 0};r.baseName=r.baseName??e;const n=(t,s)=>"function"==typeof t?t:console.error(`${e}.${s} is not function`);null!=s&&null==i?("object"!=typeof a.value&&console.error(`${e}.# is not object`),r.get=r.get??a.value?.get?n(a.value.get,"#get"):r.get,r.set=r.set??a.value?.set?n(a.value.set,"#set"):r.set,r.init=r.init??a.value?.init?n(a.value.init,"#init"):r.init):null!=s&&null!=i&&(r.get=r.get??"get"===i?n(a.value,"#get"):r.get,r.set=r.set??"set"===i?n(a.value,"#set"):r.set,r.init=r.init??"init"===i?n(a.value,"#init"):r.init),r.requireSet=void 0===r.requireSet?"@@"==t:r.requireSet,void 0!==r.requireSet&&r.requireSet!=("@@"==t)&&console.error("@@ is not match"),r.initValue=null==s?a?.value:r.initValue,o.set(e,r)})(r,a),Reflect.deleteProperty(t,s)):null!==n&&((([,,t],e)=>{const s=o.has(t)?o.get(t):{baseName:null,get:null,set:null,init:null,requireSet:void 0,initValue:void 0};var i;s.baseName=s.baseName??t,s.set=s.set??("function"==typeof(i=e.value)?i:console.error(`#${t} is not function`)),s.requireSet=!0,o.set(t,s)})(n,a),Reflect.deleteProperty(t,s)))}))}));const a=(t,e)=>t!==Object.prototype?Object.getOwnPropertyDescriptor(t,e)??a(Object.getPrototypeOf(t)):{};Array.from(o.entries()).forEach((([o,r])=>{const n=R.get(o);!(n.privateName in e)&&n.isPrimitive&&Reflect.defineProperty(e,n.privateName,i({value:r.initValue}));const l=a(e,o),c=A.createDefault(t,n),d={configurable:!0,enumerable:!0};d.get=(r.get?A.wrapGetter(t,r.get):null)??l.get??c.get,r.requireSet&&(d.set=(r.set?A.wrapSetter(t,r.set):null)??l.set??c.set),Object.defineProperty(e,o,d),s.push(Object.assign(new $,{name:o,nameInfo:n,init:r?.init}))})),D(e,(i=>{e!==i&&Object.entries(Object.getOwnPropertyDescriptors(i)).forEach((([i,o])=>{if(e.hasOwnProperty(i))return;if(null==o?.get&&null==o?.set)return;const a=R.get(i);if(null==o?.get&&null!=o?.set){const e=A.createDefault(t,a);o.get=e.get}o.enumerable=!0,Object.defineProperty(e,i,o),s.push(Object.assign(new $,{name:i,nameInfo:a}))}))}));const r=[];return Array.from(Object.keys(e)).forEach((t=>{const e=t.split(".").reduce(((t,e)=>(t.push(t.at(-1)?.slice()??[]),t.at(-1).push(e),t)),[]);r.push(...e.map((t=>t.join("."))))})),Array.from(new Set(r)).filter((t=>!e.hasOwnProperty(t))).forEach((o=>{const a={configurable:!0,enumerable:!0},r=R.get(o),n=A.createDefault(t,r);a.get=n.get,Object.defineProperty(e,o,a),s.push(Object.assign(new $,{name:o,nameInfo:r})),!(r.privateName in e)&&r.isPrimitive&&Reflect.defineProperty(e,r.privateName,i({}))})),Object.defineProperty(e,"$$context",{configurable:!0,enumerable:!1,writable:!1,value:t}),s}static getDependencyNames(t,e){const s=`${e}.`;return t.map((t=>t.name)).filter((t=>t.startsWith(s)&&!t.slice(s.length).includes(".")))}}class O{#p;#F=new Map;#q=new Map;constructor(t){this.#p=t}patternToRegExp(t){return new RegExp("^"+t.replaceAll(".","\\.").replaceAll("*","([a-zA-Z0-9_]+)")+"$")}getExpandName(t,e,s=this.#F,i=this.#q){if(s.has(e))return s.get(e);for(const o of Object.keys(t)){if(!o.includes("*"))continue;i.has(o)||i.set(o,this.patternToRegExp(o));const t=i.get(o).exec(e)?.slice(1);if(null!=t){const i={name:e,pattern:o,indexes:t};return s.set(e,i),i}}}get(t,e,s,i=this.#p,o=i.cache){if(o.has(e))return o.get(e);if(e in t){const i=Object.getOwnPropertyDescriptor(t,e),a=i?.get?Reflect.apply(i.get,s,[]):t[e];return e.includes("*")?a:o.set(e,a)}{const a=this.getExpandName(t,e);if(null!=a)return i.pushIndexes(a.indexes,(()=>{const i=Object.getOwnPropertyDescriptor(t,a.pattern);return o.set(e,i?.get?Reflect.apply(i.get,s,[]):t[a.pattern])}))}console.error(`undefied property "${e}"`)}set(t,e,s,i,o=this.#p,a=o.cache,r=o.notifier){a.has(e)&&a.delete(e);const n=(t,e)=>{r.notify(new Promise((async(s,i)=>{s(await t!==l.suspend?e:null)})))};if(e in t){const o=Object.getOwnPropertyDescriptor(t,e),a=o?.set?Reflect.apply(o.set,i,[s]):t[e]=s;return o?.set&&n(a,{name:e}),!0}{const a=this.getExpandName(t,e);if(null!=a)return o.pushIndexes(a.indexes,(()=>{const o=Object.getOwnPropertyDescriptor(t,a.pattern),r=o?.set?Reflect.apply(o.set,i,[s]):t[e]=s;n(r,{name:a.pattern,indexes:a.indexes})})),!0}console.error(`undefied property "${e}"`)}}class S{#I;#_;#U;#H;#Q;#z;#W;#X={binds:[],loops:[]};#K=[];#Z=[];#B=[];#G=[];#J;#Y;#L;#tt;#i;#et;#st=[];#f;constructor(t,e,s){this.#i=t,this.#I=e,this.#tt=s}build(){this.#H=x,this.#z=new E(this),this.#W=new v(this),this.#Y=new k(this),this.#L=new M(this)}get parentElement(){return this.#I}get fragment(){return this.#_}get rootElement(){return this.#U??this.#_}get view(){return this.#H}get viewModel(){return this.#Q}get postProcess(){return this.#z}get dependencies(){return this.#W}get bindTree(){return this.#X}get allBinds(){return this.#K}get allLoops(){return this.#Z}get indexesStack(){return this.#G}get indexes(){return this.#G[this.#G.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#B}get currentLoop(){return this.#B[this.#B.length-1]}get properties(){return this.#J}get notifier(){return this.#Y}get cache(){return this.#L}get context(){return this}get rootBlock(){return this.#tt}get block(){return this.#i}get data(){return this.#tt.data}get template(){return this.#et.template}get module(){return this.#et}get moduleDatas(){return this.#et.moduleDatas}get bindRules(){return this.#et.bindRules}get dependencyRules(){return this.#et.dependencyRules}get isBlockModule(){return this.#et.useModule}get symbols(){return l}get updateQueue(){return this.#st}get notifiable(){return B}get props(){return N}get filter(){return s}get eventHandler(){return r}get initializer(){return n}get dataReflecter(){return c}get proxyHandler(){return O}get proxyViewModel(){return this.#f}set module(t){this.#et=t,this.#Q=void 0!==t.viewModel?t.viewModel:void 0!==t.AppViewModel?Reflect.construct(t.AppViewModel,[]):{},this.#_=t.template.content.cloneNode(!0);const e=t?.context??t?._;null!=e&&this.reflect(e,t.dialog),this.#f=new Proxy(this.#Q,Reflect.construct(this.proxyHandler,[this]))}set rootElement(t){this.#U=t}set parentElement(t){this.#I=t}set properties(t){this.#J=t}copyUpdateQueue(){this.#st=this.#Y.dequeue()}pushIndexes(t,e){this.#G.push(t);const s=e();return s instanceof Promise?s.finally((()=>this.#G.pop())):this.#G.pop(),s}pushLoop({loop:t,key:e},s){this.#B.push({loop:t,key:e});const i=s();return i instanceof Promise?i.finally((()=>this.#B.pop())):this.#B.pop(),i}getPathInfo(t,e=t,s=this.currentLoop?.loop,i=this.currentLoop?.key,o=this.indexes??[]){return"."===t[0]?"."===t?{path:`${s.path}.${i}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${i}.${t}`,pattern:`${s.pattern}.*.${t}`}:{path:a.expand(e,o),pattern:e}}setBindTree({binds:t,loops:e},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...t),s.loops.push(...e)}buildBinds(t=this.bindTree,e=this.allBinds,s=this.allLoops){e.splice(0),s.splice(0);const i=t=>e.push(t),o=t=>s.push(t);t.binds.forEach(i),t.loops.forEach(o);const a=t=>{t.children.forEach((t=>{t.binds.forEach(i),t.loops.forEach(o),t.loops.forEach(a)}))};t.loops.forEach(a)}reflect(t,e){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([e,s])=>{if(null!=s?.get){const i={configurable:!0,enumerable:!0,get:(...t)=>Reflect.apply(s.get,this,t)};Object.defineProperty(t,e,i)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postProcess","postProcess"],["$updateProcess","updateProcess"],["$notifiable","notifiable"]].forEach((([e,s])=>{const i={configurable:!0,enumerable:!1,value:"AsyncFunction"===e.constructor.name?async(...t)=>Reflect.apply(this[e],this,t):(...t)=>Reflect.apply(this[e],this,t)};Object.defineProperty(t,s,i)})),null!=e){this.$closeDialog=function(t){e.closeDialog(t)};const s={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$closeDialog,this,t)};Object.defineProperty(t,"closeDialog",s),this.$cancelDialog=function(){e.cancelDialog()};const i={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$cancelDialog,this,t)};Object.defineProperty(t,"cancelDialog",i)}}$notify(t,e=[]){this.notifier.notify({name:t,indexes:e})}$postProcess(t){this.postProcess.regist(t)}$notifyAll(t,e=[]){this.rootBlock.notifyAll(t,e,this.block)}$notifiable(t){return this.notifiable.notifiable(this,t)}async $updateProcess(t){this.rootBlock.updateProcess(t)}$inquiryAll(t,e,s){return this.$postProcess((()=>this.rootBlock.inquiryAll(t,e,s,this.block)))}async $openDialog(t,e={}){return o.open(t,e)}}const j="--bind-",L="--bind-class-";class F{dom={selector:""};viewModel={};filters=[];static#it(t,e,s,i){const o=new F;return o.dom.selector=t,o.dom.property=e,o.viewModel.property=s,o.filters.push(...i),o}static#ot(t,e){const s=new F;return s.dom.selector=t,s.dom.event=e,s}static#at(t,e){const s=new F;return s.dom.selector=t,s.viewModel.property=e,s}static build(t){const e=[];for(let s=0;s<t.style.length;s++){const i=t.style[s],o=t.style.getPropertyValue(i).trim();if("--events"===i)for(const s of o.split(",")){const i=F.#ot(t.selectorText,s);e.push(i)}else if("--loop"===i){const s=F.#at(t.selectorText,o);e.push(s)}else if(i.startsWith(L)){const s=o.split("|"),a=s.shift(),r=s,n=F.#it(t.selectorText,"class."+i.slice(L.length),a,r);e.push(n)}else if(i.startsWith(j)){const s=o.split("|"),a=s.shift(),r=s,n=F.#it(t.selectorText,i.slice(j.length).replaceAll("-","."),a,r);e.push(n)}}return e}}class q{static spaPath;static spaCssPath;static spaHtmlPath;static spaModulePath;static filterPath=null;static localFilter=!1;static modulePath=".";static blockPrifix="block";static setOptions(t,e){this.spaPath=e.spaPath??(t?`${t}-spa`:"spa"),this.spaCssPath=e.spaCssPath??`${this.spaPath}/css`,this.spaHtmlPath=e.spaHtmlPath??`${this.spaPath}/html`,this.spaModulePath=e.spaModulePath??`${this.spaPath}/module`,this.modulePath=e.modulePath??this.modulePath,this.localFilter=e.localFilter??this.localFilter,this.filterPath=this.localFilter?e.filterPath??`${this.spaPath}/module/filter`:this.filterPath,this.blockPrifix=e.blockPrifix??this.blockPrifix}}class I{name;viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;useModule;moduleDatas;static async load({name:t,useModule:e,withBindCss:s,module:i=new I}){const o=e?null:q.spaCssPath,a=e?null:q.spaHtmlPath,r=e?null:q.spaModulePath,n=e?q.modulePath:null;i.name=t,i.useModule=e;const l=await this.loadScript(t,n??r);if(Object.assign(i,l?.default??{}),void 0===i.html&&null!==a){const e=await this.loadHtml(t,a);Object.assign(i,{html:e})}if(void 0===i.css&&null!==o){const e=await this.loadCss(t,o);Object.assign(i,{css:e})}if(s&&void 0===i.bindCss&&null!==o&&void 0===i.bindRules){const e=await this.loadBindCss(t,o);Object.assign(i,{bindCss:e})}return this.build(t,i,e)}static build(t,e,s=!1){e.useModule=s;const i=this.buildTemplate(t,e.html,e.css);if(Object.assign(e,{template:i}),void 0===e.bindRules&&void 0!==e.bindCss){const t=this.buildBindRules(e.bindCss);Object.assign(e,{bindRules:t})}return void 0===e.dependencyRules&&(e.dependencyRules=[]),void 0===e.bindRules&&(e.bindRules=[]),e}static async loadScript(t,e){const s=e.startsWith("https://")||e.startsWith("http://")||"/"===e[0],i=document.baseURI.lastIndexOf("/"),o=i>=0?document.baseURI.slice(0,i+1):"";return import(s?`${e}/${t}.js`:`${o}${e}/${t}.js`).catch((t=>{throw console.error(t),t}))}static async loadHtml(t,e){return fetch(`${e}/${t}.html`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadCss(t,e){return fetch(`${e}/${t}.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadBindCss(t,e){return fetch(`${e}/${t}.bind.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(res.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static buildTemplate(t,e,s){const i=document.createElement("template");return i.innerHTML=e,void 0!==s&&(i.innerHTML="<style>\n"+s+"\n</style>\n"+i.innerHTML),i.dataset["x:block"]=t,i}static buildBindRules(t){return class{static collect(t){if(null==t||""===t)return[];const e=document.createElement("div");document.body.appendChild(e);const s=e.attachShadow({mode:"open"}),i=document.createElement("style");i.textContent=t;const o=[];s.appendChild(i);const a=Array.from(s.styleSheets).find((t=>t.ownerNode===i));return Array.from(a?.cssRules??[]).map((t=>o.push(...F.build(t)))),document.body.removeChild(e),o}}.collect(t)}}class _{static modules={};static setModules(t){Object.assign(this.modules,t)}static setModule(t,e){this.modules[t]=e}static get(t){return this.modules[t]}}class U{#o;#p;#rt=[];#nt;constructor(t=null){this.#nt=t}get context(){return this.#p}get name(){return this.#o}#lt(t,e,s){return this.#o=t,this.#p=new S(this,e,s),this.#p.build(),this.#p}async load({name:t,parentElement:e,useModule:s,moduleData:i,withBindCss:o,rootBlock:a}){const r=this.#lt(t,e,a);try{const e=t=>{const e=a.block.context.moduleDatas[t];return I.build(t,e)},n=s&&a?.block?e(t):null!=i?I.build(t,i,s):await I.load({name:t,useModule:s,withBindCss:o});s&&(a.block??(a.block=this)),n.dialog=this.#nt,r.module=n}catch(t){throw t}}async build({data:t,useModule:e,rootBlock:s,context:i=this.#p}){i.properties=i.props.build(i),i.dependencies.build(),i.dataReflecter.reflect(i,t,i.proxyViewModel),await i.initializer.init(i,t),await i.view.build(i),this.#rt.push(...await H.build(i.rootElement,e,s)),(!i.isBlockModule||null!=i.parentElement)&&i.view.appear(i),await i.postProcess.exec()}static async create({name:t,parentElement:s=null,useModule:i=!1,moduleData:o=_.get(t),withBindCss:a=!1,rootBlock:r=e.root,data:n=r.data,dialog:l=null}){const c=new U(l);return await c.load({name:t,parentElement:s,useModule:i,moduleData:o,withBindCss:a,rootBlock:r}),await c.build({data:n,useModule:i,rootBlock:r}),c}notifyAll(t,e,s){const i=this.#p,o=i.notifier,a=i.proxyViewModel,r=i.eventHandler;i.view,s!==this&&o.notify(new Promise((async(i,o)=>{const n=r.exec(a,"notifyAll",[t,e,s]);n instanceof Promise&&await n,i({name:t,indexes:e})})));for(const i of this.#rt)i.notifyAll(t,e,s)}prepareUpdate(){const t=[];this.context.copyUpdateQueue(),t.push(this.context.updateQueue.length>0);for(const e of this.#rt)t.push(e.prepareUpdate());return!t.every((t=>!1===t))}async updateDom(){const t=[];t.push(this.context.view.updateDom(this.context));for(const e of this.#rt)t.push(e.updateDom());return Promise.all(t)}async postProcess(){const t=[];t.push(this.context.view.postProcess(this.context));for(const e of this.#rt)t.push(e.postProcess());return Promise.all(t)}hasRemainProcess(t){t.push(this.context.notifier.queue.length>0||this.context.postProcess.queue.length>0);for(const e of this.#rt)e.hasRemainProcess(t)}async inquiryAll(t,e,s,i){const o=this.#p,a=o.proxyViewModel,r=o.eventHandler,n=[];i!==this&&n.push(r.exec(a,"inquiryAll",[t,e,s,i]));for(const o of this.#rt)n.push(o.inquiryAll(t,e,s,i));await Promise.all(n)}attachTo(t,e=this.#p,s=e.view){s.attachTo(e,t)}}class H{static async build(t,s=!1,i=e.root){return await Promise.all((t=>Array.from(t.querySelectorAll("[data-x\\:block]")))(t).map((t=>(async t=>{const e=t.dataset["x:block"],o="x:withBindCss"in t.dataset;return U.create({name:e,parentElement:t,withBindCss:o,useModule:s,rootBlock:i})})(t))))}}class Q{#rt=[];get blocks(){return this.#rt}get data(){return t.data}async build(){this.#rt.push(...await H.build(document.body))}async updateProcess(t){const e=()=>{const t=[];for(const e of this.#rt)t.push(e.prepareUpdate());return!t.every((t=>!1===t))},s=()=>{const t=[];for(const e of this.#rt)t.push(e.updateDom());return Promise.all(t)},i=()=>{const t=[];for(const e of this.#rt)t.push(e.postProcess());return Promise.all(t)},o=()=>{const t=[];for(const e of this.#rt)e.hasRemainProcess(t);return!t.every((t=>!1===t))};for(await t();o();)e(),await s(),await i()}notifyAll(t,e,s){for(const i of this.#rt)i.notifyAll(t,e,s)}inquiryAll(t,e,s,i){const o=[];for(const a of this.#rt)o.push(a.inquiryAll(t,e,s,i));return Promise.all(o)}}s.regist("falsey",{forward:(t,e=[])=>!t}),s.regist("not",{forward:(t,e=[])=>!t}),s.regist("null",{forward:(t,e=[])=>null==t}),s.regist("style-display",{forward:(t,e=[])=>t?"":"none"}),s.regist("locale-string",{forward:(t,e=[])=>Number(t).toLocaleString()}),s.regist("fixed",{forward:(t,e=[])=>Number(t).toFixed(e[0]??0)}),s.regist("ge",{forward:(t,e=[])=>Number(t)>=Number(e[0]??0)}),s.regist("gt",{forward:(t,e=[])=>Number(t)>Number(e[0]??0)}),s.regist("le",{forward:(t,e=[])=>Number(t)<=Number(e[0]??0)}),s.regist("lt",{forward:(t,e=[])=>Number(t)<Number(e[0]??0)}),s.regist("number-value",{forward:(t,e=[])=>t?.toString()??"",backward:(t,e=[])=>""!==t?Number(t):null}),s.regist("b64",{forward:(t,e=[])=>atob(t),backward:(t,e=[])=>btoa(t)});class z{static root;static booting=!1;static booted=!1;static _data={};static _options={};static _modules={};static async boot({data:i=this._data,options:o=this._options,modules:a=this._modules}={}){this.booting=!0;try{t.setData(i),q.setOptions(this.getBaseName(),o),_.setModules(a),await class{static async registLocalFilter(t=q.localFilter,e=q.filterPath){if(t){const t=document.baseURI.lastIndexOf("/"),i=t>=0?document.baseURI.slice(0,t+1):"";(await import(`${i}${e}/filters.js`)).default.forEach((t=>{s.regist(t.name,t.filter)}))}}}.registLocalFilter(),this.root=new Q,e.setRoot(this.root),await this.root.build()}finally{this.booting=!1,this.booted=!0}}static getBaseName(){const t=location.href.split("/").pop();if(t){const e=t.split(".");return e.pop(),e.join(".")}return t}static async createBlockModule(t,{alias:e=null,data:s={},path:o=null,handler:a=null,parentElement:r=null}){const n={useModule:!0,rootBlock:new i(s,a)};return"object"==typeof t&&null!==t?(n.moduleData=t,n.name=e??"__blockModule"):"."===t[0]||"/"===t[0]?(n.path=t,n.name=e??"__blockModule"):n.name=t,n.parentElement=r,U.create(n)}static getSymbol(t){return l[t]}static data(t){return Object.assign(this._data,t),this}static options(t){return Object.assign(this._options,t),this}static modules(t){return Object.assign(this._modules,t),this}}document.addEventListener("DOMContentLoaded",(function(){z.booted||z.booting||z.boot()})),window.datax=z})();