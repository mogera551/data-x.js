(()=>{var t={108:t=>{function e(t){return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}e.keys=()=>[],e.resolve=e,e.id=108,t.exports=e}},e={};function s(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,s),r.exports}s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t{static data={};static setData(t){this.data=t}}class e{static root={};static setRoot(t){this.root=t}}class o{static filterByName=new Map;static regist(t,e){this.filterByName.set(t,e)}static forward(t,e){return t.reduce(((t,e)=>"forward"in e.filter?((t,e)=>t.filter.forward(e,t.options))(e,t):t),e)}static backward(t,e){return t.reduce(((t,e)=>"backward"in e.filter?((t,e)=>t.filter.backward(e,t.options))(e,t):t),e)}}class i{#t=new Q;#e;#s;#o;constructor(t,e){this.#e=t,this.#s=e}get data(){return this.#e}get callback(){return this.#s}get blocks(){return this.#t.blocks}get block(){return this.#o}set block(t){this.#o=t}async updateProcess(t){this.#t.updateProcess(t)}notifyAll(t,e,s){this.#t.notifyAll(t,e,s),this.callback&&this.callback(this.data)}async inquiryAll(t,e,s,o){await this.#t.inquiryAll(t,e,s,o)}}class r{#o;#e;#i;#t;#r;#a;#n;#l;constructor(t,e){this.#i=t,this.#e=e}get name(){return this.#i}get data(){return this.#e}get block(){return this.#o}get root(){return this.#t}createBackLayer(t=this.#i){const e=document.createElement("div");e.dataset["x:dialog"]=t;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(t=>this.cancelDialog())),e.appendChild(s);const o=document.createElement("div");return o.style.backgroundColor="white",o.style.borderRadius=".375rem",o.style.padding="2rem",o.classList.add("fg"),o.addEventListener("click",(t=>t.stopPropagation())),s.appendChild(o),{root:e,bg:s,fg:o}}async build(t=this.#i,e=this.#e,s=!1){const{root:o,bg:r,fg:a}=this.createBackLayer(t),n=new i(e),l=await U.create({name:t,parentElement:a,withBindCss:s,rootBlock:n,dialog:this});return n.blocks.push(l),document.body.appendChild(o),this.#o=l,this.#t=o,this}static async create(t=this.#i,e=this.#e,s=!1){return new r(t,e).build(t,e,s)}cancelDialog(){this.#l&&this.#l()}closeDialog(t){this.#n&&this.#n(t)}async main(){return new Promise(((t,e)=>{this.#n=t,this.#l=e})).finally((()=>{this.#t.parentNode.removeChild(this.#t)}))}static async open(t,e={}){return(await r.create(t,e)).main()}}class a{static expand(t,e,s=e.slice()){let o=!1;const i=t.replaceAll("*",(()=>s.shift()??(o=!0,"*")));return o?null:i}}class n{static async exec(t,e,...s){const o=e[0].toUpperCase()+e.slice(1),i=`event${o}`,r=`on${o}`;if(i in t){const e=Object.getOwnPropertyDescriptor(t,i);return Reflect.apply(e.set,t,[s])}if(r in t)return t[r](...s)}}class l{static async init(t,e,s=t.proxyViewModel,o=t.properties){await n.exec(s,"init",e);for(const t of o){if(null==t?.init)continue;const o=t.init(e),i=o instanceof Promise?await o:o;t.nameInfo.isPrimitive?s[t.nameInfo.privateName]=i:s[t.name]=i}}}const c={suspend:Symbol("")};class d{static reflect(t,e,s={},o=t.notifier){Object.keys(e).forEach((i=>{const r=`$${i}`,a={configurable:!1,enumerable:!0,get:()=>Reflect.get(e,i),set:s=>{Reflect.set(e,i,s),o.notify(new Promise(((e,s)=>{t.$notifyAll(r),e({name:r})})))}};Object.defineProperty(s,r,a)}))}}class p extends FileReader{constructor(){super()}#c(t,e){return new Promise(((s,o)=>{super.addEventListener("load",(({target:t})=>s(t.result))),super.addEventListener("error",(({target:t})=>o(t.error))),super[e](t)}))}readAsArrayBuffer(t){return this.#c(t,"readAsArrayBuffer")}readAsDataURL(t){return this.#c(t,"readAsDataURL")}readAsText(t){return this.#c(t,"readAsText")}}class u{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static FILE=5;static matchClass="class.";static matchFile="file";static matchRadio="radio";static matchCheckbox="checkbox";static getType(t){return t===this.matchFile?this.FILE:t===this.matchRadio?this.RADIO:t===this.matchCheckbox?this.CHECKBOX:t.startsWith(this.matchClass)?this.CLASS:this.VALUE}static async getValue(t,e){return t[e]}static async updateDomByValueType(t){const e=t.domProperty.split("."),s=await this.getValue(t.proxyViewModel,t.path),o=(t,e,s,i=t.shift())=>0===t.length?e[i]!==s&&(e[i]=s):o(t,e[i],s),i=s=>o(e,t.dom,t.filter.forward(t.forwardFilters,s));s instanceof Promise?s.then((t=>i(t))):i(s)}static async updateDomByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=await this.getValue(t.proxyViewModel,t.path),o=s=>t.filter.forward(t.forwardFilters,s)?!t.dom.classList.contains(e)&&t.dom.classList.add(e):t.dom.classList.contains(e)&&t.dom.classList.remove(e);s instanceof Promise?s.then((t=>o(t))):o(s)}static async updateDomByRadioType(t){const e=await this.getValue(t.proxyViewModel,t.path),s=e=>t.dom.checked=t.dom.value===t.filter.forward(t.forwardFilters,e);e instanceof Promise?e.then((t=>s(t))):s(e)}static async updateDomByCheckboxType(t){const e=await this.getValue(t.proxyViewModel,t.path),s=e=>t.dom.checked=(t.filter.forward(t.forwardFilters,e)??[]).includes(t.dom.value);e instanceof Promise?e.then((t=>s(t))):s(e)}static async updateDomByFileType(t){}static async setValue(t,e,s){t[e]=s}static async updateViewModelByValueType(t){const e=t.domProperty.split("."),s=(t,e,o=t.shift())=>0===t.length?e[o]:s(t,e[o]),o=t.filter.backward(t.backwardFilters,s(e,t.dom));await this.setValue(t.proxyViewModel,t.path,o)}static async updateViewModelByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=t.dom.classList.contains(e);await this.setValue(t.proxyViewModel,t.path,s)}static async updateViewModelByRadioType(t){if(t.dom.checked){const e=t.dom.value;await this.setValue(t.proxyViewModel,t.path,e)}}static async updateViewModelByCheckboxType(t){const e=new Set(t.proxyViewModel[t.path]??[]);t.dom.checked?e.add(t.dom.value):e.delete(t.dom.value);const s=Array.from(e);await this.setValue(t.proxyViewModel,t.path,s)}static async updateViewModelByFileType(t){if(0==t.dom.files.length)return;const e=new p,s=await e.readAsText(t.dom.files[0]),o=t.filter.backward(t.backwardFilters,s);await this.setValue(t.proxyViewModel,t.path,o)}static#d={};static#p={};static init(){this.#d[this.VALUE]=this.updateDomByValueType,this.#d[this.CLASS]=this.updateDomByClassType,this.#d[this.RADIO]=this.updateDomByRadioType,this.#d[this.CHECKBOX]=this.updateDomByCheckboxType,this.#d[this.FILE]=this.updateDomByFileType,this.#p[this.VALUE]=this.updateViewModelByValueType,this.#p[this.CLASS]=this.updateViewModelByClassType,this.#p[this.RADIO]=this.updateViewModelByRadioType,this.#p[this.CHECKBOX]=this.updateViewModelByCheckboxType,this.#p[this.FILE]=this.updateViewModelByFileType}static async updateDom(t,e=t.domPropertyType){await Reflect.apply(this.#d[e],this,[t])}static async updateViewModel(t,e=t.domPropertyType){await Reflect.apply(this.#p[e],this,[t])}}class h{#u;#h;#m;#f;#y;#g;#w;#b;#x;#P;#v;#k;constructor(t,e,s){this.#h=t,this.#m=e.dom?.property,this.#f=s.proxyViewModel,this.#y=e.viewModel?.property,this.#g=e.inputable,this.#v=class{static parse(t){return 0==t.length?[]:t.split("|").map((t=>t.split(":"))).map((([t,e])=>({name:t,options:e?.split(";")??[],filter:o.filterByName.get(t)})))}}.parse(e?.filters.join("|"))??[],this.#k=this.#v.slice().reverse(),this.#u=s,this.#w=s.indexes?.slice()??[],this.#P=u.getType(this.#m);const{path:i,pattern:r}=s.getPathInfo(this.#y);this.#b=i,this.#x=r}get dom(){return this.#h}get domProperty(){return this.#m}get proxyViewModel(){return this.#f}get path(){return this.#b}get pattern(){return this.#x}get domPropertyType(){return this.#P}get forwardFilters(){return this.#v}get backwardFilters(){return this.#k}get filter(){return this.#u.filter}async init(t=this.#g){t&&this.attachEvent(),await this.updateDom()}async updateDom(){await u.updateDom(this)}async#E(){await u.updateViewModel(this)}attachEvent(t=this.#h,e=this.#u,s=e.view){t.addEventListener("input",(async t=>{await e.$updateProcess((()=>this.#E()))}))}}u.init();class m{nodes=[];loops;binds;key}class f{#h;#y;#M=[];#u;#b;#x;#B;constructor(t,e,s){this.#h=t,this.#y=e.viewModel?.property,this.#u=s;const{path:o,pattern:i}=s.getPathInfo(this.#y);this.#b=o,this.#x=i,this.#B=s.loopStack.slice()}get dom(){return this.#h}get path(){return this.#b}get pattern(){return this.#x}get children(){return this.#M}async#C(t,e=this.#h,s=this.#u){return s.pushLoop({loop:this,key:t},(()=>{const o=s.loopStack.map((t=>t.key));return s.pushIndexes(o,(async()=>{const o=document.createDocumentFragment(),i=new m,r=e.content.cloneNode(!0),{binds:a,loops:n}=await s.view.createBindTree(s,r);return Object.assign(i,{key:t,binds:a,loops:n}),o.appendChild(r),i.nodes.push(...Array.from(o.childNodes)),i}))}))}async expand(t=this.#u.proxyViewModel,e=this.#b,s=this.#M,o=this.#h){const i=await t[e];try{for(const t of Object.keys(i))s.push(await this.#C(t))}catch(t){throw console.log(t,e,i),t}const r=document.createDocumentFragment(),a=t=>r.appendChild(t);s.forEach((t=>t.nodes.forEach(a))),o.after(r)}#A(t,e=this.#u){const s=this.#B.slice(),o=s=>{if(0===s.length)return t();const i=s.pop();return e.pushLoop(i,(()=>o(s)))};return o(s)}#R(t){t.loops.forEach((t=>t.contract())),t.nodes.forEach((t=>t.parentNode.removeChild(t)))}contract(t=this.#M){t.forEach((t=>this.#R(t))),t.splice(0)}async update(){this.contract(),await this.#A((async()=>this.expand()))}}class y{#h;#u;#D;#w;#$;constructor(t,e,s){this.#h=t,this.#D=e.dom?.event,this.#u=s,this.#w=s.indexes?.slice()??[],this.#$=this.#T()}get event(){return this.#D}get dom(){return this.#h}init(){this.#V()}#T(){const t=this.#h;return`${this.#D.toLowerCase()}${e="x:name"in t?.dataset?t?.dataset["x:name"]:t?.name?.length>0?t.name:t.tagName.toLowerCase(),e?.length>0?e.at(0).toUpperCase()+e.slice(1):""}`;var e}async#N(t,e=this.#u.proxyViewModel,s=this.#u.eventHandler,o=this.#$,i=this.#w,r=this.#u){return r.pushIndexes(i,(()=>s.exec(e,o,t,...i)))}#V(t=this.#h,e=this.#D,s=this.#u,o=s.view){t.addEventListener(e,(async t=>{await s.$updateProcess((()=>this.#N(t)))}))}}const g=":not([data-x\\:processed])",w="x:ignore",b=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((t=>`${t}${g}`)).join(","),x=["input","textarea","select","button"].map((t=>`${t}${g}`)).join(",");class P{static async createBindTree(t,e,s=t.bindRules){const{loops:o,binds:i,events:r}=class{static inputable(t){return"INPUT"===t.tagName&&"button"!==t.type||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||!0===t?.isContentEditable}static testFile(t){return"INPUT"===t.tagName&&"file"===t.type}static testRadio(t){return"INPUT"===t.tagName&&"radio"===t.type}static testCheckbox(t){return"INPUT"===t.tagName&&"checkbox"===t.type}static parsePropertyName(t){const e=t.split("|");return{property:e.shift(),filters:e}}static parseDataBind(t,e,s=this.inputable(t),o=this.testFile(t),i=this.testRadio(t),r=this.testCheckbox(t)){const a=(e,a)=>{if(e.includes("=")){const[n,l]=e.split("="),{property:c,filters:d}=this.parsePropertyName(l);a.dom.property=n,a.viewModel.property=c,a.filters=d;const p=new Set(s?o?["file"]:i?["radio"]:r?["checked","checkbox"]:t.isContentEditable?["textContent"]:["value"]:[]);a.inputable=p.has(n)}else{const{property:n,filters:l}=this.parsePropertyName(e);a.dom.property=s?o?"file":i?"radio":r?"checkbox":t.isContentEditable?"textContent":"value":"textContent",a.viewModel.property=n,a.filters=l,a.inputable=s}return a},n=e.split(",");if(1==n.length)return[a(e,{dom:{},viewModel:{},filters:[]})];{const t=n.map((t=>a(t,{dom:{},viewModel:{},filters:[]})));return t}}static collectByAttribute(t,e,s=[],o=[],i=[]){return Array.from(e.querySelectorAll(b)).forEach((e=>{if(w in e.dataset)return;const r=e.dataset["x:processing"]?.split(",")??[];if("x:loop"in e.dataset){if("TEMPLATE"!==e.tagName)return;if(r.includes("loop"))return;const s={dom:{},viewModel:{property:e.dataset["x:loop"]},filters:[]};o.push(new f(e,s,t)),r.push("loop")}else{if("x:bind"in e.dataset){if(r.includes("bind"))return;s.push(...this.parseDataBind(e,e.dataset["x:bind"]).map((s=>new h(e,s,t)))),r.push("bind")}if("x:events"in e.dataset){if(r.includes("events"))return;e.dataset["x:events"].split(",").forEach((s=>{const o={dom:{event:s},viewModel:{},filters:[]};i.push(new y(e,o,t))})),r.push("events")}}e.dataset["x:processing"]=r.join(",")})),{binds:s,loops:o,events:i}}static collectByImplicit(t,e,s=[],o=[],i=[]){return Array.from(e.querySelectorAll(x)).forEach((e=>{if(w in e.dataset)return;const o=e.dataset["x:processing"]?.split(",")??[],r=this.testFile(e),a=this.testRadio(e),n=this.testCheckbox(e),l={dom:{},viewModel:{},filters:[]};if("BUTTON"===e.tagName||"INPUT"===e.tagName&&"button"===e.type){if(o.includes("events"))return;l.dom.event="click",i.push(new y(e,l,t)),o.push("events")}else{if(o.includes("bind"))return;const{property:i,filters:c}=this.parsePropertyName(e.name);l.dom.property=r?"file":a?"radio":n?"checkbox":"value",l.viewModel.property=i,l.filters=c,l.inputable=!0,s.push(new h(e,l,t)),o.push("bind")}e.dataset["x:processing"]=o.join(",")})),{binds:s,loops:o,events:i}}static collectByRule(t,e,s,o=[],i=[],r=[]){const a=new Map;return s.forEach((t=>{!a.has(t.dom.selector)&&a.set(t.dom.selector,[]),a.get(t.dom.selector).push(t)})),Array.from(a.keys()).forEach((s=>{e.querySelectorAll(`${s}${g}`).forEach((e=>{if(w in e.dataset)return;const n=this.inputable(e),l=e.dataset["x:processing"]?.split(",")??[],c=l.slice();a.get(s).forEach((s=>{const a=JSON.parse(JSON.stringify(s));if("TEMPLATE"===e.tagName){if(l.includes("loop"))return;((e,s)=>{i.push(new f(s,e,t))})(a,e),c.push("loop")}else if("event"in a.dom){if(l.includes("events"))return;((e,s)=>{r.push(new y(s,e,t))})(a,e),c.push("events")}else{if(l.includes("bind"))return;a.inputable=n,((e,s)=>{o.push(new h(s,e,t))})(a,e),c.push("bind")}})),e.dataset["x:processing"]=c.join(",")}))})),{loops:i,binds:o,events:r}}static collect(t,e,s=[]){const o=[],i=[],r=[];return this.collectByRule(t,e,s,o,i,r),this.collectByAttribute(t,e,o,i,r),this.collectByImplicit(t,e,o,i,r),o.forEach((t=>t.dom.dataset["x:processed"]="")),i.forEach((t=>t.dom.dataset["x:processed"]="")),r.forEach((t=>t.dom.dataset["x:processed"]="")),Array.from(e.querySelectorAll("[data-x\\:processing]")).forEach((t=>{t.removeAttribute("data-x:processing")})),{loops:i,binds:o,events:r}}}.collect(t,e,s);return await Promise.all(o.map((t=>t.expand()))),await Promise.all(i.map((t=>t.init()))),r.forEach((t=>t.init())),{loops:o,binds:i,events:r}}static async build(t,e=t.rootElement){const s=await this.createBindTree(t,e);t.setBindTree(s),t.buildBinds()}static appear(t,e=t.fragment,s=t.parentElement){const o=s.attachShadow({mode:"open"});o.appendChild(e),t.rootElement=o}static attachTo(t,e){t.parentElement=e,this.appear(t)}static async updateDom(t,e=t.updateQueue,s=t.allBinds,o=t.allLoops,i=t.properties,r=t.dependencies,n=t.proxyViewModel,l=t.cache){const c=await Promise.all(e),d=[];for(const{name:t,indexes:e=[]}of c.filter((t=>null!=t))){d.push(a.expand(t,e));for(const s of r.getReferedProperties(t,e))d.push(s.name)}const p=new Set(d);await Promise.all(Array.from(p).map((t=>{l.delete(t),Reflect.get(n,t)})));for(const t of o.filter((t=>p.has(t.path))))await t.update();for(const t of s.filter((t=>p.has(t.path))))await t.updateDom();t.buildBinds()}static async postProcess(t,e=t.postProcess){e.exec()}static async updateProcess(t,e,s=t.notifier,o=t.properties,i=t.postProcess){i.clear(),s.clear(),o.clearStatus(),await e(),await this.updateDom(t),o.isUpdate&&t.buildBinds(),await i.exec()}}class v{parentNodes=[];name;func;childNodes=[];constructor(t){this.name=t}}class k{#O=new Map;#S;#u;constructor(t){this.#u=t}get map(){return this.#O}build(t=this.#O,e=this.#u.dependencyRules){t.clear(),this.#S=this.#u.dependencyRules.slice(),e.forEach((([t,e,s])=>this.add(t,e,s))),this.implicitDependency()}implicitDependency(t=this.#u.props,e=this.#u.properties){for(const s of e)t.getDependencyNames(e,s.name).forEach((t=>this.add(t,[s.name])))}add(t,e,s,o=this.#O){o.has(t)||o.set(t,new v(t));const i=o.get(t);i.func=s,e.forEach((t=>{o.has(t)||o.set(t,new v(t));const e=o.get(t);i.childNodes.push(e),e.parentNodes.push(i)}))}getReferedProperties(t,e,s=this.#O,o=this.#u.proxyViewModel){const i=s.get(t),r=new Set,n=e??[],l=(t,e)=>{if(null==t)return e;const s=a.expand(t.name,n);if(null!==s){if(r.has(s))return e;r.add(s);const i=t.func?Reflect.apply(t.func,o,[n]):n;if(!1===i)return e;const a={name:s,pattern:t.name,indexes:i};e.push(a)}return t.parentNodes.forEach((t=>{e=l(t,e)})),e};return l(i,[])}}class E{#j=[];#u;constructor(t){this.#u=t}get queue(){return this.#j}notify(t,e=this.#j){e.push(t)}dequeue(t=this.#j){const e=t.slice();return t.splice(0),e}clear(t=this.#j){t.splice(0)}}class M{#L=new Map;#u;constructor(t){this.#u=t}has(t){return this.#L.has(t)}get(t){return this.#L.get(t)}set(t,e){const s=e=>{"object"==typeof e&&null!==e&&"__notifiable"in e&&(e.__name=t),this.#L.set(t,e)};return s(e),e instanceof Promise&&e.then((t=>s(t))),e}delete(t){this.#L.delete(t);const e=`${t}.`;Array.from(this.#L.keys()).filter((t=>t.startsWith(e))).forEach((t=>this.#L.delete(t)))}}class B{#u;#j=[];constructor(t){this.#u=t}regist(t,e=this.#j){e.push(t)}exec(t=this.#u,e=this.#j,s=t.view){const o=e.slice();e.splice(0);const i=[];if(o.length>0)for(const t of o)i.push(t());return Promise.all(i)}clear(t=this.#j){t.splice(0)}}class C{#i;#u;constructor(t){this.#u=t}has(t,e){return"__notifiable"===e||Reflect.has(t,e)}get(t,e,s){return"__notifiable"===e||("__name"===e?this.#i:Reflect.get(t,e,s))}set(t,e,s,o){if("__name"===e)return this.#i=s,!0;if("length"===e){const t=this.#i;null!=t&&this.#u.notifier.notify({name:t})}return Reflect.set(t,e,s,o)}static notifiable(t,e){return new Proxy(e,new C(t))}}class A{name;parent;last;loops;privateName;isPath;isPattern;isPrimitive;static get(t){const e=new A;e.name=t;const s=t.includes("."),o=t.includes("*");if(e.isPath=s&&!o,e.isPattern=s&&o,e.isPrimitive=!e.isPath&&!e.isPattern,e.isPath||e.isPattern){const s=t.split(".");e.last=s.pop(),e.parent=s.join(".")}return e.isPattern&&(e.loops=t.split("").filter((t=>"*"===t)).length),e.isPrimitive&&(e.privateName=`__${t}`),e}}class R{static createDefault(t,e){return e.isPrimitive?class{static create(t,{privateName:e}){return{get:function(){return this[e]},set:function(t){this[e]=t}}}}.create(t,e):e.isPath?class{static create(t,{parent:e,last:s}){return{get:function(){return this[e]?.[s]},set:function(t){this[e][s]=t}}}}.create(t,e):e.isPattern?class{static create(t,{parent:e,last:s,loops:o}){const i=t=>"*"===s?t.indexes.at(o-1):s;return{get:function(){return this[e]?.[i(t)]},set:function(s){this[e][i(t)]=s}}}}.create(t,e):null}static wrapGetter(t,e){return function(){const s=t.indexes??[],o=t.proxyViewModel;return Reflect.apply(e,o,[...s])}}static wrapSetter(t,e){return function(s){const o=t.indexes??[],i=t.proxyViewModel;return Reflect.apply(e,i,[s,...o])}}}const D=new RegExp(/^(\@\@?)([a-zA-Z0-9_\.\*]+)(#(get|set|init)?)?$/),$=new RegExp(/^(#)(event[a-zA-Z0-9_]+)$/),T=new RegExp(/^__([a-zA-Z0-9_])+$/),V=(t,e)=>{do{e(t),t=Object.getPrototypeOf(t)}while(t!==Object.prototype)};class N{name;nameInfo;init}class O{static build(t,e=t.viewModel){const s=[],o=t=>({configurable:!0,enumerable:!1,writable:!0,value:t?.value}),i=new Map;V(e,(t=>{Object.entries(Object.getOwnPropertyDescriptors(t)).forEach((([s,r])=>{const a=(t=>D.exec(t))(s),n=(t=>$.exec(t))(s),l=(t=>T.exec(t))(s);null===a&&null===l&&null===n||(null!==l?Reflect.defineProperty(e,s,o(r)):null!==a?((([,t,e,s,o],r)=>{const a=i.has(e)?i.get(e):{baseName:null,get:null,set:null,init:null,requireSet:void 0,initValue:void 0};a.baseName=a.baseName??e;const n=(t,s)=>"function"==typeof t?t:console.error(`${e}.${s} is not function`);null!=s&&null==o?("object"!=typeof r.value&&console.error(`${e}.# is not object`),a.get=a.get??r.value?.get?n(r.value.get,"#get"):a.get,a.set=a.set??r.value?.set?n(r.value.set,"#set"):a.set,a.init=a.init??r.value?.init?n(r.value.init,"#init"):a.init):null!=s&&null!=o&&(a.get=a.get??"get"===o?n(r.value,"#get"):a.get,a.set=a.set??"set"===o?n(r.value,"#set"):a.set,a.init=a.init??"init"===o?n(r.value,"#init"):a.init),a.requireSet=void 0===a.requireSet?"@@"==t:a.requireSet,void 0!==a.requireSet&&a.requireSet!=("@@"==t)&&console.error("@@ is not match"),a.initValue=null==s?r?.value:a.initValue,i.set(e,a)})(a,r),Reflect.deleteProperty(t,s)):null!==n&&((([,,t],e)=>{const s=i.has(t)?i.get(t):{baseName:null,get:null,set:null,init:null,requireSet:void 0,initValue:void 0};var o;s.baseName=s.baseName??t,s.set=s.set??("function"==typeof(o=e.value)?o:console.error(`#${t} is not function`)),s.requireSet=!0,i.set(t,s)})(n,r),Reflect.deleteProperty(t,s)))}))}));const r=(t,e)=>t!==Object.prototype?Object.getOwnPropertyDescriptor(t,e)??r(Object.getPrototypeOf(t)):{};Array.from(i.entries()).forEach((([i,a])=>{const n=A.get(i);!(n.privateName in e)&&n.isPrimitive&&Reflect.defineProperty(e,n.privateName,o({value:a.initValue}));const l=r(e,i),c=R.createDefault(t,n),d={configurable:!0,enumerable:!0};d.get=(a.get?R.wrapGetter(t,a.get):null)??l.get??c.get,a.requireSet&&(d.set=(a.set?R.wrapSetter(t,a.set):null)??l.set??c.set),Object.defineProperty(e,i,d),s.push(Object.assign(new N,{name:i,nameInfo:n,init:a?.init}))})),V(e,(o=>{e!==o&&Object.entries(Object.getOwnPropertyDescriptors(o)).forEach((([o,i])=>{if(e.hasOwnProperty(o))return;if(null==i?.get&&null==i?.set)return;const r=A.get(o);if(null==i?.get&&null!=i?.set){const e=R.createDefault(t,r);i.get=e.get}i.enumerable=!0,Object.defineProperty(e,o,i),s.push(Object.assign(new N,{name:o,nameInfo:r}))}))}));const a=[];return Array.from(Object.keys(e)).forEach((t=>{const e=t.split(".").reduce(((t,e)=>(t.push(t.at(-1)?.slice()??[]),t.at(-1).push(e),t)),[]);a.push(...e.map((t=>t.join("."))))})),Array.from(new Set(a)).filter((t=>!e.hasOwnProperty(t))).forEach((o=>{const i={configurable:!0,enumerable:!0},r=A.get(o),a=R.createDefault(t,r);i.get=a.get,Object.defineProperty(e,o,i),s.push(Object.assign(new N,{name:o,nameInfo:r}))})),s}static getDependencyNames(t,e){const s=`${e}.`;return t.map((t=>t.name)).filter((t=>t.startsWith(s)&&!t.slice(s.length).includes(".")))}}class S{#u;#F=new Map;#q=new Map;constructor(t){this.#u=t}patternToRegExp(t){return new RegExp("^"+t.replaceAll(".","\\.").replaceAll("*","([a-zA-Z0-9_]+)")+"$")}getExpandName(t,e,s=this.#F,o=this.#q){if(s.has(e))return s.get(e);for(const i of Object.keys(t)){if(!i.includes("*"))continue;o.has(i)||o.set(i,this.patternToRegExp(i));const t=o.get(i).exec(e)?.slice(1);if(null!=t){const o={name:e,pattern:i,indexes:t};return s.set(e,o),o}}}get(t,e,s,o=this.#u,i=o.cache){if(i.has(e))return i.get(e);if(e in t){const o=Object.getOwnPropertyDescriptor(t,e),r=o?.get?Reflect.apply(o.get,s,[]):t[e];return e.includes("*")?r:i.set(e,r)}{const r=this.getExpandName(t,e);if(null!=r)return o.pushIndexes(r.indexes,(()=>{const o=Object.getOwnPropertyDescriptor(t,r.pattern);return i.set(e,o?.get?Reflect.apply(o.get,s,[]):t[r.pattern])}))}console.error(`undefied property "${e}"`)}set(t,e,s,o,i=this.#u,r=i.cache,a=i.notifier){r.has(e)&&r.delete(e);const n=(t,e)=>{a.notify(new Promise((async(s,o)=>{s(await t!==c.suspend?e:null)})))};if(e in t){const i=Object.getOwnPropertyDescriptor(t,e),r=i?.set?Reflect.apply(i.set,o,[s]):t[e]=s;return i?.set&&n(r,{name:e}),!0}{const r=this.getExpandName(t,e);if(null!=r)return i.pushIndexes(r.indexes,(()=>{const i=Object.getOwnPropertyDescriptor(t,r.pattern),a=i?.set?Reflect.apply(i.set,o,[s]):t[e]=s;n(a,{name:r.pattern,indexes:r.indexes})})),!0}console.error(`undefied property "${e}"`)}}class j{#I;#_;#U;#H;#Q;#z;#W;#X={binds:[],loops:[]};#K=[];#Z=[];#B=[];#G=[];#J;#Y;#L;#tt;#o;#et;#st=[];#f;constructor(t,e,s){this.#o=t,this.#I=e,this.#tt=s}build(){this.#H=P,this.#z=new B(this),this.#W=new k(this),this.#Y=new E(this),this.#L=new M(this)}get parentElement(){return this.#I}get fragment(){return this.#_}get rootElement(){return this.#U??this.#_}get view(){return this.#H}get viewModel(){return this.#Q}get postProcess(){return this.#z}get dependencies(){return this.#W}get bindTree(){return this.#X}get allBinds(){return this.#K}get allLoops(){return this.#Z}get indexesStack(){return this.#G}get indexes(){return this.#G[this.#G.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#B}get currentLoop(){return this.#B[this.#B.length-1]}get properties(){return this.#J}get notifier(){return this.#Y}get cache(){return this.#L}get context(){return this}get rootBlock(){return this.#tt}get block(){return this.#o}get data(){return this.#tt.data}get template(){return this.#et.template}get module(){return this.#et}get moduleDatas(){return this.#et.moduleDatas}get bindRules(){return this.#et.bindRules}get dependencyRules(){return this.#et.dependencyRules}get isBlockModule(){return this.#et.useModule}get symbols(){return c}get updateQueue(){return this.#st}get notifiable(){return C}get props(){return O}get filter(){return o}get eventHandler(){return n}get initializer(){return l}get dataReflecter(){return d}get proxyHandler(){return S}get proxyViewModel(){return this.#f}set module(t){this.#et=t,this.#Q=void 0!==t.viewModel?t.viewModel:void 0!==t.AppViewModel?Reflect.construct(t.AppViewModel,[]):{},this.#_=t.template.content.cloneNode(!0);const e=t?.context??t?._;null!=e&&this.reflect(e,t.dialog),this.#f=new Proxy(this.#Q,Reflect.construct(this.proxyHandler,[this]))}set rootElement(t){this.#U=t}set parentElement(t){this.#I=t}set properties(t){this.#J=t}copyUpdateQueue(){this.#st=this.#Y.dequeue()}pushIndexes(t,e){this.#G.push(t);const s=e();return s instanceof Promise?s.finally((()=>this.#G.pop())):this.#G.pop(),s}pushLoop({loop:t,key:e},s){this.#B.push({loop:t,key:e});const o=s();return o instanceof Promise?o.finally((()=>this.#B.pop())):this.#B.pop(),o}getPathInfo(t,e=t,s=this.currentLoop?.loop,o=this.currentLoop?.key,i=this.indexes??[]){return"."===t[0]?"."===t?{path:`${s.path}.${o}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${o}.${t}`,pattern:`${s.pattern}.*.${t}`}:{path:a.expand(e,i),pattern:e}}setBindTree({binds:t,loops:e},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...t),s.loops.push(...e)}buildBinds(t=this.bindTree,e=this.allBinds,s=this.allLoops){e.splice(0),s.splice(0);const o=t=>e.push(t),i=t=>s.push(t);t.binds.forEach(o),t.loops.forEach(i);const r=t=>{t.children.forEach((t=>{t.binds.forEach(o),t.loops.forEach(i),t.loops.forEach(r)}))};t.loops.forEach(r)}reflect(t,e){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([e,s])=>{if(null!=s?.get){const o={configurable:!0,enumerable:!0,get:(...t)=>Reflect.apply(s.get,this,t)};Object.defineProperty(t,e,o)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postProcess","postProcess"],["$updateProcess","updateProcess"],["$notifiable","notifiable"]].forEach((([e,s])=>{const o={configurable:!0,enumerable:!1,value:"AsyncFunction"===e.constructor.name?async(...t)=>Reflect.apply(this[e],this,t):(...t)=>Reflect.apply(this[e],this,t)};Object.defineProperty(t,s,o)})),null!=e){this.$closeDialog=function(t){e.closeDialog(t)};const s={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$closeDialog,this,t)};Object.defineProperty(t,"closeDialog",s),this.$cancelDialog=function(){e.cancelDialog()};const o={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$cancelDialog,this,t)};Object.defineProperty(t,"cancelDialog",o)}}$notify(t,e=[]){this.notifier.notify({name:t,indexes:e})}$postProcess(t){this.postProcess.regist(t)}$notifyAll(t,e=[]){this.rootBlock.notifyAll(t,e,this.block)}$notifiable(t){return this.notifiable.notifiable(this,t)}async $updateProcess(t){this.rootBlock.updateProcess(t)}$inquiryAll(t,e,s){return this.$postProcess((()=>this.rootBlock.inquiryAll(t,e,s,this.block)))}async $openDialog(t,e={}){return r.open(t,e)}}const L="--bind-",F="--bind-class-";class q{dom={selector:""};viewModel={};filters=[];static#ot(t,e,s,o){const i=new q;return i.dom.selector=t,i.dom.property=e,i.viewModel.property=s,i.filters.push(...o),i}static#it(t,e){const s=new q;return s.dom.selector=t,s.dom.event=e,s}static#rt(t,e){const s=new q;return s.dom.selector=t,s.viewModel.property=e,s}static build(t){const e=[];for(let s=0;s<t.style.length;s++){const o=t.style[s],i=t.style.getPropertyValue(o).trim();if("--events"===o)for(const s of i.split(",")){const o=q.#it(t.selectorText,s);e.push(o)}else if("--loop"===o){const s=q.#rt(t.selectorText,i);e.push(s)}else if(o.startsWith(F)){const s=i.split("|"),r=s.shift(),a=s,n=q.#ot(t.selectorText,"class."+o.slice(F.length),r,a);e.push(n)}else if(o.startsWith(L)){const s=i.split("|"),r=s.shift(),a=s,n=q.#ot(t.selectorText,o.slice(L.length).replaceAll("-","."),r,a);e.push(n)}}return e}}class I{static spaPath;static spaCssPath;static spaHtmlPath;static spaModulePath;static filterPath;static localFilter;static modulePath=".";static setOptions(t,e){this.spaPath=e.spaPath??(t?`${t}-spa`:"spa"),this.spaCssPath=`${this.spaPath}/css`,this.spaHtmlPath=`${this.spaPath}/html`,this.spaModulePath=`${this.spaPath}/module`,this.modulePath=e.modulePath??".",this.localFilter=e.localFilter??!1,this.filterPath=this.localFilter?e.filterPath??`${this.spaPath}/module/filter`:null}}class _{name;viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;useModule;moduleDatas;static async load({name:t,useModule:e,withBindCss:s,module:o=new _}){const i=e?null:I.spaCssPath,r=e?null:I.spaHtmlPath,a=e?null:I.spaModulePath,n=e?I.modulePath:null;o.name=t,o.useModule=e;const l=await this.loadScript(t,n??a);if(Object.assign(o,l?.default??{}),void 0===o.html&&null!==r){const e=await this.loadHtml(t,r);Object.assign(o,{html:e})}if(void 0===o.css&&null!==i){const e=await this.loadCss(t,i);Object.assign(o,{css:e})}if(s&&void 0===o.bindCss&&null!==i&&void 0===o.bindRules){const e=await this.loadBindCss(t,i);Object.assign(o,{bindCss:e})}return this.build(t,o,e)}static build(t,e,s=!1){e.useModule=s;const o=this.buildTemplate(t,e.html,e.css);if(Object.assign(e,{template:o}),void 0===e.bindRules&&void 0!==e.bindCss){const t=this.buildBindRules(e.bindCss);Object.assign(e,{bindRules:t})}return void 0===e.dependencyRules&&(e.dependencyRules=[]),void 0===e.bindRules&&(e.bindRules=[]),e}static async loadScript(t,e){const s=e.startsWith("https://")||e.startsWith("http://")||"/"===e[0],o=document.baseURI.lastIndexOf("/"),i=o>=0?document.baseURI.slice(0,o+1):"";return import(s?`${e}/${t}.js`:`${i}${e}/${t}.js`).catch((t=>{throw console.error(t),t}))}static async loadHtml(t,e){return fetch(`${e}/${t}.html`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadCss(t,e){return fetch(`${e}/${t}.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadBindCss(t,e){return fetch(`${e}/${t}.bind.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(res.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static buildTemplate(t,e,s){const o=document.createElement("template");return o.innerHTML=e,void 0!==s&&(o.innerHTML="<style>\n"+s+"\n</style>\n"+o.innerHTML),o.dataset["x:block"]=t,o}static buildBindRules(t){return class{static collect(t){if(null==t||""===t)return[];const e=document.createElement("div");document.body.appendChild(e);const s=e.attachShadow({mode:"open"}),o=document.createElement("style");o.textContent=t;const i=[];s.appendChild(o);const r=Array.from(s.styleSheets).find((t=>t.ownerNode===o));return Array.from(r?.cssRules??[]).map((t=>i.push(...q.build(t)))),document.body.removeChild(e),i}}.collect(t)}}class U{#i;#u;#at=[];#nt;constructor(t=null){this.#nt=t}get context(){return this.#u}get name(){return this.#i}#lt(t,e,s){return this.#i=t,this.#u=new j(this,e,s),this.#u.build(),this.#u}async load({name:t,parentElement:e,useModule:s,moduleData:o,withBindCss:i,rootBlock:r}){const a=this.#lt(t,e,r);try{const e=t=>{const e=r.block.context.moduleDatas[t];return _.build(t,e)},n=s&&r?.block?e(t):null!=o?_.build(t,o,s):await _.load({name:t,useModule:s,withBindCss:i});s&&(r.block??(r.block=this)),n.dialog=this.#nt,a.module=n}catch(t){throw t}}async build({data:t,useModule:e,rootBlock:s,context:o=this.#u}){o.properties=o.props.build(o),o.dependencies.build(),o.dataReflecter.reflect(o,t,o.proxyViewModel),await o.initializer.init(o,t),await o.view.build(o),this.#at.push(...await H.build(o.rootElement,e,s)),(!o.isBlockModule||null!=o.parentElement)&&o.view.appear(o),await o.postProcess.exec()}static async create({name:t,parentElement:s=null,useModule:o=!1,moduleData:i=null,withBindCss:r=!1,rootBlock:a=e.root,data:n=a.data,dialog:l=null}){const c=new U(l);return await c.load({name:t,parentElement:s,useModule:o,moduleData:i,withBindCss:r,rootBlock:a}),await c.build({data:n,useModule:o,rootBlock:a}),c}notifyAll(t,e,s){const o=this.#u,i=o.notifier,r=o.proxyViewModel,a=o.eventHandler;o.view,s!==this&&i.notify(new Promise((async(o,i)=>{const n=a.exec(r,"notifyAll",t,e,s);n instanceof Promise&&await n,o({name:t,indexes:e})})));for(const o of this.#at)o.notifyAll(t,e,s)}prepareUpdate(){const t=[];this.context.copyUpdateQueue(),t.push(this.context.updateQueue.length>0);for(const e of this.#at)t.push(e.prepareUpdate());return!t.every((t=>!1===t))}async updateDom(){const t=[];t.push(this.context.view.updateDom(this.context));for(const e of this.#at)t.push(e.updateDom());return Promise.all(t)}async postProcess(){const t=[];t.push(this.context.view.postProcess(this.context));for(const e of this.#at)t.push(e.postProcess());return Promise.all(t)}async inquiryAll(t,e,s,o){const i=this.#u,r=i.proxyViewModel,a=i.eventHandler,n=[];o!==this&&n.push(a.exec(r,"inquiryAll",t,e,s,o));for(const i of this.#at)n.push(i.inquiryAll(t,e,s,o));await Promise.all(n)}attachTo(t,e=this.#u,s=e.view){s.attachTo(e,t)}}class H{static async build(t,s=!1,o=e.root){return await Promise.all((t=>Array.from(t.querySelectorAll("[data-x\\:block]")))(t).map((t=>(async t=>{const e=t.dataset["x:block"],i="x:withBindCss"in t.dataset;return U.create({name:e,parentElement:t,withBindCss:i,useModule:s,rootBlock:o})})(t))))}}class Q{#at=[];get blocks(){return this.#at}get data(){return t.data}async build(){this.#at.push(...await H.build(document.body))}async updateProcess(t){const e=()=>{const t=[];for(const e of this.#at)t.push(e.prepareUpdate());return!t.every((t=>!1===t))},s=()=>{const t=[];for(const e of this.#at)t.push(e.updateDom());return Promise.all(t)},o=()=>{const t=[];for(const e of this.#at)t.push(e.postProcess());return Promise.all(t)};for(await t();e();)await s(),await o()}notifyAll(t,e,s){for(const o of this.#at)o.notifyAll(t,e,s)}inquiryAll(t,e,s,o){const i=[];for(const r of this.#at)i.push(r.inquiryAll(t,e,s,o));return Promise.all(i)}}o.regist("falsey",{forward:(t,e=[])=>!t}),o.regist("not",{forward:(t,e=[])=>!t}),o.regist("null",{forward:(t,e=[])=>null==t}),o.regist("style-display",{forward:(t,e=[])=>t?"":"none"}),o.regist("locale-string",{forward:(t,e=[])=>Number(t).toLocaleString()}),o.regist("fixed",{forward:(t,e=[])=>Number(t).toFixed(e[0]??0)}),o.regist("ge",{forward:(t,e=[])=>Number(t)>=Number(e[0]??0)}),o.regist("gt",{forward:(t,e=[])=>Number(t)>Number(e[0]??0)}),o.regist("le",{forward:(t,e=[])=>Number(t)<=Number(e[0]??0)}),o.regist("lt",{forward:(t,e=[])=>Number(t)<Number(e[0]??0)}),o.regist("number-value",{forward:(t,e=[])=>t?.toString()??"",backward:(t,e=[])=>""!==t?Number(t):null}),o.regist("b64",{forward:(t,e=[])=>atob(t),backward:(t,e=[])=>btoa(t)});class z{static root;static booting=!1;static booted=!1;static async boot({data:o={},options:i={}}={}){this.booting=!0;try{t.setData(o),I.setOptions(this.getBaseName(),i),await class{static async registLocalFilter(t=I.localFilter,e=I.filterPath){if(t){const t=document.baseURI.lastIndexOf("/"),o=t>=0?document.baseURI.slice(0,t+1):"";await s(108)(`${o}${e}/regist.js`)}}}.registLocalFilter(),this.root=new Q,e.setRoot(this.root),await this.root.build()}finally{this.booting=!1,this.booted=!0}}static getBaseName(){const t=location.href.split("/").pop();if(t){const e=t.split(".");return e.pop(),e.join(".")}return t}static async createBlockModule(t,{alias:e=null,data:s={},path:o=null,handler:r=null,parentElement:a=null}){const n={useModule:!0,rootBlock:new i(s,r)};return"object"==typeof t&&null!==t?(n.moduleData=t,n.name=e??"__blockModule"):"."===t[0]||"/"===t[0]?(n.path=t,n.name=e??"__blockModule"):n.name=t,n.parentElement=a,U.create(n)}static getSymbol(t){return c[t]}}document.addEventListener("DOMContentLoaded",(function(){z.booted||z.booting||z.boot()})),window.datax=z})()})();