(()=>{var t={108:t=>{function e(t){return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}e.keys=()=>[],e.resolve=e,e.id=108,t.exports=e}},e={};function s(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,s),a.exports}s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t{static data={};static setData(t){this.data=t}}class e{static root={};static setRoot(t){this.root=t}}class r{static filterByName=new Map;static regist(t,e){this.filterByName.set(t,e)}static forward(t,e){return t.reduce(((t,e)=>"forward"in e.filter?((t,e)=>t.filter.forward(e,t.options))(e,t):t),e)}static backward(t,e){return t.reduce(((t,e)=>"backward"in e.filter?((t,e)=>t.filter.backward(e,t.options))(e,t):t),e)}}class i{#t;#e;#s;#r;#i;#a;#n;#o;constructor(t,e){this.#s=t,this.#e=e}get name(){return this.#s}get data(){return this.#e}get block(){return this.#t}get root(){return this.#r}createBackLayer(t=this.#s){const e=document.createElement("div");e.dataset["x:dialog"]=t;const s=document.createElement("div");s.style.position="fixed",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-around",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.left="0",s.style.top="0",s.style.height="100vh",s.style.width="100vw",s.style.zIndex="499",s.classList.add("bg"),s.addEventListener("click",(t=>this.cancelDialog())),e.appendChild(s);const r=document.createElement("div");return r.style.backgroundColor="white",r.style.borderRadius=".375rem",r.style.padding="2rem",r.classList.add("fg"),r.addEventListener("click",(t=>t.stopPropagation())),s.appendChild(r),{root:e,bg:s,fg:r}}async build(t=this.#s,e=this.#e,s=!1){const{root:r,bg:i,fg:a}=this.createBackLayer(t),n=await j.create({name:t,parentElement:a,withBindCss:s,data:e,dialog:this});document.body.appendChild(r),this.#t=n,this.#r=r}static async create(t=this.#s,e=this.#e,s=!1){return new i(t,e).build()}cancelDialog(){this.#o&&this.#o()}closeDialog(t){this.#n&&this.#n(t)}async main(){return new Promise(((t,e)=>{this.#n=t,this.#o=e})).finally((()=>{this.#r.parentNode.removeChild(this.#r)}))}static async open(t,e={}){return(await i.create(t,e)).main()}}class a{name;pattern;indexes;lastName;parentName;constructor({name:t=null,pattern:e=null,indexes:s=null}){this.name=t,this.pattern=e,this.indexes=s,null==t&&null!=e&&null!=s&&(this.name=a.expand(e,s));const r=this.name.split(".");this.lastName=r.pop(),this.parentName=r.join(".")}static expand(t,e,s=e.slice()){let r=!1;const i=t.replaceAll("*",(()=>s.shift()??(r=!0,"*")));return r?null:i}static createByName(t){return new a({name:t})}static createByPatternIndexes(t,e){return new a({pattern:t,indexes:e})}}class n{static async exec(t,e,...s){const r=e[0].toUpperCase()+e.slice(1),i=`event${r}`,a=`on${r}`;if(i in t){const e=Object.getOwnPropertyDescriptor(t,i);return Reflect.apply(e.set,t,[s])}if(a in t)return t[a](...s)}}class o{static async init(t,e,s=t.viewModel,r=t.properties){for(const t of r.values){if(null==t?.init)continue;const r=t.init(e),i=r instanceof Promise?await r:r;t.name.includes(".")?s[t.name]=i:s[`__${t.name}`]=i}return n.exec(s,"init",e)}}class l{static reflect(t,e,s={}){Object.keys(e).forEach((r=>{const i=`$${r}`,a=e=>!1!==e&&t.$postProcess((()=>{t.$notify(i),t.$notifyAll(i)})),n={configurable:!1,enumerable:!0,get:()=>Reflect.get(e,r),set:t=>{const s=Reflect.set(e,r,t);return s instanceof Promise?s.then(a):a(s),s}};Object.defineProperty(s,i,n)}))}}class c{static VALUE=1;static CLASS=2;static RADIO=3;static CHECKBOX=4;static matchClass="class.";static matchRadio="radio";static matchCheckbox="checkbox";static getType(t){return t===this.matchRadio?this.RADIO:t===this.matchCheckbox?this.CHECKBOX:t.startsWith(this.matchClass)?this.CLASS:this.VALUE}static async getValue(t,e){const s=Object.getOwnPropertyDescriptor(t,e);return s?.get?await Reflect.apply(s.get,t,[]):t[e]}static async updateDomByValueType(t){const e=t.domProperty.split("."),s=await this.getValue(t.viewModel,t.path),r=(t,e,s,i=t.shift())=>0===t.length?e[i]!==s&&(e[i]=s):r(t,e[i],s),i=s=>r(e,t.dom,t.filter.forward(t.forwardFilters,s));s instanceof Promise?s.then((t=>i(t))):i(s)}static async updateDomByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=await this.getValue(t.viewModel,t.path),r=s=>t.filter.forward(t.forwardFilters,s)?!t.dom.classList.contains(e)&&t.dom.classList.add(e):t.dom.classList.contains(e)&&t.dom.classList.remove(e);s instanceof Promise?s.then((t=>r(t))):r(s)}static async updateDomByRadioType(t){const e=await this.getValue(t.viewModel,t.path),s=e=>t.dom.checked=t.dom.value===t.filter.forward(t.forwardFilters,e);e instanceof Promise?e.then((t=>s(t))):s(e)}static async updateDomByCheckboxType(t){const e=await this.getValue(t.viewModel,t.path),s=e=>t.dom.checked=(t.filter.forward(t.forwardFilters,e)??[]).includes(t.dom.value);e instanceof Promise?e.then((t=>s(t))):s(e)}static async setValue(t,e,s){const r=Object.getOwnPropertyDescriptor(t,e);r?.set?await Reflect.apply(r.set,t,[s]):bind.viewModel[e]=s}static async updateViewModelByValueType(t){const e=t.domProperty.split("."),s=(t,e,r=t.shift())=>0===t.length?e[r]:s(t,e[r]),r=t.filter.backward(t.backwardFilters,s(e,t.dom));await this.setValue(t.viewModel,t.path,r)}static async updateViewModelByClassType(t){const e=t.domProperty.slice(this.matchClass.length),s=t.dom.classList.contains(e);await this.setValue(t.viewModel,t.path,s)}static async updateViewModelByRadioType(t){if(t.dom.checked){const e=t.dom.value;await this.setValue(t.viewModel,t.path,e)}}static async updateViewModelByCheckboxType(t){const e=new Set(t.viewModel[t.path]??[]);t.dom.checked?e.add(t.dom.value):e.delete(t.dom.value);const s=Array.from(e);await this.setValue(t.viewModel,t.path,s)}static#l={};static#c={};static init(){this.#l[this.VALUE]=this.updateDomByValueType,this.#l[this.CLASS]=this.updateDomByClassType,this.#l[this.RADIO]=this.updateDomByRadioType,this.#l[this.CHECKBOX]=this.updateDomByCheckboxType,this.#c[this.VALUE]=this.updateViewModelByValueType,this.#c[this.CLASS]=this.updateViewModelByClassType,this.#c[this.RADIO]=this.updateViewModelByRadioType,this.#c[this.CHECKBOX]=this.updateViewModelByCheckboxType}static async updateDom(t,e=t.domPropertyType){await Reflect.apply(this.#l[e],this,[t])}static async updateViewModel(t,e=t.domPropertyType){await Reflect.apply(this.#c[e],this,[t])}}class d{#d;#p;#h;#u;#m;#y;#f;#g;#w;#b;#x;#P;constructor(t,e,s){this.#p=t,this.#h=e.dom?.property,this.#u=s.viewModel,this.#m=e.viewModel?.property,this.#y=e.inputable,this.#x=class{static parse(t){return 0==t.length?[]:t.split("|").map((t=>t.split(":"))).map((([t,e])=>({name:t,options:e?.split(";")??[],filter:r.filterByName.get(t)})))}}.parse(e?.filters.join("|"))??[],this.#P=this.#x.slice().reverse(),this.#d=s,this.#f=s.indexes?.slice()??[],this.#b=c.getType(this.#h);const{path:i,pattern:a}=s.getPathInfo(this.#m);this.#g=i,this.#w=a}get dom(){return this.#p}get domProperty(){return this.#h}get viewModel(){return this.#u}get path(){return this.#g}get pattern(){return this.#w}get domPropertyType(){return this.#b}get forwardFilters(){return this.#x}get backwardFilters(){return this.#P}get filter(){return this.#d.filter}async init(t=this.#y){t&&this.attachEvent(),await this.updateDom()}async updateDom(){await c.updateDom(this)}async#v(){await c.updateViewModel(this)}attachEvent(t=this.#p,e=this.#d,s=e.view){t.addEventListener("input",(t=>s.updateProcess(e,(()=>this.#v()))))}}c.init();class p{nodes=[];loops;binds;key}class h{#p;#m;#k=[];#d;#g;#w;#E;constructor(t,e,s){this.#p=t,this.#m=e.viewModel?.property,this.#d=s;const{path:r,pattern:i}=s.getPathInfo(this.#m);this.#g=r,this.#w=i,this.#E=s.loopStack.slice()}get dom(){return this.#p}get path(){return this.#g}get pattern(){return this.#w}get children(){return this.#k}async#N(t,e=this.#p,s=this.#d){return s.pushLoop({loop:this,key:t},(()=>{const r=s.loopStack.map((t=>t.key));return s.pushIndexes(r,(async()=>{const r=document.createDocumentFragment(),i=new p,a=e.content.cloneNode(!0),{binds:n,loops:o}=await s.view.createBindTree(s,a);return Object.assign(i,{key:t,binds:n,loops:o}),r.appendChild(a),i.nodes.push(...Array.from(r.childNodes)),i}))}))}async expand(t=this.#d.viewModel,e=this.#g,s=this.#k,r=this.#p){const i=await t[e];for(const t of Object.keys(i))s.push(await this.#N(t));const a=document.createDocumentFragment(),n=t=>a.appendChild(t);s.forEach((t=>t.nodes.forEach(n))),r.after(a)}#M(t){const e=this.#E.slice(),s=e=>{if(0===e.length)return t();const r=e.pop();return context.pushLoop(r,s)};return s(e)}#B(t){t.loops.forEach((t=>t.contract())),t.nodes.forEach((t=>t.parentNode.removeChild(t)))}contract(t=this.#k){t.forEach((t=>this.#B(t))),t.splice(0)}async update(){this.contract(),await this.#M((async()=>this.expand()))}}class u{#p;#d;#A;#f;#R;constructor(t,e,s){this.#p=t,this.#A=e.dom?.event,this.#d=s,this.#f=s.indexes?.slice()??[],this.#R=this.#D()}get event(){return this.#A}get dom(){return this.#p}init(){this.#C()}#D(){const t=this.#p;return`${this.#A.toLowerCase()}${e="x:name"in t?.dataset?t?.dataset["x:name"]:t?.name?.length>0?t.name:t.tagName.toLowerCase(),e?.length>0?e.at(0).toUpperCase()+e.slice(1):""}`;var e}async#T(t,e=this.#d.viewModel,s=this.#d.eventHandler,r=this.#R,i=this.#f,a=this.#d){return a.pushIndexes(i,(()=>s.exec(e,r,t,...i)))}#C(t=this.#p,e=this.#A,s=this.#d,r=s.view){t.addEventListener(e,(t=>r.updateProcess(s,(()=>this.#T(t)))))}}const m=":not([data-x\\:processed])",y="x:ignore",f=["[data-x\\:bind]","[data-x\\:loop]","[data-x\\:events]"].map((t=>`${t}${m}`)).join(","),g=["input","textarea","select","button"].map((t=>`${t}${m}`)).join(",");class w{static async createBindTree(t,e,s=t.bindRules){const{loops:r,binds:i,events:a}=class{static inputable(t){return"INPUT"===t.tagName&&"button"!==t.type||"TEXTAREA"===t.tagName||"SELECT"===t.tagName}static testRadio(t){return"INPUT"===t.tagName&&"radio"===t.type}static testCheckbox(t){return"INPUT"===t.tagName&&"checkbox"===t.type}static parsePropertyName(t){const e=t.split("|");return{property:e.shift(),filters:e}}static parseDataBind(t,e,s=this.inputable(t),r=this.testRadio(t),i=this.testCheckbox(t)){const a=(t,e)=>{if(t.includes("=")){const[a,n]=t.split("="),{property:o,filters:l}=this.parsePropertyName(n);e.dom.property=a,e.viewModel.property=o,e.filters=l;const c=new Set(s?r?["radio"]:i?["checked","checkbox"]:["value"]:[]);e.inputable=c.has(a)}else{const{property:a,filters:n}=this.parsePropertyName(t);e.dom.property=s?r?"radio":i?"checkbox":"value":"textContent",e.viewModel.property=a,e.filters=n,e.inputable=s}return e},n=e.split(",");if(1==n.length)return[a(e,{dom:{},viewModel:{},filters:[]})];{const t=n.map((t=>a(t,{dom:{},viewModel:{},filters:[]})));return t}}static collectByAttribute(t,e,s=[],r=[],i=[]){return Array.from(e.querySelectorAll(f)).forEach((e=>{if(y in e.dataset)return;const a=e.dataset["x:processing"]?.split(",")??[];if("x:loop"in e.dataset){if("TEMPLATE"!==e.tagName)return;if(a.includes("loop"))return;const s={dom:{},viewModel:{property:e.dataset["x:loop"]},filters:[]};r.push(new h(e,s,t)),a.push("loop")}else{if("x:bind"in e.dataset){if(a.includes("bind"))return;s.push(...this.parseDataBind(e,e.dataset["x:bind"]).map((s=>new d(e,s,t)))),a.push("bind")}if("x:events"in e.dataset){if(a.includes("events"))return;e.dataset["x:events"].split(",").forEach((s=>{const r={dom:{event:s},viewModel:{},filters:[]};i.push(new u(e,r,t))})),a.push("events")}}e.dataset["x:processing"]=a.join(",")})),{binds:s,loops:r,events:i}}static collectByImplicit(t,e,s=[],r=[],i=[]){return Array.from(e.querySelectorAll(g)).forEach((e=>{if(y in e.dataset)return;const r=e.dataset["x:processing"]?.split(",")??[],a=this.testRadio(e),n=this.testCheckbox(e),o={dom:{},viewModel:{},filters:[]};if("BUTTON"===e.tagName||"INPUT"===e.tagName&&"button"===e.type){if(r.includes("events"))return;o.dom.event="click",i.push(new u(e,o,t)),r.push("events")}else{if(r.includes("bind"))return;const{property:i,filters:l}=this.parsePropertyName(e.name);o.dom.property=a?"radio":n?"checkbox":"value",o.viewModel.property=i,o.filters=l,o.inputable=!0,s.push(new d(e,o,t)),r.push("bind")}e.dataset["x:processing"]=r.join(",")})),{binds:s,loops:r,events:i}}static collectByRule(t,e,s,r=[],i=[],a=[]){const n=new Map;return s.forEach((t=>{!n.has(t.dom.selector)&&n.set(t.dom.selector,[]),n.get(t.dom.selector).push(t)})),Array.from(n.keys()).forEach((s=>{e.querySelectorAll(`${s}${m}`).forEach((e=>{if(y in e.dataset)return;const o=this.inputable(e),l=e.dataset["x:processing"]?.split(",")??[],c=l.slice();n.get(s).forEach((s=>{const n=JSON.parse(JSON.stringify(s));if("TEMPLATE"===e.tagName){if(l.includes("loop"))return;((e,s)=>{i.push(new h(s,e,t))})(n,e),c.push("loop")}else if("event"in n.dom){if(l.includes("events"))return;((e,s)=>{a.push(new u(s,e,t))})(n,e),c.push("events")}else{if(l.includes("bind"))return;n.inputable=o,((e,s)=>{r.push(new d(s,e,t))})(n,e),c.push("bind")}})),e.dataset["x:processing"]=c.join(",")}))})),{loops:i,binds:r,events:a}}static collect(t,e,s=[]){const r=[],i=[],a=[];return this.collectByRule(t,e,s,r,i,a),this.collectByAttribute(t,e,r,i,a),this.collectByImplicit(t,e,r,i,a),r.forEach((t=>t.dom.dataset["x:processed"]="")),i.forEach((t=>t.dom.dataset["x:processed"]="")),a.forEach((t=>t.dom.dataset["x:processed"]="")),Array.from(e.querySelectorAll("[data-x\\:processing]")).forEach((t=>{t.removeAttribute("data-x:processing")})),{loops:i,binds:r,events:a}}}.collect(t,e,s);return await Promise.all(r.map((t=>t.expand()))),await Promise.all(i.map((t=>t.init()))),a.forEach((t=>t.init())),{loops:r,binds:i,events:a}}static async build(t,e=t.rootElement){const s=await this.createBindTree(t,e);t.setBindTree(s),t.buildBinds()}static appear(t,e=t.fragment,s=t.parentElement){const r=s.attachShadow({mode:"open"});r.appendChild(e),t.rootElement=r}static attachTo(t,e){t.parentElement=e,this.appear(t)}static async updateDom(t,e=t.notifier,s=t.allBinds,r=t.allLoops,i=t.dependencies){const n=[];e.queue.forEach((({name:t,indexes:e})=>n.push(...i.getReferedProperties(t,e),(({name:t,indexes:e})=>({name:a.expand(t,e),pattern:t,indexes:e}))({name:t,indexes:e}))));const o=new Set(n.map((t=>t.name)));await Promise.all(r.filter((t=>o.has(t.path))).map((t=>t.update()))),await Promise.all(s.filter((t=>o.has(t.path))).map((t=>t.updateDom())))}static async updateProcess(t,e,s=t.notifier,r=t.properties,i=t.postProcess){i.clear(),s.clear(),r.clearStatus(),await e(),await this.updateDom(t),r.isUpdate&&t.buildBinds(),await i.exec()}}class b{parentNodes=[];name;func;childNodes=[];constructor(t){this.name=t}}class x{#$=new Map;#S;#d;constructor(t){this.#d=t}get map(){return this.#$}build(t=this.#$,e=this.#d.dependencyRules){t.clear(),this.#S=this.#d.dependencyRules.slice(),e.forEach((([t,e,s])=>this.add(t,e,s))),this.implicitDependency()}implicitDependency(t=this.#d.properties){for(const e of t.names)t.getDependencyNames(e).forEach((t=>this.add(t,[e])))}add(t,e,s,r=this.#$){r.has(t)||r.set(t,new b(t));const i=r.get(t);i.func=s,e.forEach((t=>{r.has(t)||r.set(t,new b(t));const e=r.get(t);i.childNodes.push(e),e.parentNodes.push(i)}))}getReferedProperties(t,e,s=this.#$){const r=s.get(t),i=new Set,n=e??[],o=(t,e)=>{if(null==t)return e;const s=a.expand(t.name,n);if(null!==s){if(i.has(s))return e;i.add(s),e.push({name:s,pattern:t.name,indexes:t.func?t.func(n):n})}return t.parentNodes.forEach((t=>{e=o(t,e)})),e},l=o(r,[]),c=[];return l.forEach((t=>{const e=new Set(c.map((t=>t.name)));e.has(t)||c.push(t)})),c}}const P={suspend:Symbol("")};class v{static PLAIN=1;static PATTERN=2;static EXPANDED=3}class k{#s;#w;#O;#L;#d;#j;#I;#V;#q=!0;#U=!1;#F;constructor(t,e,s,r,i,a){this.#d=t,this.#V=e,this.#s=s,this.#w=r,this.#j=i,this.#I=a;const n=s.split(".");this.#O=n.pop(),this.#L=n.join(".")}get context(){return this.#d}get name(){return this.#s}get pathParent(){return this.#L}get pathLastElement(){return this.#O}get desc(){return this.#j}get init(){return this.#I}get type(){return this.#V}get pattern(){return this.#w}get isArray(){return this.testIsArray()}get referedPatternProperties(){return this.getReferedPatternPeoperties()}get value(){return this.getValue()}get isNew(){return this.#q}get isUpdate(){return this.#U}get hasSetter(){return null!=this.desc.set}set desc(t){this.#j=t,Object.defineProperty(this.#d.viewModel,this.#s,t)}set isNew(t){this.#q=t}set isUpdate(t){this.#U=t}testIsArray(){return!1}getReferedPatternPeoperties(){return[]}getValue(){throw new Error("")}clearStatus(){this.isNew=!1,this.isUpdate=!1}static create(t,{name:e=null,desc:s={},patternProperty:r=null,patternIndexes:i=[],requireSetter:a=null,init:n=null}){return null!=r?new M(t,r,i):(null===a&&(a="set"in s),e.includes("*")?new N(t,e,s,a,n):new E(t,e,s,a,n))}}class E extends k{constructor(t,e,s,r,i){super(t,v.PLAIN,e,e,s,i),this.#H(r)}testIsArray(t=this.name,e=this.context.properties){return e.testIsArray(t)}#H(t){this.context.viewModel;const e=this.context.notifier,s=this.context.cache,r=this.pathParent,i=this.pathLastElement,a=this.name.includes("."),n=`__${this.name}`,o=this.name,l=this.desc,c=a?function(t){const a=l.set?Reflect.apply(l.set,this,[t]):this[r][i]=t;return this.isUpdate=!0,s.delete(o),(async()=>{await a!==P.suspend&&await e.notify(o)})()}:function(t){const r=l.set?Reflect.apply(l.set,this,[t]):this[n]=t;return this.isUpdate=!0,s.delete(o),(async()=>{await r!==P.suspend&&await e.notify(o)})()},d={configurable:!0,enumerable:!0,get:a?function(){return s.has(o)?s.get(o):s.set(o,l.get?Reflect.apply(l.get,this,[]):this[r]?.[i])}:function(){return s.has(o)?s.get(o):s.set(o,l.get?Reflect.apply(l.get,this,[]):this[n])}};t&&(d.set=c),this.desc=d}getReferedPatternPeoperties(t=this.context.properties,e=this.name){return t.getReferedPatternPeoperties(e)}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class N extends k{constructor(t,e,s,r,i){super(t,v.PATTERN,e,e,s),this.#H(r)}testIsArray(t=this.pattern,e=this.context.properties){return e.testIsArray(t)}#H(t){const e=this.context,s=(this.context.viewModel,this.pathParent),r=this.pathLastElement,i=this.pattern.split("").filter((t=>"*"===t)).length,a=this.desc,n={configurable:!0,enumerable:!0,get:a.get?a.get:function(){const t="*"===r?(e?.indexes??[]).at(i-1):r;return this[s]?.[t]}};t&&(n.set=a.set?a.set:function(t){const a="*"===r?(e?.indexes??[]).at(i-1):r;this[s][a]=t,this.isUpdate=!0}),this.desc=n}getReferedPatternPeoperties(t=this.context.properties,e=this.pattern){return t.getReferedPatternPeoperties(e)}}class M extends k{#_;#X;constructor(t,e,s){const r=a.expand(e.pattern,s);super(t,v.EXPANDED,r,e.pattern,null,e.init),this.#_=e,this.#X=s.slice(),this.#H()}get patternProperty(){return this.#_}get patternIndexes(){return this.#X}#H(){const t=this.context,e=this.context.cache,s=this.context.viewModel,r=this.context.notifier,i=(this.context.properties,this.patternProperty),a=this.patternIndexes,n=this.name,o={configurable:!0,enumerable:!0,get:()=>t.pushIndexes(a,(()=>e.has(n)?e.get(n):e.set(n,s[i.pattern])))};null!=i.desc.set&&(o.set=o=>t.pushIndexes(a,(()=>{const t=Reflect.apply(i.desc.set,s,[o]);return this.isUpdate=!0,e.delete(n),(async()=>{await t!==P.suspend&&await r.notify(i.pattern,a)})()}))),this.desc=o}testIsArray(t=this.patternProperty.pattern,e=this.context.properties){return e.testIsArray(t)}getReferedPatternPeoperties(t=this.patternProperty){return t.referedPatternProperties}getValue(){return Reflect.apply(this.desc.get,this.context.viewModel,[this.name])}}class B{#d;#z=new Map;#U=!1;constructor(t){this.#d=t}get names(){return Array.from(this.#z.keys())}get values(){return Array.from(this.#z.values())}build(t=this.#d,e=this.#d.viewModel){this.#z.clear();const s=Object.getPrototypeOf(e),r=t=>({configurable:!0,enumerable:!1,writable:!0,value:t?.value}),i=t=>/^\@\@?([a-zA-Z0-9_\.\*])+(#(get|set|init))?$/.test(t),a=t=>/^#(event[a-zA-Z0-9_]+)$/.test(t),n=t=>/^__([a-zA-Z0-9_])+$/.test(t),o=new Map;[e].forEach((t=>{Object.entries(Object.getOwnPropertyDescriptors(t)).forEach((([t,s])=>{if(i(t)||n(t)||a(t))if(n(t))Reflect.defineProperty(e,t,r(s));else if(i(t)){const[r,i]=t.includes("#")?t.split("#"):[t,null],a="@"===t.at(1),n=a?r.slice(2):r.slice(1),l=o.has(n)?o.get(n):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};l.baseName=l.baseName??n,l.originalName=l.originalName??r,l.privateName=l.privateName??`__${n}`,l.get="get"===i?s.value:l.get,l.set="set"===i?s.value:l.set,l.init="init"===i?s.value:l.init,l.requireGet=null==i||l.requireGet,l.requireSet=a,l.privateValue=null==i?s.value:l.privateValue,o.set(n,l),Reflect.deleteProperty(e,t)}else if(a(t)){const r=t,i="set",a=!0,n=r.slice(1),l=o.has(n)?o.get(n):{baseName:null,originalName:null,privateName:null,get:null,set:null,init:null,requireGet:!1,requireSet:!1,privateValue:void 0};l.baseName=l.baseName??n,l.originalName=l.originalName??r,l.privateName=l.privateName??`__${n}`,l.set="set"===i?s.value:l.set,l.requireGet=null==i||l.requireGet,l.requireSet=a,l.privateValue=null==i?s.value:l.privateValue,o.set(n,l),Reflect.deleteProperty(e,t)}}))})),Array.from(o.entries()).forEach((([i,a])=>{a.privateName in e||a.baseName.includes(".")||Reflect.defineProperty(e,a.privateName,r({value:a.privateValue}));const n=Object.getOwnPropertyDescriptor(e,i)??Object.getOwnPropertyDescriptor(s,i)??{};n.get=null!=a.get?a.get:n.get??null,n.set=null!=a.set?a.set:n.set??null;const o=a.init,l=a.requireSet,c=i;this.setProperty(k.create(t,{name:c,desc:n,requireSetter:l,init:o}))})),[e,s].forEach((e=>{Object.entries(Object.getOwnPropertyDescriptors(e)).forEach((([e,s])=>{this.#z.has(e)||(null!=s?.get?this.setProperty(k.create(t,{name:e,desc:s,requireSetter:null!=s?.set})):null!=s?.set&&this.setProperty(k.create(t,{name:e,desc:s,requireSetter:!0})))}))}));const l=[];for(const t of this.#z.keys()){const e=[],s=t.split("."),r=[];s.forEach((t=>{r.push(t),e.push(r.join("."))})),l.push(...e)}Array.from(new Set(l)).filter((t=>!this.#z.has(t))).forEach((r=>{const i=Object.getOwnPropertyDescriptor(e,r)??Object.getOwnPropertyDescriptor(s,r)??{};this.setProperty(k.create(t,{name:r,desc:i,requireSetter:!0}))})),Object.defineProperty(e,"$context",{get:()=>t})}removeProperty(t,e=this.#d.viewModel,s=this.#d.cache,r=this.#z){delete e[t],r.delete(t),s.delete(t)}getProperty(t,e=this.#z){return e.get(t)}setProperty(t,e=this.#z){e.set(t.name,t)}async#W(t){const e=t.type===v.EXPANDED?t.patternIndexes:[],s=await t.value,r=Object.keys(s)??[],i=this.#d;for(const s of t.referedPatternProperties){const t=s.pattern;for(const n of r){const r=e.concat(n);if(!a.expand(t,r).includes("*")){const t=k.create(i,{patternProperty:s,patternIndexes:r,requireSetter:s.hasSetter});this.setProperty(t),s.isArray&&await this.#W(t)}}}}async expand(t,e=null){const s=this.getProperty(t);null!=s&&await this.#W(s)}#G(t){const e=(t.type===v.EXPANDED?t.patternIndexes:[]).join("\t"),s=t=>t.patternIndexes.join("\t").startsWith(e);t.referedPatternProperties.forEach((t=>{this.getExpandedPropertiesByPatternProperty(t).filter(s).forEach((t=>{this.removeProperty(t.name)}))}))}contract(t){const e=this.getProperty(t);null!=e&&this.#G(e)}testIsArray(t,e=this.#z){return e.has(`${t}.*`)}async#K(t,e=this.#d.cache){e.delete(t);const s=this.getProperty(t);null!=s&&s.isArray&&(this.#G(s),await this.#W(s))}async updateByPatternIndexes({name:t,indexes:e}){const s=a.expand(t,e);await this.#K(s);for(const r of this.#d.dependencies.getReferedProperties(t,e))s!==r.name&&await this.#K(r.name)}async expandAll(t=this.#z){await Promise.all(Array.from(t.entries()).map((async([t,e])=>{!t.includes("*")&&e.isArray&&this.#W(e)})))}has(t,e=this.#z){return e.has(t)}getReferedPatternPeoperties(t){const e=`${t}.`;return this.names.filter((t=>t.startsWith(e))).map((t=>this.getProperty(t))).filter((t=>t.type===v.PATTERN))}getDependencyNames(t){const e=`${t}.`;return this.names.filter((t=>t.startsWith(e)&&!t.slice(e.length).includes("."))).map((t=>this.getProperty(t))).filter((t=>t.type===v.PATTERN||v.PLAIN)).map((t=>t.name))}getExpandedPropertiesByPatternProperty(t){return this.values.filter((t=>t.type===v.EXPANDED)).filter((e=>e.patternProperty===t))}clearStatus(){return this.values.forEach((t=>t.clearStatus()))}get isUpdate(){return this.values.some((t=>t.isUpdate||t.isNew))}}class A{#Z=[];#d;constructor(t){this.#d=t}get queue(){return this.#Z}async notify(t,e=[],s=this.#Z,r=this.#d.properties){s.push({name:t,indexes:e}),await r.updateByPatternIndexes({name:t,indexes:e})}clear(t=this.#Z){t.splice(0)}}class R{#J=new Map;#d;constructor(t){this.#d=t}has(t){return this.#J.has(t)}get(t){return this.#J.get(t)}set(t,e){return this.#J.set(t,e),e instanceof Promise&&e.then((e=>this.#J.set(t,e))),e}delete(t){this.#J.delete(t)}}class D{#d;#Z=[];constructor(t){this.#d=t}regist(t,e=this.#Z){e.push(t)}exec(t=this.#d,e=this.#Z,s=t.view){const r=e.slice(),i=[];return r.length>0&&s.updateProcess(t,(()=>{for(const t of r)i.push(t())})),Promise.all(i)}clear(t=this.#Z){t.splice(0)}}class C{#Q;#Y;#tt;#et;#u;#st;#rt;#it={binds:[],loops:[]};#at=[];#nt=[];#E=[];#ot=[];#lt;#ct;#J;#dt;#pt;#t;#T;#ht;#ut;#mt;constructor(t,e,s){this.#t=t,this.#Q=e,this.#pt=s}build(){this.#et=w,this.#st=new D(this),this.#rt=new x(this),this.#lt=new B(this),this.#ct=new A(this),this.#J=new R(this),this.#dt=r,this.#T=n,this.#ht=o,this.#ut=l}get parentElement(){return this.#Q}get fragment(){return this.#Y}get rootElement(){return this.#tt??this.#Y}get view(){return this.#et}get viewModel(){return this.#u}get postProcess(){return this.#st}get dependencies(){return this.#rt}get bindTree(){return this.#it}get allBinds(){return this.#at}get allLoops(){return this.#nt}get indexesStack(){return this.#ot}get indexes(){return this.#ot[this.#ot.length-1]}get $1(){return this.indexes[0]}get $2(){return this.indexes[1]}get $3(){return this.indexes[2]}get $4(){return this.indexes[3]}get $5(){return this.indexes[4]}get $6(){return this.indexes[5]}get $7(){return this.indexes[6]}get $8(){return this.indexes[7]}get loopStack(){return this.#E}get currentLoop(){return this.#E[this.#E.length-1]}get properties(){return this.#lt}get notifier(){return this.#ct}get cache(){return this.#J}get context(){return this}get filter(){return this.#dt}get rootBlock(){return this.#pt}get block(){return this.#t}get eventHandler(){return this.#T}get initializer(){return this.#ht}get data(){return this.#pt.data}get dataReflecter(){return this.#ut}get template(){return this.#mt.template}get module(){return this.#mt}get moduleDatas(){return this.#mt.moduleDatas}get bindRules(){return this.#mt.bindRules}get dependencyRules(){return this.#mt.dependencyRules}get isBlockModule(){return this.#mt.useModule}get symbols(){return P}set module(t){this.#mt=t,this.#u=void 0!==t.viewModel?t.viewModel:void 0!==t.AppViewModel?Reflect.construct(t.AppViewModel,[]):{},this.#Y=t.template.content.cloneNode(!0);const e=t?.context??t?._;null!=e&&this.reflect(e,t.dialog)}set rootElement(t){this.#tt=t}set parentElement(t){this.#Q=t}pushIndexes(t,e){this.#ot.push(t);try{return e()}finally{this.#ot.pop()}}pushLoop({loop:t,key:e},s){this.#E.push({loop:t,key:e});try{return s()}finally{this.#E.pop()}}getPathInfo(t,e=t,s=this.currentLoop?.loop,r=this.currentLoop?.key,i=this.indexes??[]){return"."===t[0]?"."===t?{path:`${s.path}.${r}`,pattern:`${s.pattern}.*`}:{path:`${s.path}.${r}.${t}`,pattern:`${s.pattern}.*.${t}`}:{path:a.expand(e,i),pattern:e}}setBindTree({binds:t,loops:e},s=this.bindTree){s.binds.splice(0),s.loops.splice(0),s.binds.push(...t),s.loops.push(...e)}buildBinds(t=this.bindTree,e=this.allBinds,s=this.allLoops){e.splice(0),s.splice(0);const r=t=>e.push(t),i=t=>s.push(t);t.binds.forEach(r),t.loops.forEach(i);const a=t=>{t.children.forEach((t=>{t.binds.forEach(r),t.loops.forEach(i),t.loops.forEach(a)}))};t.loops.forEach(a)}reflect(t,e){const s=Object.getPrototypeOf(this);if(Object.entries(Object.getOwnPropertyDescriptors(s)).forEach((([e,s])=>{if(null!=s?.get){const r={configurable:!0,enumerable:!0,get:(...t)=>Reflect.apply(s.get,this,t)};Object.defineProperty(t,e,r)}})),[["$notify","notify"],["$notifyAll","notifyAll"],["$inquiryAll","inquiryAll"],["$openDialog","openDialog"],["$postProcess","postProcess"]].forEach((([e,s])=>{const r={configurable:!0,enumerable:!1,value:"AsyncFunction"===e.constructor.name?async(...t)=>Reflect.apply(this[e],this,t):(...t)=>Reflect.apply(this[e],this,t)};Object.defineProperty(t,s,r)})),null!=e){this.$closeDialog=function(t){e.closeDialog(t)};const s={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$closeDialog,this,t)};Object.defineProperty(t,"closeDialog",s),this.$cancelDialog=function(){e.cancelDialog()};const r={configurable:!0,enumerable:!1,value:(...t)=>Reflect.apply(this.$cancelDialog,this,t)};Object.defineProperty(t,"cancelDialog",r)}}$notify(t,e=[]){this.notifier.notify(t,e)}$postProcess(t){this.postProcess.regist(t)}async $notifyAll(t,e=[]){this.rootBlock.notifyAll(t,e,this.block)}async $inquiryAll(t,e,s){this.$postProcess((()=>this.rootBlock.inquiryAll(t,e,s,this.block)))}async $openDialog(t,e={}){return i.open(t,e)}}const T="--bind-",$="--bind-class-";class S{dom={selector:""};viewModel={};filters=[];static#yt(t,e,s,r){const i=new S;return i.dom.selector=t,i.dom.property=e,i.viewModel.property=s,i.filters.push(...r),i}static#ft(t,e){const s=new S;return s.dom.selector=t,s.dom.event=e,s}static#gt(t,e){const s=new S;return s.dom.selector=t,s.viewModel.property=e,s}static build(t){const e=[];for(let s=0;s<t.style.length;s++){const r=t.style[s],i=t.style.getPropertyValue(r).trim();if("--events"===r)for(const s of i.split(",")){const r=S.#ft(t.selectorText,s);e.push(r)}else if("--loop"===r){const s=S.#gt(t.selectorText,i);e.push(s)}else if(r.startsWith($)){const s=i.split("|"),a=s.shift(),n=s,o=S.#yt(t.selectorText,"class."+r.slice($.length),a,n);e.push(o)}else if(r.startsWith(T)){const s=i.split("|"),a=s.shift(),n=s,o=S.#yt(t.selectorText,r.slice(T.length).replaceAll("-","."),a,n);e.push(o)}}return e}}class O{static spaPath;static spaCssPath;static spaHtmlPath;static spaModulePath;static filterPath;static localFilter;static modulePath=".";static setOptions(t,e){this.spaPath=e.spaPath??(t?`${t}-spa`:"spa"),this.spaCssPath=`${this.spaPath}/css`,this.spaHtmlPath=`${this.spaPath}/html`,this.spaModulePath=`${this.spaPath}/module`,this.modulePath=e.modulePath??".",this.localFilter=e.localFilter??!1,this.filterPath=this.localFilter?e.filterPath??`${this.spaPath}/module/filter`:null}}class L{name;viewModel;AppViewModel;html;css;bindCss;dependencyRules;template;bindRules;context;_;dialog;useModule;moduleDatas;static async load({name:t,useModule:e,withBindCss:s,module:r=new L}){const i=e?null:O.spaCssPath,a=e?null:O.spaHtmlPath,n=e?null:O.spaModulePath,o=e?O.modulePath:null;r.name=t,r.useModule=e;const l=await this.loadScript(t,o??n);if(Object.assign(r,l?.default??{}),void 0===r.html&&null!==a){const e=await this.loadHtml(t,a);Object.assign(r,{html:e})}if(void 0===r.css&&null!==i){const e=await this.loadCss(t,i);Object.assign(r,{css:e})}if(s&&void 0===r.bindCss&&null!==i&&void 0===r.bindRules){const e=await this.loadBindCss(t,i);Object.assign(r,{bindCss:e})}return this.build(t,r,e)}static build(t,e,s=!1){e.useModule=s;const r=this.buildTemplate(t,e.html,e.css);if(Object.assign(e,{template:r}),void 0===e.bindRules&&void 0!==e.bindCss){const t=this.buildBindRules(e.bindCss);Object.assign(e,{bindRules:t})}return void 0===e.dependencyRules&&(e.dependencyRules=[]),void 0===e.bindRules&&(e.bindRules=[]),e}static async loadScript(t,e){const s=e.startsWith("https://")||e.startsWith("http://")||"/"===e[0],r=document.baseURI.lastIndexOf("/"),i=r>=0?document.baseURI.slice(0,r+1):"";return import(s?`${e}/${t}.js`:`${i}${e}/${t}.js`).catch((t=>{throw console.error(t),t}))}static async loadHtml(t,e){return fetch(`${e}/${t}.html`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadCss(t,e){return fetch(`${e}/${t}.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(t.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static async loadBindCss(t,e){return fetch(`${e}/${t}.bind.css`).then((t=>{if(!t.ok)throw console.error("response.ok:",t.ok),console.error("esponse.status:",t.status),console.error("esponse.statusText:",t.statusText),new Error(res.statusText);return t.text()})).catch((t=>{throw console.error(t),t}))}static buildTemplate(t,e,s){const r=document.createElement("template");return r.innerHTML=e,void 0!==s&&(r.innerHTML="<style>\n"+s+"\n</style>\n"+r.innerHTML),r.dataset["x:block"]=t,r}static buildBindRules(t){return class{static collect(t){if(null==t||""===t)return[];const e=document.createElement("div");document.body.appendChild(e);const s=e.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=t;const i=[];s.appendChild(r);const a=Array.from(s.styleSheets).find((t=>t.ownerNode===r));return Array.from(a?.cssRules??[]).map((t=>i.push(...S.build(t)))),document.body.removeChild(e),i}}.collect(t)}}class j{#s;#d;#wt=[];#bt;constructor(t=null){this.#bt=t}get context(){return this.#d}get name(){return this.#s}#xt(t,e,s){return this.#s=t,this.#d=new C(this,e,s),this.#d.build(),this.#d}async load({name:t,parentElement:e,useModule:s,moduleData:r,withBindCss:i,rootBlock:a}){const n=this.#xt(t,e,a);try{const e=t=>{const e=a.block.context.moduleDatas[t];return L.build(t,e)},o=s&&a?.block?e(t):null!=r?L.build(t,r,s):await L.load({name:t,useModule:s,withBindCss:i});s&&(a.block??(a.block=this)),o.dialog=this.#bt,n.module=o}catch(t){throw t}}async build({data:t,useModule:e,rootBlock:s,context:r=this.#d}){r.properties.build(),r.dependencies.build(),r.dataReflecter.reflect(r,t,r.viewModel),await r.initializer.init(r,t),await r.properties.expandAll(),await r.view.build(r),this.#wt.push(...await I.build(r.rootElement,e,s)),(!r.isBlockModule||null!=r.parentElement)&&r.view.appear(r),await r.postProcess.exec()}static async create({name:t,parentElement:s=null,useModule:r=!1,moduleData:i=null,withBindCss:a=!1,rootBlock:n=e.root,data:o=n.data,dialog:l=null}){const c=new j(l);return await c.load({name:t,parentElement:s,useModule:r,moduleData:i,withBindCss:a,rootBlock:n}),await c.build({data:o,useModule:r,rootBlock:n}),c}async notifyAll(t,e,s){const r=this.#d,i=r.notifier,a=r.viewModel,n=r.eventHandler,o=r.view;for(const r of this.#wt)r.notifyAll(t,e,s);s!==this&&o.updateProcess(r,(async()=>{const r=n.exec(a,"notifyAll",t,e,s),o=r instanceof Promise?await r:r;return i.notify(t,e),o}))}async inquiryAll(t,e,s,r){const i=this.#d,a=i.viewModel,n=i.eventHandler,o=i.view;for(const i of this.#wt)i.inquiryAll(t,e,s,r);r!==this&&o.updateProcess(i,(async()=>n.exec(a,"inquiryAll",t,e,s,r)))}attachTo(t,e=this.#d,s=e.view){s.attachTo(e,t)}}class I{static async build(t,s=!1,r=e.root){return await Promise.all((t=>Array.from(t.querySelectorAll("[data-x\\:block]")))(t).map((t=>(async t=>{const e=t.dataset["x:block"],i="x:withBindCss"in t.dataset;return j.create({name:e,parentElement:t,withBindCss:i,useModule:s,rootBlock:r})})(t))))}}class V{#wt=[];get data(){return t.data}async build(){this.#wt.push(...await I.build(document.body))}async notifyAll(t,e,s){for(const r of this.#wt)r.notifyAll(t,e,s)}async inquiryAll(t,e,s,r){for(const i of this.#wt)i.inquiryAll(t,e,s,r)}}class q{#r=new V;#e;#Pt;#t;constructor(t,e){this.#e=t,this.#Pt=e}get data(){return this.#e}get callback(){return this.#Pt}get block(){return this.#t}set block(t){this.#t=t}async notifyAll(t,e,s){await this.#r.notifyAll(t,e,s),this.callback&&this.callback(this.data)}async inquiryAll(t,e,s,r){await this.#r.inquiryAll(t,e,s,r)}}r.regist("falsey",{forward:(t,e=[])=>!t}),r.regist("not",{forward:(t,e=[])=>!t}),r.regist("null",{forward:(t,e=[])=>null==t}),r.regist("style-display",{forward:(t,e=[])=>t?"":"none"}),r.regist("locale-string",{forward:(t,e=[])=>Number(t).toLocaleString()}),r.regist("fixed",{forward:(t,e=[])=>Number(t).toFixed(e[0]??0)}),r.regist("ge",{forward:(t,e=[])=>Number(t)>=Number(e[0]??0)}),r.regist("gt",{forward:(t,e=[])=>Number(t)>Number(e[0]??0)}),r.regist("le",{forward:(t,e=[])=>Number(t)<=Number(e[0]??0)}),r.regist("lt",{forward:(t,e=[])=>Number(t)<Number(e[0]??0)}),r.regist("number-value",{forward:(t,e=[])=>t?.toString()??"",backward:(t,e=[])=>""!==t?Number(t):null});class U{static root;static booting=!1;static booted=!1;static async boot({data:r={},options:i={}}={}){this.booting=!0;try{t.setData(r),O.setOptions(this.getBaseName(),i),await class{static async registLocalFilter(t=O.localFilter,e=O.filterPath){if(t){const t=document.baseURI.lastIndexOf("/"),r=t>=0?document.baseURI.slice(0,t+1):"";await s(108)(`${r}${e}/regist.js`)}}}.registLocalFilter(),this.root=new V,e.setRoot(this.root),await this.root.build()}finally{this.booting=!1,this.booted=!0}}static getBaseName(){const t=location.href.split("/").pop();if(t){const e=t.split(".");return e.pop(),e.join(".")}return t}static async createBlockModule(t,{alias:e=null,data:s={},path:r=null,handler:i=null,parentElement:a=null}){const n={useModule:!0,rootBlock:new q(s,i)};return"object"==typeof t?(n.moduleData=t,n.name=e??"__blockModule"):"."===t[0]||"/"===t[0]?(n.path=t,n.name=e??"__blockModule"):n.name=t,n.parentElement=a,j.create(n)}static getSymbol(t){return P[t]}}document.addEventListener("DOMContentLoaded",(function(){U.booted||U.booting||U.boot()})),window.datax=U})()})();